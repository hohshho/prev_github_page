{"componentChunkName":"component---src-templates-post-tsx","path":"/SpringSecurity2_2/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"oauth-20-client\" style=\"position:relative;\"><a href=\"#oauth-20-client\" aria-label=\"oauth 20 client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client</h1>\n<blockquote>\n<p>OAuth 2.0 인가 프레임워크의 역할 중 인가 서버 및 리소스 서버와의 통신을 담당하는 클라이언트의 기능을 필터 기반으로 구현한 모듈</p>\n</blockquote>\n<h2 id=\"oauth-20-login-api\" style=\"position:relative;\"><a href=\"#oauth-20-login-api\" aria-label=\"oauth 20 login api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Login API</h2>\n<blockquote>\n<p>어플리케이션 사용자를 외부 OAuth2.0 Provider나 OpenID Connect 1.0 Provider 계정으로 로그인 할 수 있는 기능 제공</p>\n</blockquote>\n<ul>\n<li>권한 부여 유형 중 Authorization Code 방식을 사용</li>\n</ul>\n<h2 id=\"oauth-20-client-api\" style=\"position:relative;\"><a href=\"#oauth-20-client-api\" aria-label=\"oauth 20 client api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client API</h2>\n<blockquote>\n<p>인가 서버의 권한 부여 유형에 따른 엔드 포인트와 직접 통신할 수 있는 API 제공</p>\n</blockquote>\n<ul>\n<li>\n<p>권한 부여 종류</p>\n<ul>\n<li>Client Credentials</li>\n<li>Resource Owner Password Credentials</li>\n<li>Refresh Token</li>\n</ul>\n</li>\n<li>리소스 서버와 연동해서 Token을 가지고 원하는 데이터를 가지고 오는 기능 구현 가능</li>\n</ul>\n<h2 id=\"oauth-20-client-fundamentals\" style=\"position:relative;\"><a href=\"#oauth-20-client-fundamentals\" aria-label=\"oauth 20 client fundamentals permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client Fundamentals</h2>\n<h3 id=\"client-권한-설정-과정\" style=\"position:relative;\"><a href=\"#client-%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95-%EA%B3%BC%EC%A0%95\" aria-label=\"client 권한 설정 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client 권한 설정 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cbde6a9309f7bf21c52c3a027af50f95/c549b/clientRegistrationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.756756756756754%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCUlEQVQY05WQ626DMAyF+/B7hL0TUBioYmICpLUUCqWUW7hlgDizM7XSfk2z5ESKj78ceweKaZpQ1zWSJEEURSjLEk3TYJ5n9H2Py+WCNI6RphkwS2ilxMunhGgbVFWltOu6Mgo7PoZhQJ7nCIIAnuchyzIFZdEXQTklaVjHwLdqwutZoiXQ4/NfQH7wfR+6rkPTNLiui5gcscORHPZUX5YFf8W2bT9Aduc4Doz9HqZlYU83j86juocDXMPAu20r5zziNEmMlLwqKaUCcT4dXgkYhiEsarRNEx889vWKsevQ3G4QokVFOy6KQgGFECo7qvOOH7CnQ0EFFp6PR8SnE+7UqPb1j3hAvwFlZseye1AD6gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"clientRegistrationFlow\"\n        title=\"clientRegistrationFlow\"\n        src=\"/static/cbde6a9309f7bf21c52c3a027af50f95/fcda8/clientRegistrationFlow.png\"\n        srcset=\"/static/cbde6a9309f7bf21c52c3a027af50f95/12f09/clientRegistrationFlow.png 148w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/e4a3f/clientRegistrationFlow.png 295w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/fcda8/clientRegistrationFlow.png 590w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/efc66/clientRegistrationFlow.png 885w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/c83ae/clientRegistrationFlow.png 1180w,\n/static/cbde6a9309f7bf21c52c3a027af50f95/c549b/clientRegistrationFlow.png 2128w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>application.yml에 환경 설정 파일에 <strong>클라이언트, 인가서버 엔드포인트 설정</strong></li>\n<li>환경설정에 있는 정보가 <strong>OAuth2ClientProperties</strong>의 각 속성에 바인딩</li>\n<li><strong>ClientRegistration</strong>클래스에 인가서버로 권한부여 요청을 하기 위한 OAuth2ClientProperties가 저장된다.</li>\n<li>OAuth2Client는 ClientRegistration을 참조해 권한 요청을 위한 매개변수를 구성하고 인가 서버와 통신한다.</li>\n</ol>\n<h3 id=\"client-registration-초기화-과정\" style=\"position:relative;\"><a href=\"#client-registration-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\" aria-label=\"client registration 초기화 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client Registration 초기화 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e2f5840818896506175f626938ab6203/a30c9/clientRegistraionConfigFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9klEQVQoz3VS227aQBT0H7UvUZSQCjvGGEjqVmr6UqkPkSLls5qmL1Gkqv+BuAqJq4CAA8E2vsQ2lwL2dM+2iUJbVhrtetYaz8yxYJgW6o0mer0+7u4GGAwG0PV7DIc6rOkUjuPAth24rstBZ9/3sVz+ZFj+AyEIApTLZRQKhS1UKhVYlgW6J4EwDDnoebFYII7j/0LwPA/9fh+NRoMLl0olNJtN7nQ2m2HXinfwwmQyYTFsmKaJTqeDbreLKYtKHO3kUtd10HsUPwh8+Cx66D8yx8Hzu3S3Wq0gEEFCrVYLtVoN1WqV9dnDeDzmIrRTAtoNawrX82EbFmzWvec+Yj6f8wrW6zWiKIJABDlot9s8JjmicumSFvX321kA0/Fxb3oYPtgYTRw8WD7jw61q+FBGoxF3SY6oeFqbzQYRQxzFvDD+gTje3enTUEiAxPL5PAzDwM3NLdRMFtrZB2gfCWfIau+gnmrIvNXY+T3OLy5ZzOWW0NOZO6zX6ygWixgzp1dX13i1v4eEcowDKYlEWsKhIuIwJTJOwuuDfS7+0tnWlKkjcki/isEif/n6DW8SSciSgiMxhWQqAymdg6hkGXKQGI5EBZ8+nz/X81JUoAlRh+QyZG5vv/+AIqvIqaeQ1RMcp/9AOYGYykJiSCRlyIwjM38L/gJZxfWgK/SVLgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"clientRegistraionConfigFlow\"\n        title=\"clientRegistraionConfigFlow\"\n        src=\"/static/e2f5840818896506175f626938ab6203/fcda8/clientRegistraionConfigFlow.png\"\n        srcset=\"/static/e2f5840818896506175f626938ab6203/12f09/clientRegistraionConfigFlow.png 148w,\n/static/e2f5840818896506175f626938ab6203/e4a3f/clientRegistraionConfigFlow.png 295w,\n/static/e2f5840818896506175f626938ab6203/fcda8/clientRegistraionConfigFlow.png 590w,\n/static/e2f5840818896506175f626938ab6203/efc66/clientRegistraionConfigFlow.png 885w,\n/static/e2f5840818896506175f626938ab6203/c83ae/clientRegistraionConfigFlow.png 1180w,\n/static/e2f5840818896506175f626938ab6203/a30c9/clientRegistraionConfigFlow.png 2614w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>\n<p><strong>OAuth2ClientRegistrationRepositoryConfiguration</strong>에서<br>\n<strong>OAuth2ClientPropertiesRegistrationAdapter의 getClientRegistration함수</strong>를 실행</p>\n<ul>\n<li>(ClientRegistrationRepository 빈이 존재하지 않을 경우 실행)</li>\n</ul>\n</li>\n<li>getClientRegistration 함수 내에서 ClientRegistrations객체의<br>\nfromIssuerLocation가 실행되는데 application.yml에 issuer-uri의 OIDC, AUTH 경로에 요청해 필요한 메타데이터 값을 가져온다</li>\n</ol>\n<p>요약</p>\n<ul>\n<li>Client Registration은 인가 서버에 요청해 메타 데이터값을 가져오는데 yml 설정으로 값을 수동으로 지정해 줄 수 있다.</li>\n<li>ClientRepository를 @Bean으로 등록해 yml 설정 없이 코드로 설정 가능</li>\n</ul>\n<h4 id=\"clientregistration-상세-값\" style=\"position:relative;\"><a href=\"#clientregistration-%EC%83%81%EC%84%B8-%EA%B0%92\" aria-label=\"clientregistration 상세 값 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ClientRegistration 상세 값</h4>\n<table>\n<thead>\n<tr>\n<th>title</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>registrationId</td>\n<td>ClientRegistration을 식별할 수 있는 유니크한 ID.</td>\n</tr>\n<tr>\n<td>clientId</td>\n<td>클라이언트 식별자.</td>\n</tr>\n<tr>\n<td>clientSecret</td>\n<td>클라이언트 secret.</td>\n</tr>\n<tr>\n<td>clientAuthenticationMethod</td>\n<td>provider에서 클라이언트를 인증 시 사용 메소드 <br> basic, post, none (public 클라이언트).</td>\n</tr>\n<tr>\n<td>authorizationGrantType</td>\n<td>네 가지 권한 부여 타입 정의 <br>(authorization<em>code, implicit, client</em>credentials, password)</td>\n</tr>\n<tr>\n<td>redirectUriTemplate</td>\n<td>클라이언트에 등록한 리다이렉트 URL<br> 사용자의 인증으로 클라이언트에 접근 권한을 부여하고 나면, 인가 서버가 이 URL로 최종 사용자의 브라우저를 리다이렉트</td>\n</tr>\n<tr>\n<td>Scopes</td>\n<td>인가 요청 플로우에서 클라이언트가 요청한 openid, 이메일, 프로필 등의 scope.</td>\n</tr>\n<tr>\n<td>clientName</td>\n<td>클라이언트를 나타내는 이름</td>\n</tr>\n<tr>\n<td>authorizationUri</td>\n<td>인가 서버의 인가 엔드포인트 URI.</td>\n</tr>\n<tr>\n<td>tokenUri</td>\n<td>인가 서버의 토큰 엔드포인트 URI.</td>\n</tr>\n<tr>\n<td>jwkSetUri</td>\n<td>인가 서버에서 JSON 웹 키 (JWK) 셋을 가져올 때 사용할 URI. 이 키 셋엔 ID 토큰의 JSON Web Signature (JWS) 를 검증할 때 사용할 암호키가 있으며, UserInfo 응답을 검증할 때도 사용할 수 있다.</td>\n</tr>\n<tr>\n<td>configurationMetadata</td>\n<td>OpenID Provider 설정 정보로서 application.properties 에 spring.security.oauth2.client.provider.[providerId].issuerUri를 설정했을 때만 사용할 수 있다.</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"client-repository\" style=\"position:relative;\"><a href=\"#client-repository\" aria-label=\"client repository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client Repository</h3>\n<blockquote>\n<p>OAuth2.0 &#x26; OpenID Connect1.0의 ClientRegistration 저장소 역할</p>\n</blockquote>\n<ul>\n<li>인가 서버에 일차적으로 저장된 클라이언트 등록 정보의 일부를 검색하는 기능 제공</li>\n<li>자동 설정을 사용하면 ClientRegistrationRepository도 ApplicationContext내 @Bean으로 등록하므로 필요하면 원하는 곳에 의존성 주입이 가능<br>\n-> 등록된 클라이언트 정보를 가져올 수 있다.</li>\n</ul>\n<h3 id=\"자동-설정에-의한-초기화-과정\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EB%8F%99-%EC%84%A4%EC%A0%95%EC%97%90-%EC%9D%98%ED%95%9C-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\" aria-label=\"자동 설정에 의한 초기화 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자동 설정에 의한 초기화 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4311375beda5f3951a43df59bf897719/2d86d/AutoconfigInitialize.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACKElEQVQoz22SWW9SQRiG+TUmxguTihVLy3ZYeoAoyNbWXmq803hnNJquUIxa/Rv2wrQUif0HpvfasMsOZV8OEJbX+YYAkjjJe+bMyZxnnpn5ZJVqDck/KaRSafz6fYUrlng0hjQbV6tVDIdD9Pp9dHs99FhmfbeHTkeaRZK6/LsMGPMfW60misUi4vE4stksSqUSjyRJ6DPgYhvjf208HkM2Go1Qq9VQqVSQy+UQi0ZnUFqADC8vf8J/sI8P/vfw+Y5w6PXBy/rjz194vEd+nAe/c+gMWK/XOYRC8Ha7zaxbfFIgEIBGcRdmrQCVSoNVHjUUK6u4d1+JGzdv4dXrN3NguVxGPp/nhul0mvdk12g0+KTTQBAalRI2qxXiugUm0QyDSYRWMECnN0K+rMDu3sGiYaFQQCaTYZeT4nCynBqeEXBtBTazGSYGMrIIBhPUWh2HLsmXsbO7NwHSQZLR1HBqR+Op4bfTsznQuP4PUODAO9xwfwKkB7+MWAyJRALJZJJfCr2TJbWTk68Q1pSwGETodHqodQI0LATUsPHtJTnevtuZA6k0yIq2S7ApNBwO823/uLiA2+nA1vY23O4NOF0eON2TuNjYJFrw8dPxHNjpdPgZkmkkEuEwMqYFaLFg8Bx2qwiXwwXbIwfsDifv9WzbT54+w/V1mVfFDDgYDNBsNnmBU9lM4VTYdGmhUAh220N4Nh/Ds7EFN4vLswmL9QGev3i5UNh/AX9Ds3ORH+rDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AutoconfigInitialize\"\n        title=\"AutoconfigInitialize\"\n        src=\"/static/4311375beda5f3951a43df59bf897719/fcda8/AutoconfigInitialize.png\"\n        srcset=\"/static/4311375beda5f3951a43df59bf897719/12f09/AutoconfigInitialize.png 148w,\n/static/4311375beda5f3951a43df59bf897719/e4a3f/AutoconfigInitialize.png 295w,\n/static/4311375beda5f3951a43df59bf897719/fcda8/AutoconfigInitialize.png 590w,\n/static/4311375beda5f3951a43df59bf897719/efc66/AutoconfigInitialize.png 885w,\n/static/4311375beda5f3951a43df59bf897719/c83ae/AutoconfigInitialize.png 1180w,\n/static/4311375beda5f3951a43df59bf897719/2d86d/AutoconfigInitialize.png 2578w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>OAuth2ImportSelector에서 설정 클래스에 따라 class load</li>\n<li>위 이미지 와 같이 로드되고 <strong>OAuth2ClientWebMvcSecurityConfiguration</strong>에서 2개의 클래스 로드</li>\n<li>DefaultOAuth2AuthorizedClientManager는 실제 권한 부여 요청에 따라 작업을 담당하는 클래스</li>\n<li>HandlerMethodArgumentResolver 는 웹 mvc관련 클래스</li>\n</ol>\n<p>DefaultOAuth2AuthorizedClientManager가 실제 권한 부여 작업 담당 클래스로 중요!</p>\n<p>Bean 등록 과정</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/11f80/OAuth2ClientAutoConfiguration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzUlEQVQoz3VS2Y7aQBD0D+EIEvButNp8ekS0WnhGHAbMYbCNL8xhTnNUuiY7bB6SllrTbk9XV3WPEcUJgkWEJM0QJSmSKEbo+Yj8BYK5h81qjeJywflcYLfbI4rkbpJIvPvIn/94UeB0OsMA7qAxud/v4TgOnNFI3MFoPMaIseQ8z1Ng3W4XvV4P/cFA5YfDocqz4fV2IyBwk+BwOOB6vSLLMiyXS+UqTlMFFoaLx78gCFSOJ3OsLYQhTQHe73ehe8L/bLVaIRXg7Xar7lIyAX3fV2BUxjsENSaTiaJN19LIlIXatQoCkiFrptOpkkoiZEnwPM9hEJmJOI5Vl81mo4o1cw24Xq/R6XQejTlbOkH+NkMHXMq/jIAX2SZl9vu2YqedrI7HoyLAO1RmsIAJzoHzYFcysW0bA9lku93GWLZNQHfqYjabiVz3ATifz9WYtCpDS+LJDpRM6ZRI5zh4sujt/Q3NZlO8gWbjXZ0N+W7I2Wq15DnZn4B6EdpyWYAvIK7rYimgv+o/8Vz9itfvL/jxbOHVquGlVsXTtyqsSgW1chkV8U9AmQHjfb5FJk8kDkMEH2+NDOv1OsqmCct6ksIKzJKJL/JtlkoPJ+Bvcp4YaH6ECeIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"OAuth2ClientAutoConfiguration\"\n        title=\"OAuth2ClientAutoConfiguration\"\n        src=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/fcda8/OAuth2ClientAutoConfiguration.png\"\n        srcset=\"/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/12f09/OAuth2ClientAutoConfiguration.png 148w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/e4a3f/OAuth2ClientAutoConfiguration.png 295w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/fcda8/OAuth2ClientAutoConfiguration.png 590w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/efc66/OAuth2ClientAutoConfiguration.png 885w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/c83ae/OAuth2ClientAutoConfiguration.png 1180w,\n/static/a9f4d666ba7fd88fbe1d616c8d1ec93e/11f80/OAuth2ClientAutoConfiguration.png 2498w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>OAuth2ClientRegistrationRepositoryConfiguration은 위에서 살펴본 부분이고</p>\n<p>OAuth2WebSecurityConfiguration을 살펴보면 InMemoryOAuth2AuthorizedClientService에서 OAuth2AuthorizedClient를 관리 한다</p>\n<p><strong>OAuth2AuthorizedClient</strong>는 인가서버로 부터 권한 부여가 되면 승인된 정보들이 저장되는데 <strong>Client정보, accessToken, refreshToken, 사용자 정보 같은 것들이 저장되고 이 객체를 Spring MVC에서 참조해 사용</strong></p>\n<h2 id=\"oauth-20-client---oauth2login\" style=\"position:relative;\"><a href=\"#oauth-20-client---oauth2login\" aria-label=\"oauth 20 client   oauth2login permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client - oauth2Login()</h2>\n<blockquote>\n<p>OAuth2.0 Client Module을 통해서 클라이언트가 인가 서버로 부터 권한 부여 받고, 사용자 인증 처리, 권한 체크까지 인증 처리</p>\n</blockquote>\n<p>oauth2.0 config 설정을 통해 http.oauth2Login()이 실행이 되면</p>\n<p>Form방식과 동일하게 OAuth2LoginConfigurer클래스가 init, configure 함수를 초기화 한다.</p>\n<p>init함수부터 먼저 살펴보면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/c02c7/OAuth2.0LoginApiInit.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACq0lEQVQoz42SWU9TYRCG+2NMjBcGAREEulGWAEElLV2gpUApBKELDSiJhhsTQH+Bool6I+VCY/wJoKWSiIal2r2np7SlLdgdCNLXOacsVyZO8nS+aXLeb+adTxDfjSLKRhBhWISYMCJUZ7NZHBz8RjaXQz6fx+aP71hfc8Lp/Io1gssOqr841uAgVlY/w+3x4OTkBALuJ51OYy+RgD/gx7qTPnQ4sLm1hWQyCa/XB4NOjQ6xFJ3NrZBIZZA0NZ8hg5jqispqzM0vgAtBsVDgO4nHYiSQwm40hlhkF4n4Hl2UQTKVwohegy5JE9pJUCiRQigu0yAU81y/UYX5hadngsUiSqUS/lCnKOEiSqenfM7ThbMzUzD06TA8OAS9fgB9Oj00VHNo+/Xolivw/MViWfDo6AiZTAZshIWHfDjH7XYjGo0iGAzBZh6HXqGAUdMHnUoNJdGj0kCp1kCl6UXX3XuYMFvAaQliNCrnYXkRBxfs7+/zC4nvJdCrVqBd2IA28ktMozaKJKirb+SpbxShsrqGv+Dw8BACl8uFFPn0r8gXipiymjCoVEJLHarUvXyH8h4VFES3vAftnV0YN5nLHRbII27kgNcLxudDiHLI5+VzmLbOhsN4NvcE0xMmzFhtsFmssBAmwmyZhGXShmHjKBZfvip7yHdBowUDATDBIAIkGvD7eTixX24P9Fo17kglaJO1QiprgYg2fr5h7lxRdROPHs9eCh4fHyNNXUbJT4ZEWJYFwzDI5bL0PpPQquVoqauFtEGE22fe3aqr572rrqnFlavXMP3g4aUgZ+ZP8pJjZ8eFbxsb2KEz5+/W9jY+ffyA90t2LNuX8Y7yEofdXj7Tf6/fvMXKyuqlIBNmYB0zwmIcgcFggG5gEP0DQ/x7Gx27zy/mf4J7z38B4GjQ7qxKKPIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"OAuth2 0LoginApiInit\"\n        title=\"OAuth2 0LoginApiInit\"\n        src=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/fcda8/OAuth2.0LoginApiInit.png\"\n        srcset=\"/static/b2be3b00365ba169ba5ecade1eaaddbe/12f09/OAuth2.0LoginApiInit.png 148w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/e4a3f/OAuth2.0LoginApiInit.png 295w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/fcda8/OAuth2.0LoginApiInit.png 590w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/efc66/OAuth2.0LoginApiInit.png 885w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/c83ae/OAuth2.0LoginApiInit.png 1180w,\n/static/b2be3b00365ba169ba5ecade1eaaddbe/c02c7/OAuth2.0LoginApiInit.png 2472w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>OAuth2LoginAuthenticationFilter 인증 필터가 생성되는데 설정한 경로로 요청이 오면 Authorization Code Grant Type 방식에서 code를 가지고 AccessToken을 발급하는 단계를 담당한다.<br>\n(default : /login/oauth2/code/*)</li>\n<li>OAuth2LoginAuthenticationProvider 는 실제로 OAuth2.0 인가서버와 통신하는 기능을 담당한다.</li>\n<li>OidcAuthorizationCodeAuthenticationProvider 는 OpenID 프로토콜을 통해 사용자 정보를 가져온다.</li>\n<li>DefaultLoginPageGeneratingFilter는 실제 로그인 페이지가 필요한데 해당 페이지를 생성해 주는 기능 담당</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/51c36e5f5079e8d277daef951fcc1af3/9aaee/LoginApiConfigure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB+0lEQVQoz4WSWW8SYRSG598YY4xx6cI2wAzDMDOQusQl3mk0GmONdxoTU7ZG7V9Q/wqjMKi9qpcieAERBqzSAB2YKcvrt7SkNVq/5Mk5c76T9z3nywidlg37exM0dn5sY/vnL7iuB8/z4Ho8ent7DHe/dhwC/nKm0ykmkwlmsxm63S4qlQpqtRozojV6x5kyaP8BAm04wh/ig8EA9XodjUYD4/EY/zvCUUcOdRqNRmg2yVN0Omi324xWqwXbtsmdi91dB44zxHA4mk/LBI9z6/V66Pf72NnpstXpt+M4/+ynwwmOM8DmBwufrDI2y2V8JLFoWbBoLJVQInnBNGGa71j+vljk9ZLFIqVQMLG19ZlPSB/7iiFhRY7hciwOQ4pBjsoIEyIkP0CMSAiKEQRCYfhDIvxBEUu+AHyBEE6fOYu79+5zwa/Vb7iUUnDd0HBNS+KGnsRVTYcST0BRNUY8oc9zCjUI75tGZQWLy348eLjKBSvVGpKGipsrGhFK4qJmIEVQiQgVUkkeI+ISmV5RuYmsqHPxhG6wyVcfPeaCXypVSBE/UtEQ9FAUCbJSlKwjBvlaFLoWneIwC0s+nLuwiPMLyzhx8hRu3b7DBW3yO2y8yOJlLodXuXVs5NdJzCObzSEzJ48MrR0incni+Voaa+kMnjx9htdv3jLB38eUnoTBHoViAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"LoginApiConfigure\"\n        title=\"LoginApiConfigure\"\n        src=\"/static/51c36e5f5079e8d277daef951fcc1af3/fcda8/LoginApiConfigure.png\"\n        srcset=\"/static/51c36e5f5079e8d277daef951fcc1af3/12f09/LoginApiConfigure.png 148w,\n/static/51c36e5f5079e8d277daef951fcc1af3/e4a3f/LoginApiConfigure.png 295w,\n/static/51c36e5f5079e8d277daef951fcc1af3/fcda8/LoginApiConfigure.png 590w,\n/static/51c36e5f5079e8d277daef951fcc1af3/efc66/LoginApiConfigure.png 885w,\n/static/51c36e5f5079e8d277daef951fcc1af3/c83ae/LoginApiConfigure.png 1180w,\n/static/51c36e5f5079e8d277daef951fcc1af3/9aaee/LoginApiConfigure.png 2608w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>configure함수를 살펴보면 OAuth2AuthorizationRequestRedirectFilter가 생성되는데 해당 필터는 Authorization Code Grant Type 방식에서 code를 발급해주는 기능 담당</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/316c06e55e75e4427c13d5d37c83353c/e16b4/LoginApiConfigurerConfig.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAChElEQVQoz22S208TQRTG+88YE19UBGGh9LrdS2tbQAkVopHAg4D/iTcuRYzRqCixaQUSTXzA+OSjoQWeGiHVtttut4G2gEBLL59nj9Hw4CRfZnfmm9+cc+ZY9KyGXDqLfEZDoWBALxRxdHyMarWG09NT5HQDO6k0Uj+z2PmRQbmyz+vVapU9Z1Wr1WBp4f+j2fyz82ntK+afvcOLxRUsPI8i+T3F661WC2fPNum/0WgQkD7MG0ulEsqmymXs7e1RtAVWLpdHPq/TWglZykbXdRiGgd3dXfZWKhXWyckJgy1/b8hqGiuTyUCjOZ1Ow2Cghu3tbRjFIookc8+c9Xye51QqhWQyyZczMKdlsRCexdP5J1ggzYXnMTM7x3r4eBovX73Gr6MjRCNLCE/PIEyeWfKYvvsPHmFzc4tBZroMXF//BqfQDtlqg13owdWubpbQ04tLbe3oG7iByv4BRu/cxpW2yxDI19EloKNTwLnzFxCJxhhkls0sn2VjI45+xY0Brx+yrECUZbg9ElyihG46PDxyi4H3piYgSzYE+33w+WX4AuQTrfj4PoZmo8n1rNfrsCQScfhFB64rXqgEdHlkONweBvb02hEaHiHgPiYn7sJDgECfDH9QIrAKh7MLH2JRNOsNLgunzECPA4OqDwFFhUpAVZIhkgRrL4ZuDnOEU5MTcDpskFQvJEWB4vVSWaxYXVllkPnKnHIisY6AaEdAViFSZKJLhOh0w+Vyc60GQyGOcHxsFHZbJxSfh2AiQV1o77iIlUjEbEpuI27sra0NDAV8CPUP4FowCK8/SIf8VKcgRalgdGwch4eHSMTjiNEDLL5ZIr3F8vIq1j5/oVbL/Wt0c/wG6beQzhXEfcEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"LoginApiConfigurerConfig\"\n        title=\"LoginApiConfigurerConfig\"\n        src=\"/static/316c06e55e75e4427c13d5d37c83353c/fcda8/LoginApiConfigurerConfig.png\"\n        srcset=\"/static/316c06e55e75e4427c13d5d37c83353c/12f09/LoginApiConfigurerConfig.png 148w,\n/static/316c06e55e75e4427c13d5d37c83353c/e4a3f/LoginApiConfigurerConfig.png 295w,\n/static/316c06e55e75e4427c13d5d37c83353c/fcda8/LoginApiConfigurerConfig.png 590w,\n/static/316c06e55e75e4427c13d5d37c83353c/efc66/LoginApiConfigurerConfig.png 885w,\n/static/316c06e55e75e4427c13d5d37c83353c/c83ae/LoginApiConfigurerConfig.png 1180w,\n/static/316c06e55e75e4427c13d5d37c83353c/e16b4/LoginApiConfigurerConfig.png 2546w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>마지막으로 Configurer가 가지고 있는 속성파일을 보면 4개의 Config를 가지고 있다</p>\n<ol>\n<li>AuthorizationEndpointConfig : code 발급 요청 시 설정 파일</li>\n<li>RedirectionEndpointConfig : 인가서버에서 클라이언트에게 코드를 발급하기 위해 redirect하는데 이 정보를 관리</li>\n<li>TokenEndpointConfig : AccessToken을 요청할 때 인가 서버에 요청하는데 이 때 사용되는 속성</li>\n<li>UserInfoEndpointConfig : AccessToken을 가지고 인가서버에서 User정보를 가지고 올 때 관련된 url나 설정 된 정보를 가지고 있는 config</li>\n</ol>\n<h3 id=\"authorization-code---주요-클래스\" style=\"position:relative;\"><a href=\"#authorization-code---%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"authorization code   주요 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Code - 주요 클래스</h3>\n<h4 id=\"1-oauth2authorizationrequestredirectfilter\" style=\"position:relative;\"><a href=\"#1-oauth2authorizationrequestredirectfilter\" aria-label=\"1 oauth2authorizationrequestredirectfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) OAuth2AuthorizationRequestRedirectFilter</h4>\n<p>-> 권한 코드 부여 흐름 시작<br>\n-> 해당 필터의 동작 조건 : AuthorizationRequestMatcher : /oauth2/authorization/{registrationId}*<br>\n-> AuthorizationEndpointConfig. authorizationRequestBaseUri 를 통해 재정의 가능</p>\n<h4 id=\"2-defaultoauth2authorizationrequestresolver\" style=\"position:relative;\"><a href=\"#2-defaultoauth2authorizationrequestresolver\" aria-label=\"2 defaultoauth2authorizationrequestresolver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) DefaultOAuth2AuthorizationRequestResolver</h4>\n<ul>\n<li>웹 요청에 대하여 <strong>OAuth2AuthorizationRequest 객체</strong> 생성</li>\n<li>/oauth2/authorization/{registrationId} 와 일치하는지 확인해서 일치하면 registrationId를 추출하고 이를 사용해서 ClientRegistration을 가져와 OAuth2AuthorizationRequest 빌드</li>\n</ul>\n<h4 id=\"3-oauth2authorizationrequest\" style=\"position:relative;\"><a href=\"#3-oauth2authorizationrequest\" aria-label=\"3 oauth2authorizationrequest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) OAuth2AuthorizationRequest</h4>\n<ul>\n<li>토큰 엔드포인트 요청 파라미터를 담은 객체로서 인가 응답을 연계하고 검증할 때 사용<br>\n(임시 코드를 받기위한 서버의 엔드 포인트)</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/90eea/OAuth2AuthorizationRequest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA40lEQVQoz22RXXKDMAyEfbA0/pEl2RjyEJp0Or3/ObYyhAlkePjGGoOs1a67jxnPoeBZG+5akUVAKsid0tGl9pTg05FrjLhcgxHx5Vfc1DJ+J8G3Dpi0oEoBsT0iL1TBdu9jWpvCDn/yoGrGY2QMbCqyTd2mh/dPG2vzkfXbu3bTQJgro5AgMCF2JC9noJW+7rbe55BPXKuEnyZg7t4xkvDiYafX3UOyc1Ht06nKPe7WCH+jYtaGRzUfzcMku0CqeWhsQ87C2eNqyZgtmNIburqX0pgNygjJ1ideQriYV4dQTvgH8S/5HyNdbmwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"OAuth2AuthorizationRequest\"\n        title=\"OAuth2AuthorizationRequest\"\n        src=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/fcda8/OAuth2AuthorizationRequest.png\"\n        srcset=\"/static/29ad66c67fa073d7914b84a4e9fe0e2b/12f09/OAuth2AuthorizationRequest.png 148w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/e4a3f/OAuth2AuthorizationRequest.png 295w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/fcda8/OAuth2AuthorizationRequest.png 590w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/efc66/OAuth2AuthorizationRequest.png 885w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/c83ae/OAuth2AuthorizationRequest.png 1180w,\n/static/29ad66c67fa073d7914b84a4e9fe0e2b/90eea/OAuth2AuthorizationRequest.png 2254w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"4-oauth2authorizationrequestrepository\" style=\"position:relative;\"><a href=\"#4-oauth2authorizationrequestrepository\" aria-label=\"4 oauth2authorizationrequestrepository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4) OAuth2AuthorizationRequestRepository</h4>\n<ul>\n<li>인가 요청을 시작한 시점부터 인가 요청을 받는 시점까지 (리다이렉트) OAuth2AuthorizationRequest 유지</li>\n</ul>\n<h3 id=\"authorization-code-grant-type---get-code\" style=\"position:relative;\"><a href=\"#authorization-code-grant-type---get-code\" aria-label=\"authorization code grant type   get code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Code Grant Type - get code</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/df5d6/AuthorizationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACH0lEQVQoz11Ty27TQBT1D0IlJNrQHVJ3qIAKrPgxYANsIsimiZLUjzh+jl+kjVO/H40P9w4kolzpaMbjM8f3nBkr6e0dtuYaW8tG7broNhu0TYu261Dz2HbIyhr3ZYO8ahDvKohNhmBzD5Hs4MUpxG0OcVdIngIMQN8BJFBttyjSFEVRoKwq5HmBisY0r2D7oYQjYgk3iLH2AjgBzxN4YYKmbVkQSKirOElQ04KmaVhcT6HN51hMpzANA0lCIrYFc7VCFAYwDB3fv33Fl8+fMPn5Q65xDcMAZb/fy4eVoeHjh3d4f3WFV68vJS7fvsHLiwssl0vJaeoaVVnCtixMZzPMCNf08SAM5XvWOgqqNwucPzvB6WiE5y/OcHo+whmNT06eYq5qklN3A6oHIM1KxFEEIQQ25K7vexxKSSk3z3Xwi2xpywVZs2FZDAs2HVYgfIRRDJvycmWGETwRkCMDc4rFcRxEJB5Slynlr7hE1C0XS8OCunZpk4BNeQVBQBDQTRsLfQ3NMKEaa9wQlgTH9eH7vhSbTCYYj8dyrrT9HnU/ECAhrVFWJWXVNg06SqSk9033l0eWq17ejWPFcSw7lZbxqIYjgS2zjR3ZyHY7CvzhP+ofLnNUVZXgTBU+6n/Blec5DofFgXPwvufLDWyTRTq6t1xsk8V0XYfneY87PAgymS80W8+yDIKIBt3PlWnKjdw9rzcUCWft0h/GYjz/DbLuJ5IS+pcYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AuthorizationFlow\"\n        title=\"AuthorizationFlow\"\n        src=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/fcda8/AuthorizationFlow.png\"\n        srcset=\"/static/1e9b26d94d0f831a9d50a3887ee907ec/12f09/AuthorizationFlow.png 148w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/e4a3f/AuthorizationFlow.png 295w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/fcda8/AuthorizationFlow.png 590w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/efc66/AuthorizationFlow.png 885w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/c83ae/AuthorizationFlow.png 1180w,\n/static/1e9b26d94d0f831a9d50a3887ee907ec/df5d6/AuthorizationFlow.png 2514w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>oauth2/authorization/{registrationId}로 request 요청이 오면 <strong>OAuth2AuthorizationRequestRedirectFilter</strong>가 받고 DefaultOAuth2AuthorizationRequestResolver가 요청 정보와 가지고 있는 requestMatcher값을 비교</li>\n<li>값이 동일하면 /login/oauth2/code/{registrationId} 경로를 생성 하면서 OAuth2AutorizationRequest객체 생성</li>\n<li>OAuth2AutorizationRequest 객체를 세션에 저장<br>\n(세션을 사용하지 않을 경우 쿠키에 저장해서 참조하도록 repository 객체 재정의 가능)</li>\n<li>\n<p>인가서버에서 검증 후 code와 state값을 담아 반환한다.</p>\n<ul>\n<li>1번에서 값이 동일하지 않을경우 AuthenticationEntryPoint에 설정된 Url로 이동 ()</li>\n</ul>\n</li>\n</ol>\n<p>요약하면 Authorization Code Grant Type 첫번째 code를 받는 기능을 담당하는 Filter가<br>\n<strong>OAuth2AuthorizationRequestRedirectFilter</strong></p>\n<h3 id=\"authorization-accesstoken-주요-클래스\" style=\"position:relative;\"><a href=\"#authorization-accesstoken-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"authorization accesstoken 주요 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization AccessToken 주요 클래스</h3>\n<h4 id=\"1-oauth2loginauthenticationfilter\" style=\"position:relative;\"><a href=\"#1-oauth2loginauthenticationfilter\" aria-label=\"1 oauth2loginauthenticationfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1) OAuth2LoginAuthenticationFilter</h4>\n<ul>\n<li>인가서버로부터 리다이렉트 되면서 전달된 code 를 인가서버의 Access Token 으로 교환</li>\n<li>Access Token 이 저장된 OAuth2LoginAuthenticationToken을 AuthenticationManager에 위임하여 UserInfo 정보를 요청해서 최종 사용자에 로그인</li>\n<li>OAuth2AuthorizedClientRepository를 사용하여 OAuth2AuthorizedClient 를 저장한다.</li>\n<li>인증에 성공 시 OAuth2AuthenticationToken 이 생성, SecurityContext에 저장되며 인증 처리를 완료</li>\n<li>/login/oauth2/code/*로 url이 매핑된다</li>\n</ul>\n<h4 id=\"2-oauth2loginauthenticationprovider\" style=\"position:relative;\"><a href=\"#2-oauth2loginauthenticationprovider\" aria-label=\"2 oauth2loginauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2) OAuth2LoginAuthenticationProvider</h4>\n<ul>\n<li>Access Token 으로 교환하고 이 토큰을 사용하여 UserInfo 처리를 담당</li>\n<li>Scope 에 openid 유,무에 따라 OAuth처리 Provider, OpenId처리 Provider 호출</li>\n</ul>\n<h4 id=\"3-oauth2authorizationcodeauthenticationprovider\" style=\"position:relative;\"><a href=\"#3-oauth2authorizationcodeauthenticationprovider\" aria-label=\"3 oauth2authorizationcodeauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3) OAuth2AuthorizationCodeAuthenticationProvider</h4>\n<ul>\n<li>권한 코드 부여 흐름을 처리하는 AuthenticationProvider</li>\n<li>인가서버에 Authorization Code 와 AccessToken 의 교환을 담당하는 클래스</li>\n</ul>\n<h4 id=\"4-oidcauthorizationcodeauthenticationprovider\" style=\"position:relative;\"><a href=\"#4-oidcauthorizationcodeauthenticationprovider\" aria-label=\"4 oidcauthorizationcodeauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4) OidcAuthorizationCodeAuthenticationProvider</h4>\n<ul>\n<li>OpenID Connect Core 1.0 권한 코드 부여 흐름을 처리하는 AuthenticationProvider 이며 요청 Scope 에 openid 가 존재할 경우 실행</li>\n</ul>\n<h4 id=\"5-defaultauthorizationcodetokenresponseclient\" style=\"position:relative;\"><a href=\"#5-defaultauthorizationcodetokenresponseclient\" aria-label=\"5 defaultauthorizationcodetokenresponseclient permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5) DefaultAuthorizationCodeTokenResponseClient</h4>\n<ul>\n<li>인가서버의 token 엔드 포인트로 통신을 담당하며 AccessToken 을 받은 후 OAuth2AccessTokenResponse 에 저장하고 반환한다</li>\n</ul>\n<h3 id=\"authorization-code-grant-type---get-accesstoken\" style=\"position:relative;\"><a href=\"#authorization-code-grant-type---get-accesstoken\" aria-label=\"authorization code grant type   get accesstoken permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization Code Grant Type - get AccessToken</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/ba40d/AccessTokenFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACdElEQVQoz11SaU8TURSdn4UJLjEqEqP8IMI/UIhEYwxf3DCKCh8wghqMULClxgqly7R0mc7amWE6S6eztJ0e75uGL97kzJ0z89695573OKtn42I4hodpdDUVlWoVtVodVZ4n1BDH0fTneAhMxulrkiRIJhNcRpJMEA+H4Fzfh/XyBazFRVhU6OHKMq7MzODW3Dxmr9/A3N155P4UsX1Uwvr2Pt7tZvEtz0OUZDQbDfDUkKfG7baAIAjA+fTora/DWlrCSNXw9PkzXLs6i3sPFnDz9h3cX1hA4ayK/VOB0MbPkxYyRQGSrCCXy2Fvby/NDSqeFsR/4dg2FEWBJEmkQoJM72lMRogGfcShn9LBYIBWqwVBECCKIlRVRRiG4BzHQZdIrVyGTAUYZ/IrlQpKpRKazSbxNorFMxwf55HP/069ZQ1ZwXq9noIVThW6rpt2Y4Usy4JhGDB0HbqmQBRauDC6cB0bntdHvz8F28Og0zpZltOJ2P7RaARuSCfDPpimiSZ1lGUJmtnD1sEZ3n7N4c1ODrWOBlPv4px8YqpYU6aQqWfeMXWXnIuiCD3yjY11Tqcs0gata+BH9hTfs0XsHP5FtSHA96fKbFrLMlNkMxBnRctkGZuQG8ZxajLLIY2ejEfsUiEJ+nTlYjqLGIHnwKexHYKqKuiQIsPQIXY6pKpBfpdRKBRS9ZxlU1fPhx/G8IOIcoQoHsIbhHD9AB7BcfvQDROy2iVoaAoiZE1HuVpDha9D0ch382Kq8PVuHsvv97H6MYOVjQOsbR/j1wlP/IBwiMcfKH/KYHXzCGuf83j1JUv8CE+2CJsMh3i0kUHmtJlO+g+7Ug6j0LzVHgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AccessTokenFlow\"\n        title=\"AccessTokenFlow\"\n        src=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/fcda8/AccessTokenFlow.png\"\n        srcset=\"/static/c87dd2a73622aa1c29b0013bc9e3e2a1/12f09/AccessTokenFlow.png 148w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/e4a3f/AccessTokenFlow.png 295w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/fcda8/AccessTokenFlow.png 590w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/efc66/AccessTokenFlow.png 885w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/c83ae/AccessTokenFlow.png 1180w,\n/static/c87dd2a73622aa1c29b0013bc9e3e2a1/ba40d/AccessTokenFlow.png 2524w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>code를 받아오면 <strong>OAuth2LoginAuthenticationFilter</strong> 실행</li>\n<li>OAuth2AuthorizationRequest(세션에 저장 된), OAuth2AccessTokenResponse(인가 서버로 부터 받은)를 가진 OAuth2LoginTuthenticationToken을 저장</li>\n<li><strong>OAuth2LoginAuthenticationProvider</strong>에서 AccessToken을 가져옴(/token)</li>\n<li>가져온 OAuth2AuthorizationCodeAuthentication Token을 사용해 <strong>DefaultOAuth2UserService</strong>에서 인가서버로 부터 사용자 정보를 가져온다.</li>\n</ol>\n<p>추가로</p>\n<ul>\n<li>Code 가지고 있는 객체는 RequestEntity<OAuth2AuthorizationRequest></li>\n<li>AccessToken가지고 있는 객체는 ResponseEntity<OAuth2AccessTokenResponse></li>\n</ul>\n<h3 id=\"oauth2userservice\" style=\"position:relative;\"><a href=\"#oauth2userservice\" aria-label=\"oauth2userservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2UserService</h3>\n<blockquote>\n<p>AccessToken을 사용해 리소스 소유자의 정보를 가져오며 OAuth2User타입의 객체를 리턴한다.</p>\n</blockquote>\n<ul>\n<li>구현체는 <strong>DefaultOAuth2UserService와 OidcUserService</strong>가 있다.</li>\n</ul>\n<h4 id=\"defaultoauth2userservice\" style=\"position:relative;\"><a href=\"#defaultoauth2userservice\" aria-label=\"defaultoauth2userservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DefaultOAuth2UserService</h4>\n<blockquote>\n<p>표준 OAuth2.0 Provider를 지원하는 구현체</p>\n</blockquote>\n<ul>\n<li>\n<p>OAuth2User 반환</p>\n<ul>\n<li>OAuth2.0 Provider에 연결된 사용자 주체</li>\n<li>사용자 인증정보를 가지고 있다 (name, email, phone number, address)</li>\n<li>기본 구현체는 <strong>DefaultOAuth2User</strong>이며 Authentication principal에 저장</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"oidcuserservice\" style=\"position:relative;\"><a href=\"#oidcuserservice\" aria-label=\"oidcuserservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OidcUserService</h4>\n<blockquote>\n<p>OpenID Connect 1.0 Provider를 지원하는 구현체</p>\n</blockquote>\n<ul>\n<li>OidcUserRequest의 ID Token을 통해 인증처리, 필요 시 DefaultOAuth2UserService 사용</li>\n<li>\n<p>OidcUser타입 반환</p>\n<ul>\n<li>최종 사용자의 인증 정보인 Claims을 포함</li>\n<li>기본 구현체는 <strong>DefaultOidcUser</strong> 이며 인증 이후 Authentication principal에 저장</li>\n<li>ID토큰은 개인키로 서명이 되어있기 때문에 정해진 알고리즘을 통해 검증하고 Oidc 객체를 생성해야 한다.</li>\n</ul>\n</li>\n</ul>\n<!-- TODO: Flow나중에 정리 OAuth2 로그인 구현 - Oauth 2.0 User 모델 소개(1) 10분 경-->\n<p>여기까진 Login 과정으로 SecurityConfig에</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">oauth2SecurityFilterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>requests<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> requests<span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">oauth2Login</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Customizer</span><span class=\"token punctuation\">.</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>으로 실행된다</p>\n<h3 id=\"openid-logout\" style=\"position:relative;\"><a href=\"#openid-logout\" aria-label=\"openid logout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenID Logout</h3>\n<ul>\n<li>클라이언트는 로그아웃 엔드포인트를 사용하여 웹 브라우저에 대한 세션과 쿠키를 지운다.</li>\n<li>클라이언트 로그아웃 성공 후 OidcClientInitiatedLogoutSuccessHandler 를 호출하여 OpenID Provider 세션 로그아웃 요청</li>\n<li>OpenID Provider 로그아웃이 성공하면 지정된 위치로 리다이렉트 한다</li>\n<li>로그아웃 엔드 포인트는 end<em>session</em>endpoint 로 정의되어 있다</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span><span class=\"token punctuation\">(</span>proxyBeanMethods <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OAuth2ClientConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ClientRegistrationRepository</span> clientRegistrationRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">oauth2SecurityFilterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>requests<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> requests<span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">oauth2Login</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Customizer</span><span class=\"token punctuation\">.</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">logoutSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token function\">oidcLogoutSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">invalidateHttpSession</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">clearAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">deleteCookies</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"JSESSIONID\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OidcClientInitiatedLogoutSuccessHandler</span> <span class=\"token function\">oidcLogoutSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">OidcClientInitiatedLogoutSuccessHandler</span> successHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OidcClientInitiatedLogoutSuccessHandler</span><span class=\"token punctuation\">(</span>clientRegistrationRepository<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        successHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setPostLogoutRedirectUri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:8081/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> successHandler<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"mvc에서-인증-객체-참조-방법\" style=\"position:relative;\"><a href=\"#mvc%EC%97%90%EC%84%9C-%EC%9D%B8%EC%A6%9D-%EA%B0%9D%EC%B2%B4-%EC%B0%B8%EC%A1%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"mvc에서 인증 객체 참조 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MVC에서 인증 객체 참조 방법</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token comment\">// 1.Authentication 객체로 전달 받기</span>\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OAuth2User</span> <span class=\"token function\">user</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">OAuth2User</span> oAuth2User <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2User</span><span class=\"token punctuation\">)</span>authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 2. ContextHolder에서 꺼내오기</span>\n        <span class=\"token class-name\">OAuth2AuthenticationToken</span> oAuth2AuthenticationToken <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2AuthenticationToken</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">OAuth2User</span> oAuth2User2 <span class=\"token operator\">=</span> oAuth2AuthenticationToken<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"oAuth2User = \"</span> <span class=\"token operator\">+</span> oAuth2User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"oAuth2User2 = \"</span> <span class=\"token operator\">+</span> oAuth2User2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> oAuth2User<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 3. AuthenticationPrincipal 어노테이션 사용</span>\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/oauth2User\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OAuth2User</span> <span class=\"token function\">oauth2User</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@AuthenticationPrincipal</span> <span class=\"token class-name\">OAuth2User</span> oAuth2User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"oAuth2User = \"</span> <span class=\"token operator\">+</span> oAuth2User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> oAuth2User<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/oidcUser\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OidcUser</span> <span class=\"token function\">oidcUser</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@AuthenticationPrincipal</span> <span class=\"token class-name\">OidcUser</span> oidcUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"oidcUser = \"</span> <span class=\"token operator\">+</span> oidcUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> oidcUser<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"oauth2-custom\" style=\"position:relative;\"><a href=\"#oauth2-custom\" aria-label=\"oauth2 custom permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2 Custom</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2393551ef5697134cc345fe5c421cd12/a01dc/oauth2configurer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.351351351351354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAx0lEQVQY02WQaa4DIQyDe50CQza26bz7X8sN6aJK78cnS8QxhpuqoXHG0oRzCuZ1Yf1dGOuB0QyrKfpcmOcjzsT95TjALCBmEHFoJUIpBTcSAxUPpDuGCvo4MeaLPia6DZh21xk0s6D7fO5L375afwL5yOiUoHTAmge0Hk2UHTJIFcdn1p0WHN4y5/wlpRT6bpjQ6t0DKmQveKC6imiERajD3mJ79Nej+j+Qa3k1dPM2tj7CHA0dY18k+c7N5xv2v9sh+6kffQLw952K9fbJHQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"oauth2configurer\"\n        title=\"oauth2configurer\"\n        src=\"/static/2393551ef5697134cc345fe5c421cd12/fcda8/oauth2configurer.png\"\n        srcset=\"/static/2393551ef5697134cc345fe5c421cd12/12f09/oauth2configurer.png 148w,\n/static/2393551ef5697134cc345fe5c421cd12/e4a3f/oauth2configurer.png 295w,\n/static/2393551ef5697134cc345fe5c421cd12/fcda8/oauth2configurer.png 590w,\n/static/2393551ef5697134cc345fe5c421cd12/efc66/oauth2configurer.png 885w,\n/static/2393551ef5697134cc345fe5c421cd12/c83ae/oauth2configurer.png 1180w,\n/static/2393551ef5697134cc345fe5c421cd12/a01dc/oauth2configurer.png 2006w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>oauth2LoginConfig 설정 클래스를 살펴보면 4개의 하위 config설정 클래스가 있다.</p>\n<p>이 설정 클래스들의 값을 변경하면 requestMatcher가 요청을 처리할 url경로를 변경할 수 있다.</p>\n<h4 id=\"authorizationbaseurl--redirectionbaseurl-변경\" style=\"position:relative;\"><a href=\"#authorizationbaseurl--redirectionbaseurl-%EB%B3%80%EA%B2%BD\" aria-label=\"authorizationbaseurl  redirectionbaseurl 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthorizationBaseUrl &#x26; RedirectionBaseUrl 변경</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9e49f1066248f14055a6f339b0c9d78/8f1fd/AuthorizationBaseUrlRedirectionBaseUrl.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.08108108108108%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA60lEQVQY042RW7NDQBCE/f9/l0dBnBC3ciu7CEu2z/TiOZmqrqVm9NezvGEYEAQBwjB0J+X7PqqqQt/3eD4eeN5uiEV/9zvyPIdSCkVRIIoiRHGMJMvwwVGeMQbjOGKaJqd5nt37uq7HxEdGtQLmCZDZq9gfxLgVwFTXsO/3Yai1dmkyoVBJkjh613VYlgXsa4EogWjRBdv3HWbbYEYNiBkNLQ3ZrIWQpqlbp2ka8BqYVEsCwqoiR/l6oSxL1yeIm/FbrmpPwVp4V3wmo9q2xSbkn0tMrIinW9meD/wBTMi05rwrew5/0zXL+geSu84hmocV6wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AuthorizationBaseUrlRedirectionBaseUrl\"\n        title=\"AuthorizationBaseUrlRedirectionBaseUrl\"\n        src=\"/static/d9e49f1066248f14055a6f339b0c9d78/fcda8/AuthorizationBaseUrlRedirectionBaseUrl.png\"\n        srcset=\"/static/d9e49f1066248f14055a6f339b0c9d78/12f09/AuthorizationBaseUrlRedirectionBaseUrl.png 148w,\n/static/d9e49f1066248f14055a6f339b0c9d78/e4a3f/AuthorizationBaseUrlRedirectionBaseUrl.png 295w,\n/static/d9e49f1066248f14055a6f339b0c9d78/fcda8/AuthorizationBaseUrlRedirectionBaseUrl.png 590w,\n/static/d9e49f1066248f14055a6f339b0c9d78/efc66/AuthorizationBaseUrlRedirectionBaseUrl.png 885w,\n/static/d9e49f1066248f14055a6f339b0c9d78/c83ae/AuthorizationBaseUrlRedirectionBaseUrl.png 1180w,\n/static/d9e49f1066248f14055a6f339b0c9d78/8f1fd/AuthorizationBaseUrlRedirectionBaseUrl.png 2528w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Authorization Code Grant Type 로그인 과정에서</p>\n<p>code를 받아올 때 사용하는 base url과 code를 받아온 후 App으로 리다이렉트 해주는 redirection base url을 변경 할 수 있다.</p>\n<ol>\n<li>config 설정 파일에 oauth2LoginConfig 설정 변경, yml파일에 등록한 client redirect-uri 변경</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// application.yml</span>\nredirect<span class=\"token operator\">-</span>uri<span class=\"token operator\">:</span> http<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">:</span><span class=\"token number\">8081</span><span class=\"token operator\">/</span>login<span class=\"token operator\">/</span>v1<span class=\"token operator\">/</span>oauth2<span class=\"token operator\">/</span>code<span class=\"token operator\">/</span>keycloak\n\n<span class=\"token comment\">// Config</span>\n        http\n                <span class=\"token punctuation\">.</span><span class=\"token function\">oauth2Login</span><span class=\"token punctuation\">(</span>oauth2 <span class=\"token operator\">-></span> oauth2\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//                        .loginProcessingUrl(\"/login/v1/oauth2/code/*\")</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">authorizationEndpoint</span><span class=\"token punctuation\">(</span>authorizationEndpointConfig <span class=\"token operator\">-></span>\n                                authorizationEndpointConfig<span class=\"token punctuation\">.</span><span class=\"token function\">baseUri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/oauth2/v1/authorization\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">redirectionEndpoint</span><span class=\"token punctuation\">(</span>redirectionEndpointConfig <span class=\"token operator\">-></span>\n                                redirectionEndpointConfig<span class=\"token punctuation\">.</span><span class=\"token function\">baseUri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login/v1/oauth2/code/*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"2\">\n<li>인가 서버의 valid post logout redirect url 설정 추가</li>\n</ol>\n<h4 id=\"pcke-사용\" style=\"position:relative;\"><a href=\"#pcke-%EC%82%AC%EC%9A%A9\" aria-label=\"pcke 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PCKE 사용</h4>\n<p>pcke방식 grant type을 설정하려면 Code Challenge를 암호화 해서 사용해야 하는데 OAuth2AuthorizationRequestResolver를 상속받은 구현체를 만들어 resolve함수를 custom 해야한다.</p>\n<p>resolve 로직을 간단히 요약하면 request 요청에 registrationId를 <strong>keycloakWithPKCE</strong>(yml 파일에서 해당 이름으로 매칭 시켜 놓음) 값이 있을 경우에 대한 분기처리를 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// config</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">oauth2SecurityFilterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>requests<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> requests<span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/home\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">oauth2Login</span><span class=\"token punctuation\">(</span>authLogin <span class=\"token operator\">-></span>\n                authLogin<span class=\"token punctuation\">.</span><span class=\"token function\">authorizationEndpoint</span><span class=\"token punctuation\">(</span>authEndpoint <span class=\"token operator\">-></span>\n                        authEndpoint<span class=\"token punctuation\">.</span><span class=\"token function\">authorizationRequestResolver</span><span class=\"token punctuation\">(</span><span class=\"token function\">customOAuth2AuthenticationRequestResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logoutSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/home\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OAuth2AuthorizationRequestResolver</span> <span class=\"token function\">customOAuth2AuthenticationRequestResolver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomOAuth2AuthorizationRequestResolver</span><span class=\"token punctuation\">(</span>clientRegistrationRepository<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/oauth2/authorization\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// CustomOAuth2AuthorizationRequestResolver</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomOAuth2AuthorizationRequestResolver</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">OAuth2AuthorizationRequestResolver</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CustomOAuth2AuthorizationRequestResolver</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClientRegistrationRepository</span> clientRegistrationRepository<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> authorizationRequestBaseUri<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clientRegistrationRepository <span class=\"token operator\">=</span> clientRegistrationRepository<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authorizationRequestMatcher <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AntPathRequestMatcher</span><span class=\"token punctuation\">(</span>\n                authorizationRequestBaseUri <span class=\"token operator\">+</span> <span class=\"token string\">\"/{\"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">REGISTRATION_ID_URI_VARIABLE_NAME</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        defaultResolver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultOAuth2AuthorizationRequestResolver</span><span class=\"token punctuation\">(</span>clientRegistrationRepository<span class=\"token punctuation\">,</span> authorizationRequestBaseUri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OAuth2AuthorizationRequest</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> registrationId <span class=\"token operator\">=</span> <span class=\"token function\">resolveRegistrationId</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>registrationId <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token class-name\">ClientRegistration</span> clientRegistration <span class=\"token operator\">=</span> clientRegistrationRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByRegistrationId</span><span class=\"token punctuation\">(</span>registrationId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>registrationId<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"keycloakWithPKCE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">OAuth2AuthorizationRequest</span> oAuth2AuthorizationRequest <span class=\"token operator\">=</span> defaultResolver<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">customResolve</span><span class=\"token punctuation\">(</span>oAuth2AuthorizationRequest<span class=\"token punctuation\">,</span> clientRegistration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> defaultResolver<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OAuth2AuthorizationRequest</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> clientRegistrationId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">ClientRegistration</span> clientRegistration <span class=\"token operator\">=</span> clientRegistrationRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByRegistrationId</span><span class=\"token punctuation\">(</span>clientRegistrationId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>clientRegistrationId<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"keycloakWithPKCE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">OAuth2AuthorizationRequest</span> oAuth2AuthorizationRequest <span class=\"token operator\">=</span> defaultResolver<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">customResolve</span><span class=\"token punctuation\">(</span>oAuth2AuthorizationRequest<span class=\"token punctuation\">,</span> clientRegistration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> defaultResolver<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span>clientRegistrationId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OAuth2AuthorizationRequest</span> <span class=\"token function\">customResolve</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2AuthorizationRequest</span> authorizationRequest<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ClientRegistration</span> clientRegistration<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> extraParam <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        extraParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"customName1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"customValue1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        extraParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"customName2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"customValue2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        extraParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"customName3\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"customValue3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">OAuth2AuthorizationRequest<span class=\"token punctuation\">.</span>Builder</span> builder <span class=\"token operator\">=</span> <span class=\"token class-name\">OAuth2AuthorizationRequest</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>authorizationRequest<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">additionalParameters</span><span class=\"token punctuation\">(</span>extraParam<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">;</span>\n        <span class=\"token constant\">DEFAULT_PKCE_APPLIER</span><span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span>builder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"oauth-20-client---oauth2client\" style=\"position:relative;\"><a href=\"#oauth-20-client---oauth2client\" aria-label=\"oauth 20 client   oauth2client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Client - oauth2Client()</h2>\n<ul>\n<li>OAuth2AuthorizedClient 는 인가받은 클라이언트를 의미하는 클래스</li>\n<li>OAuth2AuthorizedClient 는 AccessToken 과 RefreshToken 을 ClientRegistration (클라이언트)와 권한을 부여한 최종 사용자인 Principal과 함께 묶는다.</li>\n<li>OAuth2AuthorizedClient 의 AccessToken 을 사용해서 리소스 서버의 자원에 접근, 인가서버와의 통신으로 토큰을 검증</li>\n</ul>\n<!-- TODO: 이거 어떤거 말하는지 확인해야 함\nOAuth2.0 Login() 인증, 인가 포함\nOAuth2.0 Client() 인가처리는 가능하지만 최종 사용자의 인증은 처리 x -->\n<h3 id=\"oauth20-client-주요-클래스\" style=\"position:relative;\"><a href=\"#oauth20-client-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"oauth20 client 주요 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2.0 Client 주요 클래스</h3>\n<h4 id=\"authorizationcodegrantconfigurer\" style=\"position:relative;\"><a href=\"#authorizationcodegrantconfigurer\" aria-label=\"authorizationcodegrantconfigurer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthorizationCodeGrantConfigurer</h4>\n<blockquote>\n<p>해당 클래스는 위에서 코드를 받아오기 위한 3개의 클래스를 생성하고, 추가로 accessToken을 받아오기 위한 <strong>OAuth2AuthorizationCodeGrantFilter</strong>도 생성</p>\n</blockquote>\n<h4 id=\"oauth2authorizedclientrepository\" style=\"position:relative;\"><a href=\"#oauth2authorizedclientrepository\" aria-label=\"oauth2authorizedclientrepository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2AuthorizedClientRepository</h4>\n<blockquote>\n<p>다른 웹 요청이 와도 동일한 OAuth2AuthorizedClient 를 유지하는 역할</p>\n</blockquote>\n<h4 id=\"oauth2authorizedclientservice\" style=\"position:relative;\"><a href=\"#oauth2authorizedclientservice\" aria-label=\"oauth2authorizedclientservice permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2AuthorizedClientService</h4>\n<blockquote>\n<p>OAuth2AuthorizedClientService 는 어플리케이션 레벨에서 OAuth2AuthorizedClient 를 관리(저장, 조회, 삭제 )</p>\n</blockquote>\n<h4 id=\"oauth2authorizedclientmanager\" style=\"position:relative;\"><a href=\"#oauth2authorizedclientmanager\" aria-label=\"oauth2authorizedclientmanager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2AuthorizedClientManager</h4>\n<blockquote>\n<p>OAuth2AuthorizedClient 를 전반적으로 관리하는 인터페이스</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/3a4f1/OAuth2AuthorizedClientManagerStructure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7ElEQVQoz3VS25LSQBTM//+HL5b6YLlblg+CIFflugRIAuGWQEjYEK4JyULbZ1Ypyyqn0nXOTGb69OkZbbPZII5jyLjdbrgSMqJDjMeahYeqgYeaicf6a/6pauK77iDNsvuZv4eG/wwh/Fge4n2+i7dfW3iX7+DDtye8+fIDn2sGkuSiyP6FlqapUpgkyR2Xy0VKk/aKW5b8LnHll97zw36PyWSC0WiE8XgM0zThui601WqFRqOBcrmMUqmkIHNZP8cJXq5XZYPgeDojTjO8kDJh0aduF5VKBfV6XZ0Tcu14PGKxWKDX66HdbqPVaqHf78P3ffxRr0AC8TuwLES2DZeq7OkUz9stdocDdrud2qc5joNms6nIOp0OuqwqeRiGCg7bWC2XCKjYY+GpYcAmzOEAY5Jv+C9cr+Hx/zaKoJ1OJ+i6jmKxqFAoFFT7S250WUynWosEcxZxGz9hEE3mQ67NzNf1GbvSKcYjsSZtzOdziFKBtC9RConxFlXYsxkcwmce0KcRY8gW9+czAnbhixVBgDPnmud5qFaryOfzyOVy9yikS7ZhUr1vDLGk0iExYUF7MMCKnvuMU96ucBzoo4jQMj7QNaXKE5Drl5uSPKLZ4uFavOGBiHskl8t65nxLb0PXgS+R++RC5Ln9ApwM336Nfy/vAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"OAuth2AuthorizedClientManagerStructure\"\n        title=\"OAuth2AuthorizedClientManagerStructure\"\n        src=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/fcda8/OAuth2AuthorizedClientManagerStructure.png\"\n        srcset=\"/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/12f09/OAuth2AuthorizedClientManagerStructure.png 148w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/e4a3f/OAuth2AuthorizedClientManagerStructure.png 295w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/fcda8/OAuth2AuthorizedClientManagerStructure.png 590w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/efc66/OAuth2AuthorizedClientManagerStructure.png 885w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/c83ae/OAuth2AuthorizedClientManagerStructure.png 1180w,\n/static/5af5b1ec20b16ab5cc0bd2d0c1571b13/3a4f1/OAuth2AuthorizedClientManagerStructure.png 2588w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>Client Credentials Flow, Resource Owner Password Flow, Refresh Token Flow 3개의 권한 부여 방식 사용</li>\n<li>OAuth2AuthorizedClientService 나 OAuth2AuthorizedClientRepository 에 OAuth2AuthorizedClient 저장을 위임한 후 OAuth2AuthorizedClient 최종 반환</li>\n<li>HttpServletRequest는 DefaultOAuth2AuthorizedClientManager 클래스가 처리</li>\n<li>데몬, 백그라운드 실행 시 AuthorizedClientServiceOAuth2AuthorizedClientManager 클래스가 처리</li>\n</ul>\n<h3 id=\"oauth2-client---resource-owner-password-flow\" style=\"position:relative;\"><a href=\"#oauth2-client---resource-owner-password-flow\" aria-label=\"oauth2 client   resource owner password flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth2 client - Resource Owner Password Flow</h3>\n<h4 id=\"인증-처리\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D-%EC%B2%98%EB%A6%AC\" aria-label=\"인증 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증 처리</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/81a70/ResourceOwnerPasswordFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACFklEQVQoz21S227aQBD1l0Vq1KaKVPUn+tCn/lTf+lApKiGRKpJIlWpjcACDiZMANgkYY67GYOP76exCI+Uy1tHZnV3PmZkdwXYmGI0dDKwRRrYD110hDENChDCKEO0Rky/ehnvePl9HMeI44fcEx7Zhdjp4fHyA4zjQdR3lchmiJGG5XIJZmmbYui4COg/ovk8IJhMEsxmC8Rg+nW2ZQBxD8DYb+KSU5jkPYNPlfr8P0zTh+z7+W7fXgyTLqFSrkAlVReFrpVaDXKlAof2MBISVZWF2dwt3OIS/XmM6ncIiH+NnRoJZmiLPdmDrhDLiSBIqO+IsgFKGfgMKj5Qca8qYBZzP5zxjl8phWLgePD/EOoie+C0TcqacZXzDHmMwGPCSGVjQDWuJv0G784ALWUNJUolbKDfukdI5FgvkDCSeex4FZNVw0Jfn++p2Ioxz5E/q04mDtqbBMA1kW+pvo47sWgG0FtBsgrLYZfgSb5luWPjxW8bPEuGCHqPdA2+Xt0JCSKktGY2Q8DIQ4zqp/rm8hCiKqDcaNEo3UPUuTkoSrioaTq6u8b34F2LbwCZKaI7HMCi7hB7qVUDm/Pb1C44ODnB49BHv3n/A8afPkOUy2i0VptGFpKho3BqQ1Ts0SWhsj/iYha8y3LNBM3dWLKJweopfhQLOzs/Rammo1epQ1SaW9Agja0jBe7inket0unxk2L//AIRML022Vc1KAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ResourceOwnerPasswordFlow\"\n        title=\"ResourceOwnerPasswordFlow\"\n        src=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/fcda8/ResourceOwnerPasswordFlow.png\"\n        srcset=\"/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/12f09/ResourceOwnerPasswordFlow.png 148w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/e4a3f/ResourceOwnerPasswordFlow.png 295w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/fcda8/ResourceOwnerPasswordFlow.png 590w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/efc66/ResourceOwnerPasswordFlow.png 885w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/c83ae/ResourceOwnerPasswordFlow.png 1180w,\n/static/57a77bcad0d9dde9d9d1fcd5a084bb0d/81a70/ResourceOwnerPasswordFlow.png 2616w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Resource Owner Password 인증을 살펴보면</p>\n<ol>\n<li>인증하는데 필요한 요청 정보를 <strong>OAuth2AuthorizeRequest</strong>에 담아 ClientManager로 보낸다.</li>\n<li>OAuth2AuthorizedClient 객체가 있는지 확인</li>\n<li>OAuth2AuthorizedClient가 없을 경우 OAuth2AutorizationContext객체를 생성해 <strong>PasswordOAuth2AuthorizedClientProvider 전달하고 클라이언트 인가 처리</strong></li>\n<li>AccessToken과 RefreshToken 로직 분기 처리 후 필요 시 인가 서버로 <strong>DefaultPasswordTokenResponseClient</strong>클래스를 사용해 처리</li>\n</ol>\n<h4 id=\"인가처리\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EA%B0%80%EC%B2%98%EB%A6%AC\" aria-label=\"인가처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인가처리</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a40c5f428b7f514365c30a795950de4a/9dbdb/restAuthorizationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCklEQVQoz5WSW08TURSF54f4wJs++GBiUyo2gTQG5dkXfoJRf4gxvhSofdAGjRdsNMYLBYlBowgt2g7jtFClQGltYKZlbC30fvmcc7yEGLytZOXs7HOy9t7rbKX0pYxgrVanXq/Ls9VqYVmfqVSrNBpNavVvd39i7TuVbrdLp9Oh3W5LIRFbOzssJ+JsrK/RbDYREHnx9nf8AYUDsGWYvJgLE9USstDfIAQbjYbsVHn08AEjXi+jvquMjPm4HgiQyRk8fxPjXXxVjiwelstl2W3VtqFYLNqWWDJutVtyss3MJrlcDuXi+XO4XC7cAx7c/QMMDg2xtpHmdUQl9n5Zdig6MAyDUqkkRU3TJJ/PU6lUpD2i2N7uLoVCAeWCLdh7wsnJgX6cfX30ezy8XNQIzevMRj+wEI5wPxjk7r0gt27fYcI+o9EoM9Mhbo7fwOf3c82eKjA+TkxVUcLhBUKTk0xOTfH4yVOmn82QXP/ERGiOtytZ/H4fDocDz+BpTg2ewdXn5tLlKwwPn+Xw0SMcczo47urlUE8P3tGxgz6la//uOvPzEXQ9TjK5wkY6TTabJWNzM5Nhx/YvlUqhx3XiiYTkkqZJW5T9KyMgfNCWVBK6hq6pGNvb/A+UX3dJCMcSH5l5tcjsgkreKoq9kEVF8f0Uuf0UOeWgBc2ZFsn0FqtZk71q4+eu/Qu/AnDRDOXgKRVeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"restAuthorizationFlow\"\n        title=\"restAuthorizationFlow\"\n        src=\"/static/a40c5f428b7f514365c30a795950de4a/fcda8/restAuthorizationFlow.png\"\n        srcset=\"/static/a40c5f428b7f514365c30a795950de4a/12f09/restAuthorizationFlow.png 148w,\n/static/a40c5f428b7f514365c30a795950de4a/e4a3f/restAuthorizationFlow.png 295w,\n/static/a40c5f428b7f514365c30a795950de4a/fcda8/restAuthorizationFlow.png 590w,\n/static/a40c5f428b7f514365c30a795950de4a/efc66/restAuthorizationFlow.png 885w,\n/static/a40c5f428b7f514365c30a795950de4a/c83ae/restAuthorizationFlow.png 1180w,\n/static/a40c5f428b7f514365c30a795950de4a/9dbdb/restAuthorizationFlow.png 2622w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>인증 처리가 끝나면 위와 같이 AccessToken을 사용해 사용자 정보를 가져올 수 있다.</p>\n<h4 id=\"구현\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84\" aria-label=\"구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구현</h4>\n<ul>\n<li>인증 처리를 하기 위해선 username과 password를 처리하는 기능이 필요해 <strong>contextAttributesMapper</strong>를 구현해 OAuth2AutorizedClientManager에 등록시켜야 한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// OAuth2ClientConfig</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">securityFilterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span>authRequest <span class=\"token operator\">-></span> authRequest\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/oauth2Login\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/client\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        http\n<span class=\"token comment\">//                .oauth2Login(Customizer.withDefaults())</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">oauth2Client</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Customizer</span><span class=\"token punctuation\">.</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// AppConfig</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DefaultOAuth2AuthorizedClientManager</span> <span class=\"token function\">authorizedClientManager</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ClientRegistrationRepository</span> clientRegistrationRepository<span class=\"token punctuation\">,</span>\n                                                                        <span class=\"token class-name\">OAuth2AuthorizedClientRepository</span> authorizedClientRepository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">OAuth2AuthorizedClientProvider</span> authorizedClientProvider <span class=\"token operator\">=</span>\n                <span class=\"token class-name\">OAuth2AuthorizedClientProviderBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">authorizationCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">clientCredentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span>passwordGrantBuilder <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                            passwordGrantBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">clockSkew</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofSeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">3600</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">refreshToken</span><span class=\"token punctuation\">(</span>refreshTokenGrantBuilder <span class=\"token operator\">-></span> refreshTokenGrantBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">clockSkew</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofSeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">3600</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">DefaultOAuth2AuthorizedClientManager</span> authorizedClientManager <span class=\"token operator\">=</span>\n                <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultOAuth2AuthorizedClientManager</span><span class=\"token punctuation\">(</span>\n                        clientRegistrationRepository<span class=\"token punctuation\">,</span> authorizedClientRepository<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        authorizedClientManager<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthorizedClientProvider</span><span class=\"token punctuation\">(</span>authorizedClientProvider<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        authorizedClientManager<span class=\"token punctuation\">.</span><span class=\"token function\">setContextAttributesMapper</span><span class=\"token punctuation\">(</span><span class=\"token function\">contextAttributesMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> authorizedClientManager<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Function</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OAuth2AuthorizeRequest</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">contextAttributesMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> authorizeRequest <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> contextAttributes <span class=\"token operator\">=</span> <span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">emptyMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">HttpServletRequest</span> servletRequest <span class=\"token operator\">=</span> authorizeRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">String</span> username <span class=\"token operator\">=</span> servletRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2ParameterNames</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USERNAME</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> servletRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2ParameterNames</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PASSWORD</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                contextAttributes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// `PasswordOAuth2AuthorizedClientProvider` requires both attributes</span>\n                contextAttributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2AuthorizationContext</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USERNAME_ATTRIBUTE_NAME</span><span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                contextAttributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2AuthorizationContext</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PASSWORD_ATTRIBUTE_NAME</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> contextAttributes<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>코드를 간략히 설명하면</p>\n<ol>\n<li><strong>DefaultOAuth2AutorizedClientManager</strong> 객체 생성</li>\n<li>setAuthorizedClientProvider 함수로 Provider 등록</li>\n<li>parameter 처리 부분이 있는 contextAttributesMapper 함수를 등록한다.</li>\n</ol>\n<p>DefaultOAuth2AuthorizedClientManager 객체를 통해 동작 확인 가능</p>\n<p>Config 설정은 끝이고</p>\n<p>실제 로그인 기능을 구현하기 위해서 Controller 구현해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">DefaultOAuth2AuthorizedClientManager</span> authorizedClientManager<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">OAuth2AuthorizedClientRepository</span> authorizedClientRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Duration</span> clockSkew <span class=\"token operator\">=</span> <span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofSeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">3600</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Clock</span> clock <span class=\"token operator\">=</span> <span class=\"token class-name\">Clock</span><span class=\"token punctuation\">.</span><span class=\"token function\">systemUTC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/oauth2Login\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">oauth2Login</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Model</span> model<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> servletResponse<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletRequest</span> servletRequest<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">Authentication</span> principal <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>principal <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            principal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnonymousAuthenticationToken</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"anonymous\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"anonymousUser\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthorityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">createAuthorityList</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_ANONYMOUS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">OAuth2AuthorizeRequest</span> authorizeRequest <span class=\"token operator\">=</span> <span class=\"token class-name\">OAuth2AuthorizeRequest</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">withClientRegistrationId</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"keycloak\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">principal</span><span class=\"token punctuation\">(</span>principal<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">attribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> servletRequest<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">attribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> servletResponse<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">OAuth2AuthorizationSuccessHandler</span> authorizationSuccessHandler <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>authorizedClient<span class=\"token punctuation\">,</span> authentication<span class=\"token punctuation\">,</span> attributes<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span>\n                authorizedClientRepository\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">saveAuthorizedClient</span><span class=\"token punctuation\">(</span>authorizedClient<span class=\"token punctuation\">,</span> authentication<span class=\"token punctuation\">,</span>\n                                <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">)</span> attributes<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">)</span> attributes<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        authorizedClientManager<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthorizationSuccessHandler</span><span class=\"token punctuation\">(</span>authorizationSuccessHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">OAuth2AuthorizedClient</span> oAuth2AuthorizedClient <span class=\"token operator\">=</span> authorizedClientManager<span class=\"token punctuation\">.</span><span class=\"token function\">authorize</span><span class=\"token punctuation\">(</span>authorizeRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oAuth2AuthorizedClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">hasTokenExpired</span><span class=\"token punctuation\">(</span>oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getAccessToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">&amp;&amp;</span> oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getRefreshToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">ClientRegistration</span><span class=\"token punctuation\">.</span><span class=\"token function\">withClientRegistration</span><span class=\"token punctuation\">(</span>oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getClientRegistration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authorizationGrantType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthorizationGrantType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REFRESH_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            oAuth2AuthorizedClient <span class=\"token operator\">=</span> authorizedClientManager<span class=\"token punctuation\">.</span><span class=\"token function\">authorize</span><span class=\"token punctuation\">(</span>authorizeRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>oAuth2AuthorizedClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n            <span class=\"token class-name\">ClientRegistration</span> clientRegistration <span class=\"token operator\">=</span> oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getClientRegistration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">OAuth2AccessToken</span> accessToken <span class=\"token operator\">=</span> oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getAccessToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">OAuth2RefreshToken</span> refreshToken <span class=\"token operator\">=</span> oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getRefreshToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">OAuth2UserService</span> oAuth2UserService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultOAuth2UserService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// 사용자 정보 가져오는 함수</span>\n            <span class=\"token class-name\">OAuth2User</span> oauth2User <span class=\"token operator\">=</span> oAuth2UserService<span class=\"token punctuation\">.</span><span class=\"token function\">loadUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">OAuth2UserRequest</span><span class=\"token punctuation\">(</span>\n                    oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getClientRegistration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> accessToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// 권한 매핑</span>\n            <span class=\"token class-name\">SimpleAuthorityMapper</span> simpleAuthorityMapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleAuthorityMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            simpleAuthorityMapper<span class=\"token punctuation\">.</span><span class=\"token function\">setPrefix</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// SYSTEM_ 이런식으로 prefix 줄 수 있음</span>\n            <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> authorities <span class=\"token operator\">=</span> simpleAuthorityMapper<span class=\"token punctuation\">.</span><span class=\"token function\">mapAuthorities</span><span class=\"token punctuation\">(</span>oauth2User<span class=\"token punctuation\">.</span><span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">OAuth2AuthenticationToken</span> oAuth2AuthenticationToken <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OAuth2AuthenticationToken</span><span class=\"token punctuation\">(</span>oauth2User<span class=\"token punctuation\">,</span> authorities<span class=\"token punctuation\">,</span> clientRegistration<span class=\"token punctuation\">.</span><span class=\"token function\">getRegistrationId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">SecurityContext</span> context <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">createEmptyContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            context<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthentication</span><span class=\"token punctuation\">(</span>oAuth2AuthenticationToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">setContext</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            authorizationSuccessHandler<span class=\"token punctuation\">.</span><span class=\"token function\">onAuthorizationSuccess</span><span class=\"token punctuation\">(</span>oAuth2AuthorizedClient<span class=\"token punctuation\">,</span> oAuth2AuthenticationToken<span class=\"token punctuation\">,</span> <span class=\"token function\">createAttributes</span><span class=\"token punctuation\">(</span>servletRequest<span class=\"token punctuation\">,</span> servletResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            model<span class=\"token punctuation\">.</span><span class=\"token function\">addAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"oAuth2AuthenticationToken\"</span><span class=\"token punctuation\">,</span>oAuth2AuthenticationToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"home\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">createAttributes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> servletRequest<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> servletResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> attributes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        attributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> servletRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        attributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> servletResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> attributes<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/logout\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> servletRequest<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> servletResponse<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">SecurityContextLogoutHandler</span> logoutHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SecurityContextLogoutHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        logoutHandler<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span>servletRequest<span class=\"token punctuation\">,</span> servletResponse<span class=\"token punctuation\">,</span> authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"index\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasTokenExpired</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2Token</span> token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">instant</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAfter</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span><span class=\"token function\">getExpiresAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">minus</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clockSkew<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"client-credentials-refresh-token\" style=\"position:relative;\"><a href=\"#client-credentials-refresh-token\" aria-label=\"client credentials refresh token permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client Credentials, Refresh Token</h3>\n<p>Credentials는 Resource Owner Password Flow 로직과 대부분 유사한데</p>\n<p>권한 부여에 따른 처리 하는 클래스들이 차이가 난다.</p>\n<p>해당 부분의 Config를 수정하면서 구현</p>\n<p>Refresh Token은 위에 적용이 되어있는데 App Config와 controller에 처리하는 부분을 추가하면 된다.</p>\n<h3 id=\"custom-login-filter\" style=\"position:relative;\"><a href=\"#custom-login-filter\" aria-label=\"custom login filter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Custom Login Filter</h3>\n<p>이전까지 과정은 Client Manager를 이용해 Spring MVC에서 Login Controller에서 인가처리를 했는데</p>\n<p>Spring Security에서 지원하는 Filter 기반으로 적용이 가능</p>\n<p>인가 처리 로직은 이전과 동일하고 Config 설정에서 Filter 등록을 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span><span class=\"token punctuation\">(</span>proxyBeanMethods <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OAuth2ClientConfig</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DefaultOAuth2AuthorizedClientManager</span> authorizedClientManager<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OAuth2AuthorizedClientRepository</span> authorizedClientRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">oauth2SecurityFilterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n                http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>requests<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> requests<span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/oauth2Login\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/logout\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        http\n<span class=\"token comment\">//                .oauth2Login().and()</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">oauth2Client</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">addFilterBefore</span><span class=\"token punctuation\">(</span><span class=\"token function\">customOAuth2LoginAuthenticationFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CustomOAuth2LoginAuthenticationFilter</span> <span class=\"token function\">customOAuth2LoginAuthenticationFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">CustomOAuth2LoginAuthenticationFilter</span> customOAuth2LoginAuthenticationFilter <span class=\"token operator\">=</span>\n                <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"token punctuation\">(</span>authorizedClientManager<span class=\"token punctuation\">,</span>authorizedClientRepository<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        customOAuth2LoginAuthenticationFilter<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthenticationSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            response<span class=\"token punctuation\">.</span><span class=\"token function\">sendRedirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/home\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> customOAuth2LoginAuthenticationFilter<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>customOAuth2LoginAuthenticationFilter 설정을 살펴보면</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomOAuth2LoginAuthenticationFilter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractAuthenticationProcessingFilter</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">DEFAULT_FILTER_PROCESSES_URI</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"/oauth2Login/**\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OAuth2AuthorizedClientRepository</span> authorizedClientRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DefaultOAuth2AuthorizedClientManager</span> oAuth2AuthorizedClientManager<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OAuth2AuthorizationSuccessHandler</span> authorizationSuccessHandler<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OAuth2AuthorizationFailureHandler</span> authorizationFailureHandler<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Duration</span> clockSkew <span class=\"token operator\">=</span> <span class=\"token class-name\">Duration</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofSeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">3600</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Clock</span> clock <span class=\"token operator\">=</span> <span class=\"token class-name\">Clock</span><span class=\"token punctuation\">.</span><span class=\"token function\">systemUTC</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CustomOAuth2LoginAuthenticationFilter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DefaultOAuth2AuthorizedClientManager</span> oAuth2AuthorizedClientManager<span class=\"token punctuation\">,</span> <span class=\"token class-name\">OAuth2AuthorizedClientRepository</span> oAuth2AuthorizedClientRepository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DEFAULT_FILTER_PROCESSES_URI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>oAuth2AuthorizedClientManager <span class=\"token operator\">=</span> oAuth2AuthorizedClientManager<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authorizedClientRepository <span class=\"token operator\">=</span> oAuth2AuthorizedClientRepository<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>authorizationSuccessHandler <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>authorizedClient<span class=\"token punctuation\">,</span> authentication<span class=\"token punctuation\">,</span> attributes<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span>\n                authorizedClientRepository\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">saveAuthorizedClient</span><span class=\"token punctuation\">(</span>authorizedClient<span class=\"token punctuation\">,</span> authentication<span class=\"token punctuation\">,</span>\n                                <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">)</span> attributes<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">)</span> attributes<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>oAuth2AuthorizedClientManager<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthorizationSuccessHandler</span><span class=\"token punctuation\">(</span>authorizationSuccessHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Authentication</span> <span class=\"token function\">attemptAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">AuthenticationException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">Authentication</span> principal <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>principal <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            principal <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AnonymousAuthenticationToken</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"anonymous\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"anonymousUser\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthorityUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">createAuthorityList</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_ANONYMOUS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">OAuth2AuthorizeRequest</span> authorizeRequest <span class=\"token operator\">=</span> <span class=\"token class-name\">OAuth2AuthorizeRequest</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">withClientRegistrationId</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"keycloak\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">principal</span><span class=\"token punctuation\">(</span>principal<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">attribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">attribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">OAuth2AuthorizedClient</span> oAuth2AuthorizedClient <span class=\"token operator\">=</span> oAuth2AuthorizedClientManager<span class=\"token punctuation\">.</span><span class=\"token function\">authorize</span><span class=\"token punctuation\">(</span>authorizeRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oAuth2AuthorizedClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">hasTokenExpired</span><span class=\"token punctuation\">(</span>oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getAccessToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">&amp;&amp;</span> oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getRefreshToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">ClientRegistration</span><span class=\"token punctuation\">.</span><span class=\"token function\">withClientRegistration</span><span class=\"token punctuation\">(</span>oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getClientRegistration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authorizationGrantType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthorizationGrantType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REFRESH_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            oAuth2AuthorizedClient <span class=\"token operator\">=</span> oAuth2AuthorizedClientManager<span class=\"token punctuation\">.</span><span class=\"token function\">authorize</span><span class=\"token punctuation\">(</span>authorizeRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>oAuth2AuthorizedClient <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">ClientRegistration</span> clientRegistration <span class=\"token operator\">=</span> oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getClientRegistration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">OAuth2AccessToken</span> accessToken <span class=\"token operator\">=</span> oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getAccessToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">OAuth2RefreshToken</span> refreshToken <span class=\"token operator\">=</span> oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getRefreshToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">OAuth2UserService</span> oAuth2UserService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultOAuth2UserService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">OAuth2User</span> oauth2User <span class=\"token operator\">=</span> oAuth2UserService<span class=\"token punctuation\">.</span><span class=\"token function\">loadUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">OAuth2UserRequest</span><span class=\"token punctuation\">(</span>\n                    oAuth2AuthorizedClient<span class=\"token punctuation\">.</span><span class=\"token function\">getClientRegistration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> accessToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">SimpleAuthorityMapper</span> simpleAuthorityMapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleAuthorityMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> authorities <span class=\"token operator\">=</span> simpleAuthorityMapper<span class=\"token punctuation\">.</span><span class=\"token function\">mapAuthorities</span><span class=\"token punctuation\">(</span>oauth2User<span class=\"token punctuation\">.</span><span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">OAuth2AuthenticationToken</span> oAuth2AuthenticationToken <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OAuth2AuthenticationToken</span><span class=\"token punctuation\">(</span>oauth2User<span class=\"token punctuation\">,</span> authorities<span class=\"token punctuation\">,</span> clientRegistration<span class=\"token punctuation\">.</span><span class=\"token function\">getRegistrationId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// 인증 받은 사용자를 저장해줘야 한다.</span>\n            authorizationSuccessHandler<span class=\"token punctuation\">.</span><span class=\"token function\">onAuthorizationSuccess</span><span class=\"token punctuation\">(</span>oAuth2AuthorizedClient<span class=\"token punctuation\">,</span> oAuth2AuthenticationToken<span class=\"token punctuation\">,</span> <span class=\"token function\">createAttributes</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">return</span> oAuth2AuthenticationToken<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">createAttributes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> servletRequest<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> servletResponse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> attributes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        attributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> servletRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        attributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> servletResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> attributes<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">hasTokenExpired</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2Token</span> token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">instant</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAfter</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span><span class=\"token function\">getExpiresAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">minus</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clockSkew<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>코드 설명을 간략히 하면</p>\n<ol>\n<li>CustomOAuth2LoginAuthenticationFilter 생성자 내부에서 default url설정을 해 어떤 경로로 들어오면 filter처리를 할 지 등록시켜 준다.<br>\n(AbstractAuthenticationProcessingFilter 생성자에서 url 등록)</li>\n<li>config설정을 보면 UsernamePasswordAuthenticationFilter 앞에 Filter가 동작하도록 설정해서 MVC Controller에서 처리하는 부분과 다르게 SecurityContextHolder안에 Token이 존재하지 않아 principal이 null일 경우 AnonymousAuthenticationToken을 만들어주는 로직이 필요</li>\n<li>나머지는 위에 MVC 처리 부분과 동일하다</li>\n</ol>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<ul>\n<li><a href=\"https://www.inflearn.com/course/%EC%A0%95%EC%88%98%EC%9B%90-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0/dashboard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스프링 시큐리티 OAuth2 - Spring Boot 기반으로 개발하는 Spring Security OAuth2</a></li>\n</ul>","excerpt":"OAuth 2.0 Client OAuth 2.0 인가 프레임워크의 역할 중 인가 서버 및 리소스 서버와의 통신을 담당하는 클라이언트의 기능을 필터 기반으로 구현한 모듈 OAuth 2.0 Login API 어플리케이션 사용자를 외부 OAuth2.0 P…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/SpringSecurity2_2/#oauth-20-client\">OAuth 2.0 Client</a></p>\n<ul>\n<li><a href=\"/SpringSecurity2_2/#oauth-20-login-api\">OAuth 2.0 Login API</a></li>\n<li><a href=\"/SpringSecurity2_2/#oauth-20-client-api\">OAuth 2.0 Client API</a></li>\n<li>\n<p><a href=\"/SpringSecurity2_2/#oauth-20-client-fundamentals\">OAuth 2.0 Client Fundamentals</a></p>\n<ul>\n<li><a href=\"/SpringSecurity2_2/#client-%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95-%EA%B3%BC%EC%A0%95\">Client 권한 설정 과정</a></li>\n<li><a href=\"/SpringSecurity2_2/#client-registration-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\">Client Registration 초기화 과정</a></li>\n<li><a href=\"/SpringSecurity2_2/#client-repository\">Client Repository</a></li>\n<li><a href=\"/SpringSecurity2_2/#%EC%9E%90%EB%8F%99-%EC%84%A4%EC%A0%95%EC%97%90-%EC%9D%98%ED%95%9C-%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\">자동 설정에 의한 초기화 과정</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity2_2/#oauth-20-client---oauth2login\">OAuth 2.0 Client - oauth2Login()</a></p>\n<ul>\n<li><a href=\"/SpringSecurity2_2/#authorization-code---%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\">Authorization Code - 주요 클래스</a></li>\n<li><a href=\"/SpringSecurity2_2/#authorization-code-grant-type---get-code\">Authorization Code Grant Type - get code</a></li>\n<li><a href=\"/SpringSecurity2_2/#authorization-accesstoken-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\">Authorization AccessToken 주요 클래스</a></li>\n<li><a href=\"/SpringSecurity2_2/#authorization-code-grant-type---get-accesstoken\">Authorization Code Grant Type - get AccessToken</a></li>\n<li><a href=\"/SpringSecurity2_2/#oauth2userservice\">OAuth2UserService</a></li>\n<li><a href=\"/SpringSecurity2_2/#openid-logout\">OpenID Logout</a></li>\n<li><a href=\"/SpringSecurity2_2/#mvc%EC%97%90%EC%84%9C-%EC%9D%B8%EC%A6%9D-%EA%B0%9D%EC%B2%B4-%EC%B0%B8%EC%A1%B0-%EB%B0%A9%EB%B2%95\">MVC에서 인증 객체 참조 방법</a></li>\n<li><a href=\"/SpringSecurity2_2/#oauth2-custom\">OAuth2 Custom</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity2_2/#oauth-20-client---oauth2client\">OAuth 2.0 Client - oauth2Client()</a></p>\n<ul>\n<li><a href=\"/SpringSecurity2_2/#oauth20-client-%EC%A3%BC%EC%9A%94-%ED%81%B4%EB%9E%98%EC%8A%A4\">OAuth2.0 Client 주요 클래스</a></li>\n<li><a href=\"/SpringSecurity2_2/#oauth2-client---resource-owner-password-flow\">OAuth2 client - Resource Owner Password Flow</a></li>\n<li><a href=\"/SpringSecurity2_2/#client-credentials-refresh-token\">Client Credentials, Refresh Token</a></li>\n<li><a href=\"/SpringSecurity2_2/#custom-login-filter\">Custom Login Filter</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/SpringSecurity2_2/#reference\">Reference</a></li>\n</ul>","fields":{"slug":"/SpringSecurity2_2/"},"frontmatter":{"title":"Spring Security OAuth2.0 Client","date":"Feb 08, 2023","tags":["Spring"],"keywords":["Spring","Security"],"update":"Feb 13, 2023"}}},"pageContext":{"slug":"/SpringSecurity2_2/","series":[{"slug":"/SpringSecurity2_1/","title":"Spring Security OAuth2.0 개념 파악하기","num":1},{"slug":"/SpringSecurity2_2/","title":"Spring Security OAuth2.0 Client","num":2},{"slug":"/SpringSecurity2_3/","title":"Spring Security OAuth2.0 Resource Server","num":3}],"lastmod":"2023-02-13"}},"staticQueryHashes":["2027115977","694178885"]}