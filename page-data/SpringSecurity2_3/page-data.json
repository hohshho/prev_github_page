{"componentChunkName":"component---src-templates-post-tsx","path":"/SpringSecurity2_3/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"oauth-20-resource-server-fundamental\" style=\"position:relative;\"><a href=\"#oauth-20-resource-server-fundamental\" aria-label=\"oauth 20 resource server fundamental permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 2.0 Resource Server Fundamental</h1>\n<h2 id=\"summary\" style=\"position:relative;\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h2>\n<blockquote>\n<p>클라이언트 및 인가서버와의 통신을 담당하는 리소스 서버 기능을 필터 기반으로 구현한 모듈</p>\n</blockquote>\n<p>지원 기능</p>\n<ul>\n<li>클라이언트의 리소스 접근 제한하는 인가 정책 설정</li>\n<li>Access Token 토큰 검증을 위한 인가서버와의 통신</li>\n</ul>\n<p>Spring Security는 OAuth 2.0 Bearer Token 두 종류로 엔드포인트를 보호한다.</p>\n<ol>\n<li>\n<p>JWT</p>\n<ul>\n<li>자체 검증</li>\n</ul>\n</li>\n<li>\n<p>Opaque</p>\n<ul>\n<li>실시간 토큰 검증</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"applicationyml-설정\" style=\"position:relative;\"><a href=\"#applicationyml-%EC%84%A4%EC%A0%95\" aria-label=\"applicationyml 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>application.yml 설정</h3>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8081</span>\n<span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">security</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">oauth2</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">resourceserver</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">jwt</span><span class=\"token punctuation\">:</span>\n          <span class=\"token comment\"># 서비스 공급자 위치</span>\n          <span class=\"token key atrule\">issuer-uri</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span>9100/realms/oauth2\n          <span class=\"token comment\"># OAuth2 JwkSetUri 엔드 포인트</span>\n          <span class=\"token key atrule\">jwk-set-uri</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">9100</span>\n          <span class=\"token comment\"># OAuth2 jws 서명 알고리즘</span>\n          <span class=\"token key atrule\">jws-algorithms</span><span class=\"token punctuation\">:</span> RS512\n          <span class=\"token comment\"># OAuth2 jws 검증을 위한 Public Key 파일 위치</span>\n          <span class=\"token key atrule\">public-key-location</span><span class=\"token punctuation\">:</span> classpath<span class=\"token punctuation\">:</span>my<span class=\"token punctuation\">-</span>key.pub\n          <span class=\"token comment\"># Opaque 토큰 검증하기 위한 엔드포인트</span></code></pre></div>\n<p>issuer-uri는 인가 서버가 발급할 JWT 토큰의 iss 클레임에 추가되는 값으로 발급자를 나타냄.\njwk-set-uri는 인가 서버가 발급한 JWT 토큰의 공개키 정보를 검색할 수 있는 엔드포인트</p>\n<p>-> 리소스 서버는 자체 검증 설정에도 이 속성을 사용하며, 이 속성으로 인가 서버의 공개키를 찾고, 건내 받은 JWT의 유효성을 검사</p>\n<p><a href=\"https://docs.spring.io/spring-security/reference/reactive/oauth2/resource-server/jwt.html#webflux-oauth2resourceserver-jwt-jwkseturi-dsl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">DSL</a>을 사용해 적용 가능</p>\n<hr>\n<p>application.yml파일에 사용할 인가서버 엔드포인트를 지정 해야 하는데 반드시</p>\n<p>dp.example.com/issuer/.well-known/openid-configuration<br>\nidp.example.com/.well-known/openid-configuration/issuer<br>\nidp.example.com/.well-known/oauth-authorization-server/issuer<br>\n셋 중 하나여야 한다. 이 엔드포인트는 <strong>Provider 설정 엔드포인트</strong> 또는 <strong>인가 서버 메타데이터 엔드포인트</strong> 라고 한다.</p>\n<h3 id=\"dependencies\" style=\"position:relative;\"><a href=\"#dependencies\" aria-label=\"dependencies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dependencies</h3>\n<p>리소스 서버를 지원하는 코드의 대부분은 <strong>spring-security-oauth2-resource-server</strong>에 들어있고 JWT를 디코딩 하고 검증하는 로직은 <strong>spring-security-oauth2-jose</strong>에 존재한다.</p>\n<h3 id=\"초기화-과정\" style=\"position:relative;\"><a href=\"#%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\" aria-label=\"초기화 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>초기화 과정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9972876f2b2e9efc4a92429a7b7cfd37/f726e/ResourceServerInitialization.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4UlEQVQoz4VSWW7iUBD0PTgBZ+BrYCLuhPjiix8EGCXSBLgDZwCRRSECsyoSKBkWOwaMwYTVhprulkAERZqWinaj1+WqelaKxSJisRhSqZQgmUwinU5DVVV5jsfj6Ha74NpsNthut/A8T+bj8Si4LCWRSMDn8yEUCuH3zQ1+BYMIEsLhMAKBAPx+P0qlEg60OB6PMZlMsN/vz4TXpbiui0KhIIryuRyy938I98hlswL+v1arwaNzpmkK4Ww2w+Fw+JFUYfn5fB7RaBQZsnxLdjNk9S6jQqU5EomgXC6fLa/Xa7F9IrruopAH4/MT1ddXPNPyy+MjKk9PeHl4QEOriVVnsYBlWWclp/wuCRkKS+dM2MZwMMCg34eh69BHI4yGQ5nn87lY3NPLf6pLcoV/mJDBSy51k8impNieTs5Ly7lN81RU2rYtfUJnFjPre4YnZs6S82E1Jh0c0wVYdAGO44BjYQJ2oOsGnOUS290Oq9VKcuXdHc0sSLkOlt8uIGLuC8qOa0jW23WNUEfv7Q2D93f87fXwQd/oB3UWwC6VE1mfFiqVChqNBjRNE9RpuVqtYkQRrEnNlBRvyAVJgccReS7BE3yzzGUYBlqtFjqdjqDdbktvNptyy/ypLL++/nsx/wB1gRw89EIqFAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ResourceServerInitialization\"\n        title=\"ResourceServerInitialization\"\n        src=\"/static/9972876f2b2e9efc4a92429a7b7cfd37/fcda8/ResourceServerInitialization.png\"\n        srcset=\"/static/9972876f2b2e9efc4a92429a7b7cfd37/12f09/ResourceServerInitialization.png 148w,\n/static/9972876f2b2e9efc4a92429a7b7cfd37/e4a3f/ResourceServerInitialization.png 295w,\n/static/9972876f2b2e9efc4a92429a7b7cfd37/fcda8/ResourceServerInitialization.png 590w,\n/static/9972876f2b2e9efc4a92429a7b7cfd37/efc66/ResourceServerInitialization.png 885w,\n/static/9972876f2b2e9efc4a92429a7b7cfd37/c83ae/ResourceServerInitialization.png 1180w,\n/static/9972876f2b2e9efc4a92429a7b7cfd37/f726e/ResourceServerInitialization.png 2610w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"jwt\" style=\"position:relative;\"><a href=\"#jwt\" aria-label=\"jwt permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jwt</h2>\n<p>Jwt기능을 사용하기 위해 HttpSecurity 에 있는 oauth2ResourceServer().jwt() API 를 정의하고 빌드한다</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">securityFilterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span>request <span class=\"token operator\">-></span>request<span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    http<span class=\"token punctuation\">.</span><span class=\"token function\">oauth2ResourceServer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2ResourceServerConfigurer</span><span class=\"token operator\">::</span><span class=\"token function\">jwt</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"jwt-api-설정-검증-프로세스\" style=\"position:relative;\"><a href=\"#jwt-api-%EC%84%A4%EC%A0%95-%EA%B2%80%EC%A6%9D-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4\" aria-label=\"jwt api 설정 검증 프로세스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jwt API 설정, 검증 프로세스</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5701a68b4c375c09402e6463c25258cf/1cb21/jwtVerifyProcess.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcUlEQVQoz41SC2+CYAzk//+xmRjMyBLnYxMFFHlKBAUEvfWaQMTNxSbN9+p3vV5rQKyua5Rl2TvPURTBcRx4ngff95Gmqd7dbjf8Z4ZlWRiPx9hut2iaZuAEME0Tb6MRPmcz5Hk+SHw+nzGdTjGZTEAcvhthGCoDPj7a5XLB12KBD+sd/m6Htm0HzqRkTjJBEGi8wY+n0wlVVWG/3+sDnfvj8QhvtYIjoFVRPC2TQH3JzERAriyDwJ1fr1dkhxSBsGMFWZZpHB505D+97wB58cxY6vdyqfrQ7fkc7nqtjWNSrnleaPJfgOzgvXcTkCSJMmQcWcZyphyFyMC7SPpA8JcA+Yma8kMpoNzbto1ANO6ak8o01PeAHfpfxubYUmIayTRsNgjlzMngSJE9rZJ1UDJZkBED2CB2jQF013WxFN0OMh6xgCQc8DBALEyTOFbWlKNvCj9RbIJRH84k9dESRQrVSt5bieuHXhLSNbEAdQRoP9g0UVTyWjEWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jwtVerifyProcess\"\n        title=\"jwtVerifyProcess\"\n        src=\"/static/5701a68b4c375c09402e6463c25258cf/fcda8/jwtVerifyProcess.png\"\n        srcset=\"/static/5701a68b4c375c09402e6463c25258cf/12f09/jwtVerifyProcess.png 148w,\n/static/5701a68b4c375c09402e6463c25258cf/e4a3f/jwtVerifyProcess.png 295w,\n/static/5701a68b4c375c09402e6463c25258cf/fcda8/jwtVerifyProcess.png 590w,\n/static/5701a68b4c375c09402e6463c25258cf/efc66/jwtVerifyProcess.png 885w,\n/static/5701a68b4c375c09402e6463c25258cf/c83ae/jwtVerifyProcess.png 1180w,\n/static/5701a68b4c375c09402e6463c25258cf/1cb21/jwtVerifyProcess.png 2586w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>클라이언트가 Authorization Bearer token-value 를 헤더에 담아 요청</li>\n<li>리소스 서버는 요청한 토큰이 Bearer 토큰 사양에 부합하는지 검사</li>\n<li>인가서버에서 JWT 토큰에 서명한 개인키와 매칭하는 공개키를 jwk-set-url 엔드포인트 요청으로 가져와 첫번째 검증 진행</li>\n<li>JWT에 있는 exp, nbf, iss 클레임의 정보가 기준에 부합하는지 두번째 검증 진행</li>\n<li>검증에 성공하면 Jwt 객체를 생성하고 claims 정보에 있는 scope 를 추출해서 시큐리티의 권한에 매핑 (SCOPE<em>profile, SCOPE</em>email)</li>\n<li>Authentication 객체를 생성하고 Jwt 객체를 principal 속성에는 저장</li>\n<li>Authentication 를 SecurityContext 에 저장하고 인증을 완료한다</li>\n</ol>\n<details>\n<summary><h3> 구조 및 세부 흐름 [Toggle]</h3></summary>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4bacbe822353f2ab9e65aa4696bb35ec/af975/jwtVerifyDetailProcess.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiUlEQVQoz4VSyVKDUBDk/z/Aiyd/wKNf4ckDiakQlhASICxhhwDt9BhSlpY6VcN7vNl6esYoigLbzQae66K4XJDnuepF7mVZ6luWZXpfZJ7nX9WgQ+j7sDfvcKwtTmGowZ7jIIljVFWF8/mMlWkiFts0TfhLjFk+0/WKse/0XCpNw4BpHEF7JQW2KxPWeo00SXA6Boq673t0XXc/R/E3GPxdlqf51h4DouMRcRRpcte24XkuYukgTVMkUoTnVQAZSxDDx4n6sw22bVkWdrud0pEJx0S0aNM0WlQ55IeJmPDFvOL5tUCbRUizHJEgojODgiBQLlv5j6NQbURWiJbS/iDolMOvSDbhgDenwNA3ioI81XWNtm3hy+C4EaMEptLqYqdNi7aNUqQI85vxk7UJRVnh4fFJUdK+JCRn5CkTVPSnJnGESNDz7b42h8NBSPbEedRJMcjb++iEFwoR2DIIJhhk+mw9lBUi+l6KdTwXDhkwyE8p7ZCX/X6vS03UR5lsfXNey8qQs//kAwunAgC19wWMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jwtVerifyDetailProcess\"\n        title=\"jwtVerifyDetailProcess\"\n        src=\"/static/4bacbe822353f2ab9e65aa4696bb35ec/fcda8/jwtVerifyDetailProcess.png\"\n        srcset=\"/static/4bacbe822353f2ab9e65aa4696bb35ec/12f09/jwtVerifyDetailProcess.png 148w,\n/static/4bacbe822353f2ab9e65aa4696bb35ec/e4a3f/jwtVerifyDetailProcess.png 295w,\n/static/4bacbe822353f2ab9e65aa4696bb35ec/fcda8/jwtVerifyDetailProcess.png 590w,\n/static/4bacbe822353f2ab9e65aa4696bb35ec/efc66/jwtVerifyDetailProcess.png 885w,\n/static/4bacbe822353f2ab9e65aa4696bb35ec/c83ae/jwtVerifyDetailProcess.png 1180w,\n/static/4bacbe822353f2ab9e65aa4696bb35ec/af975/jwtVerifyDetailProcess.png 2478w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"요약\" style=\"position:relative;\"><a href=\"#%EC%9A%94%EC%95%BD\" aria-label=\"요약 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>요약</h4>\n<p>jwtProcessor가 JWSVerifier까지 과정을 거쳐 JWTClaimSet형태를 반환\njwtProcessor -> JWKMatcher 까지가 JWK를 선택해 public key를 가져오기 위한 과정</p>\n</details>\n<h4 id=\"jwt-decoder-생성\" style=\"position:relative;\"><a href=\"#jwt-decoder-%EC%83%9D%EC%84%B1\" aria-label=\"jwt decoder 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jwt Decoder 생성</h4>\n<p><a href=\"https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/jwt.html#oauth2resourceserver-jwt-sansboot\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jwt Decoder 설정 방법은 2가지 존재</a></p>\n<ol>\n<li>JwtDecoders.fromIssuerLocation()</li>\n<li>JwtDecoders.fromIssuerLocation() 을 호출하면 Provider 설정 또는 인가 서버 메타데이터 엔드포인트로 JWK 셋 Uri를 요청한다</li>\n<li>어플리케이션에서 따로 정의한 JwtDecoder 빈이 없다면 스프링 부트가 위에 있는 디폴트 빈을 등록한다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">JwtDecoder</span> <span class=\"token function\">jwtDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">JwtDecoders</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromIssuerLocation</span><span class=\"token punctuation\">(</span>issuerUri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>NimbusJwtDecoder.withJwkSetUri()</li>\n<li>wkSetUri 에 의한 검증방식으로 NimbusJwtDecoder 를 생성할 경우 알고리즘의 종류를 변경 가능</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token class-name\">JwtDecoder</span> <span class=\"token function\">jwtDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">NimbusJwtDecoder</span><span class=\"token punctuation\">.</span><span class=\"token function\">withJwkSetUri</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwkSetUri<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">jwsAlgorithm</span><span class=\"token punctuation\">(</span><span class=\"token constant\">RS512</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">jwsAlgorithm</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ES512</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/jwt.html#oauth2resourceserver-jwt-decoder-builder\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Using a Builder</a></p>\n<h1 id=\"token-검증\" style=\"position:relative;\"><a href=\"#token-%EA%B2%80%EC%A6%9D\" aria-label=\"token 검증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Token 검증</h1>\n<h2 id=\"용어-정리\" style=\"position:relative;\"><a href=\"#%EC%9A%A9%EC%96%B4-%EC%A0%95%EB%A6%AC\" aria-label=\"용어 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>용어 정리</h2>\n<h3 id=\"jca-jce\" style=\"position:relative;\"><a href=\"#jca-jce\" aria-label=\"jca jce permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JCA, JCE</h3>\n<h3 id=\"대칭키-비대칭키\" style=\"position:relative;\"><a href=\"#%EB%8C%80%EC%B9%AD%ED%82%A4-%EB%B9%84%EB%8C%80%EC%B9%AD%ED%82%A4\" aria-label=\"대칭키 비대칭키 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>대칭키, 비대칭키</h3>\n<h3 id=\"jwt-1\" style=\"position:relative;\"><a href=\"#jwt-1\" aria-label=\"jwt 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT</h3>\n<h3 id=\"jwk\" style=\"position:relative;\"><a href=\"#jwk\" aria-label=\"jwk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWK</h3>\n<h1 id=\"token-검증-구현\" style=\"position:relative;\"><a href=\"#token-%EA%B2%80%EC%A6%9D-%EA%B5%AC%ED%98%84\" aria-label=\"token 검증 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Token 검증 구현</h1>\n<p>강의에서 MAC 방식, RSA 검증 방식을 사용해 검증 테스트를 진행한다.</p>\n<p>따라가며 Token이 어떻게 발행되고, 검증 되는지 이해해보자</p>\n<h4 id=\"공통-클래스\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%ED%86%B5-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"공통 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공통 클래스</h4>\n<p>주요 사용되는 클래스로는 3개가 존재한다</p>\n<h4 id=\"signatureconfig\" style=\"position:relative;\"><a href=\"#signatureconfig\" aria-label=\"signatureconfig permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SignatureConfig</h4>\n<blockquote>\n<p>서명과 검증, MAC 및 RSA 암호화 JWK 등의 빈들을 생성하는 설정 클래스</p>\n</blockquote>\n<h4 id=\"jwtauthenticationfilter\" style=\"position:relative;\"><a href=\"#jwtauthenticationfilter\" aria-label=\"jwtauthenticationfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JwtAuthenticationFilter</h4>\n<ul>\n<li>인가서버를 대신하여 토큰을 발행하는 커스텀 필터로서 UsernamePasswordAuthenticationFilter 상속</li>\n<li>POST /login 요청에 대해 인증 처리를 담당</li>\n<li>인증에 성공하게 되면 SecuritySigner 를 호출해서 JWT 토큰을 생성하고 클라이언트에게 응답</li>\n</ul>\n<h4 id=\"securitysigner\" style=\"position:relative;\"><a href=\"#securitysigner\" aria-label=\"securitysigner permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecuritySigner</h4>\n<ul>\n<li>MAC 및 RSA 암호화 방식에 따라 토큰을 발행하는 추상 클래스</li>\n</ul>\n<h2 id=\"mac-방식\" style=\"position:relative;\"><a href=\"#mac-%EB%B0%A9%EC%8B%9D\" aria-label=\"mac 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MAC 방식</h2>\n<p><img src=\"macVerify\"></p>\n<p>왼쪽이 MAC 발급 / 오른쪽이 MAC 검증</p>\n<p>MAC 검증 기능을 구현하기 위해선 2가지 방법 존재</p>\n<h4 id=\"1-filter-기반\" style=\"position:relative;\"><a href=\"#1-filter-%EA%B8%B0%EB%B0%98\" aria-label=\"1 filter 기반 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Filter 기반</h4>\n<h4 id=\"2-secret-key-기반-jwtdecoder-생성\" style=\"position:relative;\"><a href=\"#2-secret-key-%EA%B8%B0%EB%B0%98-jwtdecoder-%EC%83%9D%EC%84%B1\" aria-label=\"2 secret key 기반 jwtdecoder 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. secret key 기반 JwtDecoder 생성</h4>\n<blockquote>\n<p>대칭키 방식으로 생성된 토큰을 검증하기 위해 JWK 를 상속한 OctetSequenceKey 로 SecretKey 기반 JwtDecoder 를 생성</p>\n</blockquote>\n<p>강의에선 쉽게 예제를 구현하기 위해 인증 기능과 검증 기능을 하는 서버를 하나로 써서 JWK 객체에서 secret key를 불러오는 방식으로</p>\n<p>사용했는데 실제로 해당 방법을 적용할 땐 동일한 key로 암호화 하게 설정해야 한다.</p>\n<h2 id=\"rsa-방식\" style=\"position:relative;\"><a href=\"#rsa-%EB%B0%A9%EC%8B%9D\" aria-label=\"rsa 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RSA 방식</h2>\n<p>4가지 방법으로 구현이 가능하다</p>\n<h4 id=\"1-jwtauthorizationrsafilter\" style=\"position:relative;\"><a href=\"#1-jwtauthorizationrsafilter\" aria-label=\"1 jwtauthorizationrsafilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. JwtAuthorizationRsaFilter</h4>\n<h4 id=\"2-jwtdecoder-에-의한-검증\" style=\"position:relative;\"><a href=\"#2-jwtdecoder-%EC%97%90-%EC%9D%98%ED%95%9C-%EA%B2%80%EC%A6%9D\" aria-label=\"2 jwtdecoder 에 의한 검증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. JwtDecoder 에 의한 검증</h4>\n<h4 id=\"3-keystore-에-의한-검증\" style=\"position:relative;\"><a href=\"#3-keystore-%EC%97%90-%EC%9D%98%ED%95%9C-%EA%B2%80%EC%A6%9D\" aria-label=\"3 keystore 에 의한 검증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. KeyStore 에 의한 검증</h4>\n<blockquote>\n<p>퍼블릭 키를 파일로 저장해서 활용하는 방식</p>\n</blockquote>\n<h4 id=\"4-jwkseturi-에-의한-검증\" style=\"position:relative;\"><a href=\"#4-jwkseturi-%EC%97%90-%EC%9D%98%ED%95%9C-%EA%B2%80%EC%A6%9D\" aria-label=\"4 jwkseturi 에 의한 검증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. JwkSetUri 에 의한 검증</h4>\n<blockquote>\n<p>실제 인가 서버로 부터 public key를 가져와서 인가하는 방식</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">http<span class=\"token punctuation\">.</span><span class=\"token function\">oauth2ResourceServer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OAuth2ResourceServerConfigurer</span><span class=\"token operator\">::</span><span class=\"token function\">jwt</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>인가서버를 사용해 토큰을 사용하기 위해선 yml 설정과 위 config설정을 적용</p>\n<h2 id=\"토큰-검증-후-인증객체-생성\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0-%EA%B2%80%EC%A6%9D-%ED%9B%84-%EC%9D%B8%EC%A6%9D%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1\" aria-label=\"토큰 검증 후 인증객체 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰 검증 후 인증객체 생성</h2>\n<h2 id=\"검증-과정-정리\" style=\"position:relative;\"><a href=\"#%EA%B2%80%EC%A6%9D-%EA%B3%BC%EC%A0%95-%EC%A0%95%EB%A6%AC\" aria-label=\"검증 과정 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>검증 과정 정리</h2>\n<h2 id=\"scope-customizing\" style=\"position:relative;\"><a href=\"#scope-customizing\" aria-label=\"scope customizing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope Customizing</h2>\n<h2 id=\"opaque\" style=\"position:relative;\"><a href=\"#opaque\" aria-label=\"opaque permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Opaque</h2>\n<h1 id=\"resource-server-구현\" style=\"position:relative;\"><a href=\"#resource-server-%EA%B5%AC%ED%98%84\" aria-label=\"resource server 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Resource Server 구현</h1>\n<h2 id=\"scope\" style=\"position:relative;\"><a href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scope</h2>\n<h2 id=\"opaque-1\" style=\"position:relative;\"><a href=\"#opaque-1\" aria-label=\"opaque 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>opaque</h2>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<ul>\n<li><a href=\"https://godekdls.github.io/Spring%20Security/oauth2/#12319-supporting-both-jwt-and-opaque-token\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Security - 토리맘의 한글라이즈 프로젝트</a></li>\n</ul>","excerpt":"OAuth 2.0 Resource Server Fundamental Summary 클라이언트 및 인가서버와의 통신을 담당하는 리소스 서버 기능을 필터 기반으로 구현한 모듈 지원 기능 클라이언트의 리소스 접근 제한하는 인가 정책 설정 Access To…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/SpringSecurity2_3/#oauth-20-resource-server-fundamental\">OAuth 2.0 Resource Server Fundamental</a></p>\n<ul>\n<li>\n<p><a href=\"/SpringSecurity2_3/#summary\">Summary</a></p>\n<ul>\n<li><a href=\"/SpringSecurity2_3/#applicationyml-%EC%84%A4%EC%A0%95\">application.yml 설정</a></li>\n<li><a href=\"/SpringSecurity2_3/#dependencies\">Dependencies</a></li>\n<li><a href=\"/SpringSecurity2_3/#%EC%B4%88%EA%B8%B0%ED%99%94-%EA%B3%BC%EC%A0%95\">초기화 과정</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity2_3/#jwt\">Jwt</a></p>\n<ul>\n<li><a href=\"/SpringSecurity2_3/#jwt-api-%EC%84%A4%EC%A0%95-%EA%B2%80%EC%A6%9D-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4\">Jwt API 설정, 검증 프로세스</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity2_3/#token-%EA%B2%80%EC%A6%9D\">Token 검증</a></p>\n<ul>\n<li>\n<p><a href=\"/SpringSecurity2_3/#%EC%9A%A9%EC%96%B4-%EC%A0%95%EB%A6%AC\">용어 정리</a></p>\n<ul>\n<li><a href=\"/SpringSecurity2_3/#jca-jce\">JCA, JCE</a></li>\n<li><a href=\"/SpringSecurity2_3/#%EB%8C%80%EC%B9%AD%ED%82%A4-%EB%B9%84%EB%8C%80%EC%B9%AD%ED%82%A4\">대칭키, 비대칭키</a></li>\n<li><a href=\"/SpringSecurity2_3/#jwt-1\">JWT</a></li>\n<li><a href=\"/SpringSecurity2_3/#jwk\">JWK</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity2_3/#token-%EA%B2%80%EC%A6%9D-%EA%B5%AC%ED%98%84\">Token 검증 구현</a></p>\n<ul>\n<li><a href=\"/SpringSecurity2_3/#mac-%EB%B0%A9%EC%8B%9D\">MAC 방식</a></li>\n<li><a href=\"/SpringSecurity2_3/#rsa-%EB%B0%A9%EC%8B%9D\">RSA 방식</a></li>\n<li><a href=\"/SpringSecurity2_3/#%ED%86%A0%ED%81%B0-%EA%B2%80%EC%A6%9D-%ED%9B%84-%EC%9D%B8%EC%A6%9D%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1\">토큰 검증 후 인증객체 생성</a></li>\n<li><a href=\"/SpringSecurity2_3/#%EA%B2%80%EC%A6%9D-%EA%B3%BC%EC%A0%95-%EC%A0%95%EB%A6%AC\">검증 과정 정리</a></li>\n<li><a href=\"/SpringSecurity2_3/#scope-customizing\">Scope Customizing</a></li>\n<li><a href=\"/SpringSecurity2_3/#opaque\">Opaque</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity2_3/#resource-server-%EA%B5%AC%ED%98%84\">Resource Server 구현</a></p>\n<ul>\n<li><a href=\"/SpringSecurity2_3/#scope\">Scope</a></li>\n<li><a href=\"/SpringSecurity2_3/#opaque-1\">opaque</a></li>\n</ul>\n</li>\n<li><a href=\"/SpringSecurity2_3/#reference\">Reference</a></li>\n</ul>","fields":{"slug":"/SpringSecurity2_3/"},"frontmatter":{"title":"Spring Security OAuth2.0 Resource Server","date":"Feb 17, 2023","tags":["Spring"],"keywords":["Spring","Security"],"update":"Mar 25, 2023"}}},"pageContext":{"slug":"/SpringSecurity2_3/","series":[{"slug":"/SpringSecurity2_1/","title":"Spring Security OAuth2.0 개념 파악하기","num":1},{"slug":"/SpringSecurity2_2/","title":"Spring Security OAuth2.0 Client","num":2},{"slug":"/SpringSecurity2_3/","title":"Spring Security OAuth2.0 Resource Server","num":3},{"slug":"/SpringSecurity2_4/","title":"Spring Security OAuth2.0 Authorization Server","num":4}],"lastmod":"2023-03-25"}},"staticQueryHashes":["2027115977","694178885"]}