{"componentChunkName":"component---src-templates-post-tsx","path":"/SpringSecurity1/","result":{"data":{"markdownRemark":{"html":"<p>해당 포스팅은 정수원님의<br>\n<a href=\"https://www.inflearn.com/course/%EC%BD%94%EC%96%B4-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0/dashboard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스프링 시큐리티 - Spring Boot 기반으로 개발하는 Spring Security</a> 강의와 <a href=\"https://www.inflearn.com/course/%EC%A0%95%EC%88%98%EC%9B%90-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0#\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스프링 시큐리티 OAuth2 - Spring Boot 기반으로 개발하는 Spring Security OAuth2</a>의 Spring Security Fundamentals section을 참고하여 작성했습니다.</p>\n<p>강의 예제는 <a href=\"https://github.com/spring-projects/spring-boot/releases/tag/v3.0.1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">springboot starter 3.0.1</a>\n(security 6.0.1)을 사용해 진행</p>\n<!-- TODO: https://lelecoder.com/140 보고 필터 관련 글 써보자 -->\n<h1 id=\"용어-정리\" style=\"position:relative;\"><a href=\"#%EC%9A%A9%EC%96%B4-%EC%A0%95%EB%A6%AC\" aria-label=\"용어 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>용어 정리</h1>\n<p>인증 : 어떤 개체(사용자 또는 장치)의 신원을 확인하는 과정<br>\n인가 : 어떤 개체가 어떤 리소스에 접근할 수 있는지 또는 어떤 동작을 수행할 수 있는지를 검증하는 것, 즉 접근 권한을 얻는 일</p>\n<h1 id=\"기본-api-및-filter\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8-api-%EB%B0%8F-filter\" aria-label=\"기본 api 및 filter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본 API 및 Filter</h1>\n<h2 id=\"자동-구성-항목\" style=\"position:relative;\"><a href=\"#%EC%9E%90%EB%8F%99-%EA%B5%AC%EC%84%B1-%ED%95%AD%EB%AA%A9\" aria-label=\"자동 구성 항목 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자동 구성 항목</h2>\n<p>Spring Security 의존성 추가 시 자동 구성</p>\n<ul>\n<li>모든 요청은 인증이 되어야 접근</li>\n<li>인증 방식 Form 로그인 방식 / httpBasic 로그인 방식 제공</li>\n<li>기본 로그인 페이지 제공 (기본 계정 : id : user / password 랜덤 문자열)</li>\n<li>CSRF 공격 방지</li>\n<li>세션 고정 보호</li>\n<li>보안 헤더 통합</li>\n</ul>\n<p>추가로 계정 추가, 권한 추가, DB연동 등 작업 필요</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token annotation punctuation\">@EnableWebSecurity</span> <span class=\"token comment\">// WebSecurity Configuration, Web보안 활성화</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfig</span><span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">filterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 인가 정책</span>\n        http\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeHttpRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>authz<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> authz <span class=\"token comment\">// 규칙 지정</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 모든 요청이 인증을 요청하게 설정</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token comment\">// 인증 정책</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://docs.spring.io/spring-security/reference/servlet/authorization/authorize-http-requests.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http요청 승인</a></p>\n<p>설정하고 서버를 실행하면 user계정의 password가 실행 마다 변경되면서 console창에 노출이 되는데</p>\n<p>application.properties파일에 이를 명시할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">spring.security.user.name=user\nspring.security.user.password=1111</code></pre></div>\n<h2 id=\"login-form-인증-과정\" style=\"position:relative;\"><a href=\"#login-form-%EC%9D%B8%EC%A6%9D-%EA%B3%BC%EC%A0%95\" aria-label=\"login form 인증 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Login Form 인증 과정</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/340459b8a72e8ea8b21ca2da5bb4ad7d/8963a/loginFormProccess.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.05405405405406%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAADjElEQVQ4y1WUyXIbVRRA8wMsEOUobqm71ZO6pbQka2wNnid5SJzyULFxLGRZlh0XGcumqAqQgCInHgKhEkLWrGETqqhiwQ/wA1my4zsOT+0kyIvbt/pVv/POffe9vhCOGEiKhh6N4VWGqIyOUx6fojxRxU3nkPUosmaiWQ7O5QTTJYeFYYerw3FmylHmyiZeUqNfMeiyLnQfIVVHNaLYThxLkZGXWki3jlAdF7lfQjNtImaM6vQ4L/cKvGnP8NvDKr8+nOaPzgwHyw6fSJpYWABDahdooER0QgMl+goTaFPLGHPrBItTSMUJlGjch3YtZMMW5lkmpmeEdcyvLCyqkBS9x1CUFJZCJL96zdW//mXhzVsWf3/L8p//4P3yN3J2EFk1KWVs9pds7i65PLiR44u1DPsrCXbmo+iGhqT2GMoCbJdGccbmSS2sk1lpYI9dwRqaJiIMJQGcHMrx5XqOg/Ui91dz3FpMcf96jq25y0S0c0AdRWhHdBOpr4+++TqBVhs5Kj6UFbF/NqbYX29wlHi2QiI/RDTl8bFk+BEInUmFew270IjpYLspnFRWTCqhCTPdjvsd7jat2+1ozMUUY5lcQYzbYt90f/w9wwe+73RI5EQmj1ceJFsoEgiGCIYjfikhVXRRVRnIZMjmc0xOieYZAiTLhBVF2Gnnj01Yt9lbLvDNRpoHGzm+ruX5tlHm0aZHwnWYHUlz0vJ4VMvwXT1Pu56js+XRbhQ4vTlIayFFUP4AFHTd4d6KmNRwOaynRCT9eLwRI5lwmB92eVbTOd50Od1KciLySSPByVaK7+sWrRmNoGL1ADWbO6slnjYLYlWPTrNMe1NY1gYEME61HKO9EuLJdpGn2x5HIh+1ShztVOh8qvHZWIhLavQdUFw9xXK5NxvkZdPi57tDvLpd4tXneR5f+4hUwmZuMMbRatC3etYUVq2Mn7vGx2v9NCfFfis9QNWKszYZ4851j4OtK+w35tmvV2lWTWJxce0qMTo3bGFepNPIcygqOWx6HLYqPKm71CZULnVL7j02F8UKgZBJoD8iQiMg6fTJUYKqzbWROC92UjzfK/F8NyciLyzT/LDr8dPNNDuz7/bwf6Bxdqb8c2V8CCXS/dBgcTLLj3tljnfKfldPdyscbxf89xe3R9hdSHJRNs4Dz8PPrLuH1hJ/HTeVZiA9gJtMiHtrYJgmhmWdZdMQPw/Ln/MfIwkY7eMLpXQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"loginFormProccess\"\n        title=\"loginFormProccess\"\n        src=\"/static/340459b8a72e8ea8b21ca2da5bb4ad7d/fcda8/loginFormProccess.png\"\n        srcset=\"/static/340459b8a72e8ea8b21ca2da5bb4ad7d/12f09/loginFormProccess.png 148w,\n/static/340459b8a72e8ea8b21ca2da5bb4ad7d/e4a3f/loginFormProccess.png 295w,\n/static/340459b8a72e8ea8b21ca2da5bb4ad7d/fcda8/loginFormProccess.png 590w,\n/static/340459b8a72e8ea8b21ca2da5bb4ad7d/efc66/loginFormProccess.png 885w,\n/static/340459b8a72e8ea8b21ca2da5bb4ad7d/c83ae/loginFormProccess.png 1180w,\n/static/340459b8a72e8ea8b21ca2da5bb4ad7d/8963a/loginFormProccess.png 1918w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li><strong>UsernamePasswordAuthenticationFilter</strong> 에서 요청 ID, Password를 통해 Token을 생성한다</li>\n<li>생성한 token을 <strong>AuthenticationManager</strong>에서 확인한다.</li>\n<li>실패 시\n3.1) <a href=\"https://docs.spring.io/spring-security/reference/servlet/authentication/architecture.html#servlet-authentication-securitycontextholder\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SecurityContextHolder</a>에서 인증 정보가 지워진다.<br>\n3.2) <a href=\"https://docs.spring.io/spring-security/site/docs/6.0.1/api/org/springframework/security/web/authentication/RememberMeServices.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">RememberMeServices.loginFail</a>이 호출된다.<br>\n3.3) SecurityConfig에서 설정한 <strong>AuthenticationFailureHandler</strong>가 호출 된다.</li>\n<li>성공 시<br>\n4.1) <strong>SessionAuthenticationStrategy</strong>에 새로운 로그인을 알린다.<br>\n4.2)<a href=\"https://docs.spring.io/spring-security/reference/servlet/authentication/architecture.html#servlet-authentication-securitycontextholder\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SecurityContextHolder</a>에 인증정보(username, password, authorities(사용자의 권한 정보)) 저장<br>\n4.3) ApplicationEventPublisher 생성<br>\n4.4) SecurityConfig에서 설정한 <strong>AuthenticationSuccessHandler</strong>가 호출 된다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">http\n        <span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// form 로그인 인증 기능 적용</span>\n<span class=\"token comment\">//                .loginPage(\"/loginPage\")</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">defaultSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">failureUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">usernameParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">passwordParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"password\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login_proc\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">successHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 요청, 응답, 인증 객체</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                response<span class=\"token punctuation\">.</span><span class=\"token function\">sendRedirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationFailureHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n\n                response<span class=\"token punctuation\">.</span><span class=\"token function\">sendRedirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"logout과정\" style=\"position:relative;\"><a href=\"#logout%EA%B3%BC%EC%A0%95\" aria-label=\"logout과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Logout과정</h2>\n<p>CompositeLogoutHandler의 구성을 살펴보면 logout handler로 CookieClearing, CsrfLogoutHandler, SecurityContextLogoutHandler, LogoutSuccessEventPublishingLogoutHandler이 구성되어 있다</p>\n<p>logout시 동작을 대략적으로 정리해보면</p>\n<ol>\n<li>HTTP 세션 무효화</li>\n<li>구성된 모든 RememberMe 인증 정리</li>\n<li>SecurityContextHolder.clearContext()</li>\n<li>리다이렉션</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">http\n        <span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">logoutUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/logout\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">logoutSuccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"login\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">addLogoutHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LogoutHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> authentication authentication<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">HttpSession</span> session <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                session<span class=\"token punctuation\">.</span><span class=\"token function\">invalidate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">logoutSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LogoutSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onLogoutSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n                    response<span class=\"token punctuation\">.</span><span class=\"token function\">sendRedirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">deleteCookies</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"remember-me\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a href=\"https://docs.spring.io/spring-security/reference/servlet/authentication/logout.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring security logout</a></p>\n<h2 id=\"rememberme-인증-영구-로그인-인증\" style=\"position:relative;\"><a href=\"#rememberme-%EC%9D%B8%EC%A6%9D-%EC%98%81%EA%B5%AC-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%9D%B8%EC%A6%9D\" aria-label=\"rememberme 인증 영구 로그인 인증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RememberMe 인증 (영구 로그인 인증)</h2>\n<blockquote>\n<p><strong>토근 기반 인증</strong>을 사용해 세션이 만료되고 웹 브라우저가 종료된 후에도 App이 사용자를 기억하는 기능</p>\n</blockquote>\n<p>Spring Security는 2가지 방법 제공</p>\n<ul>\n<li>\n<ol>\n<li>해싱을 사용하여 쿠키 기반 토큰의 보안 유지 기능 (보통 14일)</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>DB / 기타 영구 저장 매커니즘을 사용해 생성된 토큰 저장</li>\n</ol>\n</li>\n</ul>\n<p><a href=\"https://docs.spring.io/spring-security/reference/servlet/authentication/rememberme.html#remember-me-persistent-token\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">영구 저장 토큰 방식</a></p>\n<h3 id=\"인증-과정\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D-%EA%B3%BC%EC%A0%95\" aria-label=\"인증 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증 과정</h3>\n<ol>\n<li>세션이 만료 되었거나, Security Context에 인증 정보가 없는 경우(인증 객체가 Null인 경우) <strong>RememberMeAuthenticationFilter</strong>가 탐지</li>\n<li>Token 일치 여부 -> User계정 확인 -> 새로운 Authentication 생성</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">http\n  <span class=\"token punctuation\">.</span><span class=\"token function\">rememberMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">rememberMeParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"remember\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 파라미터 변경 / 기본 파라미터 명은 remember-me</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">tokenValiditySeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">3600</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// remeberme 시간 설정 가능 / default(14)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">alwaysRemember</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 기능이 활성화 되지 않아도 항상 리하는 것 여부 / default false</span>\n  <span class=\"token function\">userDetailsService</span><span class=\"token punctuation\">(</span>userDetailsService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 사용자 계정을 조회하는 과정 (필수로 설정 해야한다)</span></code></pre></div>\n<ul>\n<li>rememberMeParameter 이름을 화면상의 이름과 일치 시켜 준다.</li>\n<li>사용 시 remember-me 쿠키값이 추가된다.</li>\n</ul>\n<h3 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h3>\n<ul>\n<li>Remember Me기능 사용 시, 스프링 시큐리티는 인증 객체 관련 정보를 Remember Me 쿠키에 저장한 후 사용자에게 전달</li>\n<li>Remember Me 쿠키가 유효하면 JSESSIONID가 없어도 Remember Me 쿠키를 통해 로그인 처리</li>\n</ul>\n<h2 id=\"익명사용자-필터\" style=\"position:relative;\"><a href=\"#%EC%9D%B5%EB%AA%85%EC%82%AC%EC%9A%A9%EC%9E%90-%ED%95%84%ED%84%B0\" aria-label=\"익명사용자 필터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>익명사용자 필터</h2>\n<blockquote>\n<p>AnonymousAuthenticationFilter가 처리 하는데, 익명 사용자와 인증 사용자를 구분해서 처리하기 위한 용도</p>\n</blockquote>\n<p>Authentication을 검사하고 사용자의 Authentication정보가 아니라면 AnonymousAuthenticationToken을 생성 후 SecurityContext에 넣는다.</p>\n<ul>\n<li>화면에서 인증 여부를 구현할 때 isAnonymous()와 isAuthenticated()로 구분해서 사용</li>\n<li>인증 객체를 세션에 저장하지 않는다.</li>\n<li>사용자가 인증을 받지 않았으면 인증되지 않은 사용자의 토큰을 만들어 인증된 사용자와 구분하기 위한 용도</li>\n</ul>\n<p>잠시 정리를 해보면 Spring Security는 기본적으로<br>\n<strong>SecurityContextHolder 내부의 SecurityContext에 인증정보가 담긴 Authentication 객체 값이 존재</strong><br>\n해야 하는 구조로 <strong>익명 사용자라 할지라도 Authentication 객체가 null이 아니다</strong></p>\n<h2 id=\"동시-세션-제어\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%8B%9C-%EC%84%B8%EC%85%98-%EC%A0%9C%EC%96%B4\" aria-label=\"동시 세션 제어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동시 세션 제어</h2>\n<blockquote>\n<p>동일한 계정으로 접속했을 때 만들어지는 세션을 제어하는 방법</p>\n</blockquote>\n<ol>\n<li>\n<p>이전 사용자 세션 만료</p>\n<blockquote>\n<p>동일 계정으로 누군가 로그인 했을 때, 이전에 사용하던 사용자의 세션을 만료</p>\n</blockquote>\n</li>\n<li>\n<p>현재 사용자 인증 실패</p>\n<blockquote>\n<p>이미 동일 계정으로 접속하고 있는 사람이 있을 경우, 현재 인증 요청한 사용자의 인증 과정에서 인증 예외 처리</p>\n</blockquote>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 동시 세션 제어</span>\nhttp\n        <span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">maximumSessions</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>                 <span class=\"token comment\">// 최대 허용 가능 세션 수 (1) , -1 -> 무제한 로그인 세션 허용</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">maxSessionsPreventsLogin</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">// true : 현재 사용자 인증 실패, false : 기존 사용자 인증 실패</span>\n<span class=\"token comment\">//      .invalidSessionUrl(\"/invalid\")      // 세션이 유효하지 않을 경우 이동 할 페이지</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">expiredUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/expired\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">// 세션이 만료 된 경우 이동 할 페이지</span></code></pre></div>\n<h2 id=\"세션-고정-보호\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98-%EA%B3%A0%EC%A0%95-%EB%B3%B4%ED%98%B8\" aria-label=\"세션 고정 보호 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션 고정 보호</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 세션 고정 보호</span>\nhttp\n        <span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">// 세션 관리 설정 모드 사용.</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">sessionFixation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">changeSessionId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 기존 사용자의 세션에 Session ID만 변경</span>\n<span class=\"token comment\">//          .none();            //세션 고정 보호를 하지 않음.</span>\n<span class=\"token comment\">//          .newSession()       // 인증 성공 시 새로운 세션 사용</span></code></pre></div>\n<h2 id=\"세션-정책\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98-%EC%A0%95%EC%B1%85\" aria-label=\"세션 정책 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션 정책</h2>\n<blockquote>\n<p>세션 생성, 사용 여부를 설정 가능 (ALWAYS, IF_REQUIRED, NEVER, STATELESS)</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 세션 정책</span>\nhttp\n        <span class=\"token punctuation\">.</span><span class=\"token function\">sessionManagement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//      .sessionCreationPolicy(SessionCreationPolicy.ALWAYS);     // Spring Security가 항상 세션 설정</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">sessionCreationPolicy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SessionCreationPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IF_REQUIRED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 필요 시 생성(default)</span>\n<span class=\"token comment\">//      .sessionCreationPolicy(SessionCreationPolicy.NEVER);      // 생성x, 존재하면 사용</span>\n<span class=\"token comment\">//      .sessionCreationPolicy(SessionCreationPolicy.STATELESS);  // 생성x, 존재해도 사용x (JWT 사용 시)</span></code></pre></div>\n<h2 id=\"sessionmanagementfilter-concurrentsessionfilter\" style=\"position:relative;\"><a href=\"#sessionmanagementfilter-concurrentsessionfilter\" aria-label=\"sessionmanagementfilter concurrentsessionfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SessionManagementFilter, ConcurrentSessionFilter</h2>\n<p>SessionManagementFilter는</p>\n<ul>\n<li>동시 세션 제어</li>\n<li>세션 고정 보호</li>\n<li>세션 관리</li>\n<li>세션 생성 정책 설정</li>\n</ul>\n<p>4가지 기능을 수행하는데 동시 세션을 관리하는데 있어서 ConcurrentSessionFilter의 도움을 받는다.</p>\n<p><strong>사용자 요청이 들어올 때 마다, ConcurrentSessionFilter를 통해 매번 세션이 만료되었는지 확인</strong>\n-> 만료 되었으면 <strong>1. 로그아웃, 2. 세션 만료를 사용자에게 알림</strong></p>\n<h2 id=\"권한-설정과-표현식\" style=\"position:relative;\"><a href=\"#%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95%EA%B3%BC-%ED%91%9C%ED%98%84%EC%8B%9D\" aria-label=\"권한 설정과 표현식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>권한 설정과 표현식</h2>\n<blockquote>\n<p>URL과 Method에 대해 권한 설정</p>\n</blockquote>\n<h3 id=\"선언적-방식\" style=\"position:relative;\"><a href=\"#%EC%84%A0%EC%96%B8%EC%A0%81-%EB%B0%A9%EC%8B%9D\" aria-label=\"선언적 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>선언적 방식</h3>\n<blockquote>\n<p>URL과 Method 방식 존재</p>\n</blockquote>\n<h4 id=\"1-url\" style=\"position:relative;\"><a href=\"#1-url\" aria-label=\"1 url permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. URL</h4>\n<blockquote>\n<p>HttpSecurity 객체를 사용해 설정</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">http\n    <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/users/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"USER\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<details>\n<summary><b>Http 객체 설정 (Toggle)</b></summary>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Describe</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>hasRole(String)</td>\n<td>사용자가 주어진 역할이 있다면 접근 허용</td>\n</tr>\n<tr>\n<td>hasAuthority(String)</td>\n<td>사용자가 주어진 권한이 있다면 접근 허용 ex) hasAuthority('read')</td>\n</tr>\n<tr>\n<td>hasAnyRole(String...,)</td>\n<td>사용자가 주어진 권한이 있다면 접근 허용. (하나라도 있으면 , 로 구분)</td>\n</tr>\n<tr>\n<td>hasAnyAuthority(String...)</td>\n<td>사용자가 주어진 권한 중 어떤 것이라도 있따면 접근 허용</td>\n</tr>\n<tr>\n<td>hasIpAddress(String)</td>\n<td>주어진 IP로부터 요청이 온 경우 접근 허용</td>\n</tr>\n<tr>\n<td>permitAll()</td>\n<td>모든 요청 허용</td>\n</tr>\n<tr>\n<td>denyAll()</td>\n<td>모든 요청 접근 차단</td>\n</tr>\n<tr>\n<td>isAuthenticated()</td>\n<td>로그인 인증을 받은 사용자는 권한에 관계 없이 허용, 익명 사용자는 로그인 페이지로 이동</td>\n</tr>\n<tr>\n<td>isFullyAuthenticated()</td>\n<td>자동 로그인하지 않고 로그인 인증을 한 사용자는 권한에 관계 없이 허용</td>\n</tr>\n<tr>\n<td>isAnonymous()</td>\n<td>권한이 없는 익명의 사용자만 접근을 허용함 (로그인되어 권한이 있으면 접근 불가)</td>\n</tr>\n<tr>\n<td>isRememberMe()</td>\n<td>자동 로그인 대상 사용자의 경우 접근을 허용</td>\n</tr>\n</tbody>\n</table>\n</details>\n</br>\n<h4 id=\"method\" style=\"position:relative;\"><a href=\"#method\" aria-label=\"method permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Method</h4>\n<blockquote>\n<p>@Pre and @Post Annotations 어노테이션을 이용해 권한 설정</p>\n</blockquote>\n<p><a href=\"https://docs.spring.io/spring-security/reference/servlet/authorization/expression-based.html#_method_security_expressions\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@Pre and @Post Annotations doc</a></p>\n<h3 id=\"2-동적-방식-db연동\" style=\"position:relative;\"><a href=\"#2-%EB%8F%99%EC%A0%81-%EB%B0%A9%EC%8B%9D-db%EC%97%B0%EB%8F%99\" aria-label=\"2 동적 방식 db연동 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 동적 방식 (DB연동)</h3>\n<p>뒤에서 설명</p>\n<h3 id=\"주의-사항\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9D%98-%EC%82%AC%ED%95%AD\" aria-label=\"주의 사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주의 사항</h3>\n<ul>\n<li>경로 표현을 생략하는 경우 <strong>모든 요청은 인증을 받아야 접근 가능</strong></li>\n<li>구체적인 경로는 앞에 작성, 뒤로 갈 수록 큰 범위의 경로 설정</li>\n<li>하위 경로 표현 시 **로 표현</li>\n</ul>\n<h2 id=\"예외-처리-및-요청-캐시-필터\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%8F-%EC%9A%94%EC%B2%AD-%EC%BA%90%EC%8B%9C-%ED%95%84%ED%84%B0\" aria-label=\"예외 처리 및 요청 캐시 필터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예외 처리 및 요청 캐시 필터</h2>\n<blockquote>\n<p>에러 처리 기능은 <strong>ExceptionTranslationFilter()</strong>가 처리</p>\n</blockquote>\n<ul>\n<li>AuthenticationException -> 인증 예외 / AccessDeniedException -> 인가 예외</li>\n<li>RequestCache -> 사용자의 요청 정보 세션에 저장</li>\n<li>SavedRequest -> 사용자의 request 파라미터, 헤더값 등 저장</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">SavedRequest</span> savedRequest <span class=\"token operator\">=</span> requestCache<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"authenticationexception\" style=\"position:relative;\"><a href=\"#authenticationexception\" aria-label=\"authenticationexception permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthenticationException</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">filterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        http\n                <span class=\"token punctuation\">.</span><span class=\"token function\">exceptionHandling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authenticationEntryPoint</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationEntryPoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token annotation punctuation\">@Override</span>\n                    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">commence</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthenticationException</span> authException<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n                        response<span class=\"token punctuation\">.</span><span class=\"token function\">sendRedirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">accessDeniedHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AccessDeniedHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token annotation punctuation\">@Override</span>\n                    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AccessDeniedException</span> accessDeniedException<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n                        response<span class=\"token punctuation\">.</span><span class=\"token function\">sendRedirect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"denied\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"csrf처리\" style=\"position:relative;\"><a href=\"#csrf%EC%B2%98%EB%A6%AC\" aria-label=\"csrf처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSRF처리</h2>\n<blockquote>\n<p>Spring Security는 기본적으로 CSRF 사용 설정이 되어있으며, X-CSRF-TOKEN값을 헤더에 추가한다</p>\n</blockquote>\n<p>view template, Spring form 태그 사용 시 csrf토큰이 자동으로 설정</p>\n<p>기본적인 폼태그 사용할 땐 _csrf 값으로 추가</p>\n<h1 id=\"주요-아키텍처\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9A%94-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98\" aria-label=\"주요 아키텍처 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주요 아키텍처</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/20e367d35b8dc6d9ce15855ecfccf33a/70d4c/DelegatingFilterAndFilterChainProxy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB3ElEQVQoz11STWsaURT1b3Rd6LbQXVfabrPub3DhH5goSITSlnbnorrookGiQoPFItJkWQQX1Uk7xoYm8VsTZhzHGTszb75P5z0zSciFwzuce97HvffFTNOEYRgMuq4zUE71+7AsC47jMFCPoijQNA3r9fqWU18MYSihKAg99Pt/cDkYMM7zPFRVRRS2bbONVBMEAd1uN/T30ev10Ol0MJlMmC8WBEG4BDD+aZhPx5iOh1AVGa5jw/U8bPNAvV4Hx3FIp9MolUpMi3JR+L6/faHtAaIOnC809McyFqoP4t8ZZVlGrVZDuVxmqFarWK1WN4fe+egFMd9UcfJ3jt33n/A6v493Hw/AvS3i8KjNerLZbCBJEpLJJBKJBOLxOFKpFNMtYkPaXOP411c0+S+YK8PwhWSNH/wFnjxL4PnLHbzYeYVHj5/iTf4zu5UOYzabIZPJIJfLIZvNMiyXS/hugIF0hnxzDx++cThd/NyWLGoOjoUVvp9co9m9wtFvGWdX5m0po9EIxWIR7XYbrVYLhUIBoiiynOu7IJ4B4upwPDsaCuA5FqaTIYaX52xAUZNp0C9Bh0J7V6lU0Gg0QAi5adyDHtKSaNI0SbharETKTUKYTkG1+xOlPNr3EP8BedGD5+fu6w0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"DelegatingFilterAndFilterChainProxy\"\n        title=\"DelegatingFilterAndFilterChainProxy\"\n        src=\"/static/20e367d35b8dc6d9ce15855ecfccf33a/fcda8/DelegatingFilterAndFilterChainProxy.png\"\n        srcset=\"/static/20e367d35b8dc6d9ce15855ecfccf33a/12f09/DelegatingFilterAndFilterChainProxy.png 148w,\n/static/20e367d35b8dc6d9ce15855ecfccf33a/e4a3f/DelegatingFilterAndFilterChainProxy.png 295w,\n/static/20e367d35b8dc6d9ce15855ecfccf33a/fcda8/DelegatingFilterAndFilterChainProxy.png 590w,\n/static/20e367d35b8dc6d9ce15855ecfccf33a/efc66/DelegatingFilterAndFilterChainProxy.png 885w,\n/static/20e367d35b8dc6d9ce15855ecfccf33a/c83ae/DelegatingFilterAndFilterChainProxy.png 1180w,\n/static/20e367d35b8dc6d9ce15855ecfccf33a/70d4c/DelegatingFilterAndFilterChainProxy.png 2548w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4 id=\"servlet-container\" style=\"position:relative;\"><a href=\"#servlet-container\" aria-label=\"servlet container permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Servlet Container</h4>\n<ul>\n<li><strong>SecurityFilterAutoConfiguration</strong>에서 springSecurityFilterChain을 가져올 수 있게 DelegatingFilterProxy가 생성</li>\n</ul>\n<h4 id=\"spring-container\" style=\"position:relative;\"><a href=\"#spring-container\" aria-label=\"spring container permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring Container</h4>\n<ul>\n<li><strong>WebSecurityConfiguration</strong> 클래스에서 WebSecurity 클래스가 <strong>springSecurityFilterChain이름으로 생성된 Bean들을 FilterChainProxy로 생성</strong>시켜 준다.</li>\n</ul>\n<p><strong>모든 요청은 DelegatingFilterProxy에서 시작</strong></p>\n<h2 id=\"delegatingfilterproxy\" style=\"position:relative;\"><a href=\"#delegatingfilterproxy\" aria-label=\"delegatingfilterproxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DelegatingFilterProxy</h2>\n<p>Filter는 Servlet 2.3에서 부터 제공되는 기술로<br>\n<strong>서블렛을 통해 어떤 요청이 들어올 때 서블릿 자원에 들어오기 전에 처리</strong><br>\n즉, 요청에 대한 최종 접근 전, 후로 처리할 수 있게 하는 것이다.</p>\n<p>이 필터는 서블릿 스펙의 기술이며 Servlet 컨테이너에서 생성되고, 실행이 되기 때문에<br>\nSpring에서 만든 Bean을 Injection 해서 사용할 수 없다.</p>\n<p>Spring이 사용하는 기능을 사용하기 위해</p>\n<p><strong>DelegatingFilterProxy</strong>는 <strong>ApplicationContext</strong>에서<br>\n<strong>springSecurityFilterChain이름을 가진 스프링 빈(FilterChainProxy)을 찾아서 그 빈에게 요청을 위임</strong>한다</p>\n<h2 id=\"filterchainproxy\" style=\"position:relative;\"><a href=\"#filterchainproxy\" aria-label=\"filterchainproxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FilterChainProxy</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4f6780b6c3149c5126721058e8552a30/6d2da/filterChainProxy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.24324324324324%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABYUlEQVQ4y32T65KDIAyF+1p7URBUBLQzu3a3O33/98gmgShDtT8ywTL9OMlJLmO8wj1G+PMYYYFHXODuZ3DOQz8FGDBcmGHE+x5/c3hvMX+oDt5bzbmMizIW1lnB5CYGUBg8D3z2nAlmBgef2kDbWc6nQG17+I4K3JiAlnJWx9ntUFJK38oOLxQyUIMnhT6VKLFBUKnuR2hNz5ASVENZ4YoKfS6ZIBJdhjRY5lujDhU9AXeFHuzkU998Alt8pP6TKCyVlvcItPC7aAhiivQvw6WPFNJfepDOpyV/hWQKjYMZ3QZiAJ7HkEamQXfPFMqZS/6ZSSG9TL3bx2UQk3ILqKfUTwpymvJhD1fs4UJlMiAPdOW4QB2qpTPNJUFPgAqBnkvegDnEJCndxZmdL12vSrZww02J1L/CgNoQWb22KvNQ4Q1LvpYrl4Hl+smWnI3L0xwKMJmyl8o9w++mMy93WOIf7v/1OovmunEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"filterChainProxy\"\n        title=\"filterChainProxy\"\n        src=\"/static/4f6780b6c3149c5126721058e8552a30/fcda8/filterChainProxy.png\"\n        srcset=\"/static/4f6780b6c3149c5126721058e8552a30/12f09/filterChainProxy.png 148w,\n/static/4f6780b6c3149c5126721058e8552a30/e4a3f/filterChainProxy.png 295w,\n/static/4f6780b6c3149c5126721058e8552a30/fcda8/filterChainProxy.png 590w,\n/static/4f6780b6c3149c5126721058e8552a30/efc66/filterChainProxy.png 885w,\n/static/4f6780b6c3149c5126721058e8552a30/6d2da/filterChainProxy.png 936w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>springSecurityFilterChain의 이름으로 생성되는 필터 빈</li>\n<li>DelegatingFilterProxy로 부터 요청을 위임받고 실제 보안 처리</li>\n<li>SpringSecurity 초기화 시 생성되는 필터들을 관리하고 제어</li>\n<li>사용자 요청을 필터 순서대로 호출하여 전달</li>\n<li>모든 Filter를 통과 시 보안 처리 완료</li>\n</ol>\n<h2 id=\"filter-초기화-다중-보안-설정\" style=\"position:relative;\"><a href=\"#filter-%EC%B4%88%EA%B8%B0%ED%99%94-%EB%8B%A4%EC%A4%91-%EB%B3%B4%EC%95%88-%EC%84%A4%EC%A0%95\" aria-label=\"filter 초기화 다중 보안 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Filter 초기화 다중 보안 설정</h2>\n<blockquote>\n<p>여러개의 SecurityFilterChain 클래스를 만들어 url에 따라 다른 보안 정책이 적용될 수 있게 설정하면 WebSecurity에서 FilterChainProxy가 만들어 질 때 url에 따라 다른 정책이 적용될 수 있게 filter chain이 생성된다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token annotation punctuation\">@Order</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">apiFilterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        http\n                <span class=\"token punctuation\">.</span><span class=\"token function\">securityMatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/**\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeHttpRequests</span><span class=\"token punctuation\">(</span>authorize <span class=\"token operator\">-></span> authorize\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ADMIN\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">httpBasic</span><span class=\"token punctuation\">(</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityFilterChain</span> <span class=\"token function\">filterChain</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/72a7742ec283e06fa237948fd5886ea2/f4fb1/securityFilterChains.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.243243243243242%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAp0lEQVQY042OvQ7CQAyD+zQgMVRdEIK20PtNLnd0QAy8/4uYXAsdEcMnx5ZiuTkawWkSHKeE9spob4xO785kHEbC7uw39pdK+Ekj7PGQhDtlhJhgSGAVxwU2FTi5w+d5RWYMjjDYiPGjvQ2arb5X3+Rk8cwJmQXMCTEJSPKiFc5l4ettILhIm7rIcMTLbYIWiha+CmPWhbXQa3GUAk+6Vp+q1mw07i/evfKOWAQdJzIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"securityFilterChains\"\n        title=\"securityFilterChains\"\n        src=\"/static/72a7742ec283e06fa237948fd5886ea2/fcda8/securityFilterChains.png\"\n        srcset=\"/static/72a7742ec283e06fa237948fd5886ea2/12f09/securityFilterChains.png 148w,\n/static/72a7742ec283e06fa237948fd5886ea2/e4a3f/securityFilterChains.png 295w,\n/static/72a7742ec283e06fa237948fd5886ea2/fcda8/securityFilterChains.png 590w,\n/static/72a7742ec283e06fa237948fd5886ea2/efc66/securityFilterChains.png 885w,\n/static/72a7742ec283e06fa237948fd5886ea2/c83ae/securityFilterChains.png 1180w,\n/static/72a7742ec283e06fa237948fd5886ea2/f4fb1/securityFilterChains.png 1766w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a href=\"https://docs.spring.io/spring-security/reference/servlet/configuration/java.html#_multiple_httpsecurity_instances\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">multiple-httpsecurity- instances - Spring Security Doc</a></p>\n<h2 id=\"인증authentication\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9Dauthentication\" aria-label=\"인증authentication permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증(Authentication)</h2>\n<blockquote>\n<p>어떤 개체(사용자 또는 장치)의 신원을 확인하는 과정</p>\n</blockquote>\n<p><a href=\"#login-form-%EC%9D%B8%EC%A6%9D-%EA%B3%BC%EC%A0%95\">인증 흐름</a>과 같이 진행이 되고 생성되는 Authentication Token의 구조를 살펴보면</p>\n<ol>\n<li>principal : 사용자 ID 또는 User객체</li>\n<li>credentials : 사용자 비밀번호, 대부분의 경우에 인증된 후 값이 지워져서 유출되지 않는다.</li>\n<li>authorities : 인증된 사용자의 권한 목록</li>\n<li>details : 인증 부가 정보</li>\n<li>Authenticated : 인증 여부</li>\n</ol>\n<p>로 이루어져 있다.</p>\n<p>UsernamePasswordAuthenticationFilter -> Authentication 객체<br>\n-> AuthenticationManager의 구현체 ProviderManager가 인증 처리</p>\n<h3 id=\"securitycontext\" style=\"position:relative;\"><a href=\"#securitycontext\" aria-label=\"securitycontext permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityContext</h3>\n<blockquote>\n<p>필요 시 언제든지 Authentication 객체를 꺼내 쓸 수 있게 저장되는 저장소</p>\n</blockquote>\n<ul>\n<li>ThreadLocal에 저장되어 아무 곳에서나 참조 가능</li>\n<li>인증 완료 시, Httpsession에 저장 (App내 전역적인 참조 가능)</li>\n</ul>\n<h3 id=\"securitycontextholder\" style=\"position:relative;\"><a href=\"#securitycontextholder\" aria-label=\"securitycontextholder permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityContextHolder</h3>\n<blockquote>\n<p>SecurityContext를 감싸고 있는 wrapper 클래스</p>\n</blockquote>\n<ul>\n<li>\n<p>SecurityContext객체 저장 방식</p>\n<ul>\n<li>MODE_THREADLOCAL : 스레드 당 SecurityContext 객체 할당 (default)</li>\n<li>MODE_INHERITABLETHREADLOCAL : 메인 스레드와 자식 스레드에 관하여 동일한 SecurityContext를 유지</li>\n<li>MODE_GLOBAL : 응용 프로그램에서 단 하나의 SecurityContext저장 (static 변수로)</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/088166de4a83f6231408e6dc2f191e99/95be1/SecurityContextHolderFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21621621621622%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABoklEQVQoz11S3U7iQBjto/ICXHODPsE+wXrDDUYvSFaBTRRBIrs1GBTbGCO2GpFUI0JLZzrTX3J2vvE32+TkfO1Mz3e+M2NEUQQhBIjfwJHGKe68CeoHW2gOd9A628XesI7x/SkStSal/MTHv8QE40voC4KYMzAeImQrzBcvuqZmYRhisVhguVxq0H7+DqqNOI6RJAnSNEWWZbqOlAuRZLqjFBK+74MzDnoajQbK5TIqlQqq1Spms0dgnaFIhJpMOXRdF5ZlodvtolQqwTRNSKuPV/O37vgwncJxHO0mCAK0223UajUtvF1XMVg2BhMfv0Yermc+jPl8Ds/z4Cjh/WYTN5NbuOcmnNFfMMa0O9pDdVEUaLVa6PV6GI8v0e/3cTY6x6HlYfePi4tbD4aUMdZFpobJ9UipZLi0bdjXN1qMIqBYyC1FYqs1ctnpdBSOdLMilcjiCLFQGa7zGCcXHjZ+WvhRv8Km4uPhPSLmI1iF4Jx/glxSAxJOFed5rk/67UCEhpGoIKdPATqnLg4GV0r8EbPnFej7d7HvooSP9/9vyD8RBkdN5yF07wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SecurityContextHolderFlow\"\n        title=\"SecurityContextHolderFlow\"\n        src=\"/static/088166de4a83f6231408e6dc2f191e99/fcda8/SecurityContextHolderFlow.png\"\n        srcset=\"/static/088166de4a83f6231408e6dc2f191e99/12f09/SecurityContextHolderFlow.png 148w,\n/static/088166de4a83f6231408e6dc2f191e99/e4a3f/SecurityContextHolderFlow.png 295w,\n/static/088166de4a83f6231408e6dc2f191e99/fcda8/SecurityContextHolderFlow.png 590w,\n/static/088166de4a83f6231408e6dc2f191e99/efc66/SecurityContextHolderFlow.png 885w,\n/static/088166de4a83f6231408e6dc2f191e99/c83ae/SecurityContextHolderFlow.png 1180w,\n/static/088166de4a83f6231408e6dc2f191e99/95be1/SecurityContextHolderFlow.png 2574w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>ThreadLocal에 SecurityContextHolder를 담고 있다.</li>\n<li>HttpSession에 SPRING<em>SECURITY</em>CONTEXT이름으로 저장</li>\n</ul>\n<p>SecurityContextHolder에서 인증정보 가져오는 방법</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"securitypersistencefilter\" style=\"position:relative;\"><a href=\"#securitypersistencefilter\" aria-label=\"securitypersistencefilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityPersistenceFilter</h3>\n<blockquote>\n<p>SecurityContext 객체의 생성, 저장, 조회</p>\n</blockquote>\n<ul>\n<li>여러 필터들이 Authentication 객체를 쓸 수 있도록 하기 위해서 SecurityContextPersistenceFilter는 2번째에 위치</li>\n<li>SecurityContextPersistenceFilter에서 인증 전인지, 인증 후인지를 판단 SecurityContext에 Authentication 객체 존재 유무 결정</li>\n</ul>\n<h4 id=\"익명-사용자\" style=\"position:relative;\"><a href=\"#%EC%9D%B5%EB%AA%85-%EC%82%AC%EC%9A%A9%EC%9E%90\" aria-label=\"익명 사용자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>익명 사용자</h4>\n<ul>\n<li>새로운 SecurityContext 객체를 생성하여 SecurityContextHolder에 저장</li>\n<li>AnonymouseAuthenticationFilter에서 AnonymousAuthenticationToken 객체를 SecurityContext에 저장</li>\n</ul>\n<h4 id=\"인증-시\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D-%EC%8B%9C\" aria-label=\"인증 시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증 시</h4>\n<ul>\n<li>새로운 SecurityContext객체를 생성하여 SecurityContextHolder에 저장</li>\n<li>UsernamePasswordAuthenticationFilter에서 인증 성공 후 SecurityContext 에 UsernamePasswordAuthentication 객체를 SecurityContext에 저장</li>\n<li>인증이 최종 완료되면 Session 에 SecurityContext를 저장</li>\n</ul>\n<h4 id=\"인증-후\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D-%ED%9B%84\" aria-label=\"인증 후 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증 후</h4>\n<ul>\n<li>Session에서 SecurityContext 꺼내 SecurityContextHolder에서 저장</li>\n<li>SecurityContext안에 Authentication 객체가 존재하면 계속 인증을 유지</li>\n</ul>\n<h4 id=\"최종-응답-시-공통\" style=\"position:relative;\"><a href=\"#%EC%B5%9C%EC%A2%85-%EC%9D%91%EB%8B%B5-%EC%8B%9C-%EA%B3%B5%ED%86%B5\" aria-label=\"최종 응답 시 공통 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>최종 응답 시 공통</h4>\n<ul>\n<li>SecurityContextHolder안의 SecurityContext객체에서 보관하던 인증정보 반드시 초기화</li>\n<li>초기화 시 SecurityContextHolder.clearContext() 사용</li>\n</ul>\n<h4 id=\"securitypersistencefilter-flow\" style=\"position:relative;\"><a href=\"#securitypersistencefilter-flow\" aria-label=\"securitypersistencefilter flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityPersistenceFilter Flow</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b836417c87f4dff019efaf7c23d6dc0/66900/SecurityPersistenceFilter.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABx0lEQVQoz21RTW/aQBD1/z+0x/RUpVIubdRKqSqQolSkaYMTAy6FqLR8VEAA29jGH7troJfXfUsX5ZDDaGbfzLw3M+s8du6x+N7Gwm9h7jWx9D1E3g2i1leEdw1EHRcLjT/eNxGFa+RZijwNIfIEmfZFliCOExRFgXa7Def0vI6L5gRnn5p4e/UDn1tjrBrv8evjGwwvXmP6pYYPlz9xen6Ld/UHzB6usPRO0Km/0CKvEP6+xLdbF9fXDdRqNThpukEQRsiyHNV2h1JIVEpCihKVFIdYVihKAcHcbg+5dPHn5iVU4GG7+6vxEvv9Hv1+H44UQjdIM/J4PEK328V4MkG0XkMpharaaqtMjdLkjBWFZGa8lEoTCkPY6/U0oSmsDOFoNMJEkyVJgjzPjcVxjM1mg7IskeuaLMs0XphNKEiRZwiVaSBpEARHQsYUmU6nBlutVhgOh5jP57q+MFPb7Z4lJAmnoeckLKQxR3w2mxky61nDDfhe6xP5vg/ncKfKNEVRhDAMjxNaLE1TQ0ycMT2NmBUn7rouHCa4GhUGg4Exrsg3b0NBbkFyuw29+P+ZNndc2d6O3jaxmPHh6OpI8pTQxrSnn/IPQ73kgXhGJ4YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"SecurityPersistenceFilter\"\n        title=\"SecurityPersistenceFilter\"\n        src=\"/static/2b836417c87f4dff019efaf7c23d6dc0/fcda8/SecurityPersistenceFilter.png\"\n        srcset=\"/static/2b836417c87f4dff019efaf7c23d6dc0/12f09/SecurityPersistenceFilter.png 148w,\n/static/2b836417c87f4dff019efaf7c23d6dc0/e4a3f/SecurityPersistenceFilter.png 295w,\n/static/2b836417c87f4dff019efaf7c23d6dc0/fcda8/SecurityPersistenceFilter.png 590w,\n/static/2b836417c87f4dff019efaf7c23d6dc0/efc66/SecurityPersistenceFilter.png 885w,\n/static/2b836417c87f4dff019efaf7c23d6dc0/c83ae/SecurityPersistenceFilter.png 1180w,\n/static/2b836417c87f4dff019efaf7c23d6dc0/66900/SecurityPersistenceFilter.png 2630w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>FilterChainProxy에 2번째 위치하며 모든 요청에서 수행</li>\n<li>\n<p>내부적으로 HttpSecurityContextRepository가 SecurityContext객체 생성, 조회하는 역할을 하는 로직 수행<br>\na. 인증 전</p>\n<ul>\n<li>새로운 컨텍스트 생성 (SecurityContext는 null)</li>\n<li>인증 필터(AuthFilter)가 인증 처리</li>\n<li>인증객체(Authentication)생성 후 SecurityContext 객체안에 저장</li>\n<li>Session에 SecurityContext저장</li>\n</ul>\n<p>b. 인증 후</p>\n<ul>\n<li>Session에서 SecurityContext가 있는지 확인</li>\n<li>SecurityContext를 꺼내 SecurityContextHolder에 저장</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"인증-흐름-authentication-flow\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D-%ED%9D%90%EB%A6%84-authentication-flow\" aria-label=\"인증 흐름 authentication flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증 흐름 (Authentication Flow)</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4e99efbbeb87c92808bb57ae18218616/9dbdb/AuthenticationFlow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABwklEQVQoz1VSTW/TQBT0/z9zQEjpoRckKAiEkHqhp7ZQkyZGlfJh4iRO6sTf9nq9dnKa7myzERye367e7My8SZz4zxDp0wjx8B7x+Dey8S+k3gPSx3tUzyFEI5EXJYqy0lVDNgKiKlDrkqLU9wZVVaGu9UxKOG/eDvD5xsPg6gcuvz8gGI8QfrvA06cB4puP+On6uPwywvuvQ3y4nmE7v8P+8R027gXK6RX++lPc3t7BdV1sNhs4cZIizQtk2kVZCa3SoJe616XpTdNqlwq10F12aDlvK3RSV/vqqtEu2Y3DLE0RRRGEEEjiGMvVCpW23yoF1XXoTCm0rYRSre5KP2S9npXirDWd5fBzOBxQFAXm8zlms6muGbIsM0Cq23yIY/V9Z8j7kyBnxLIce6DDsiwNMUPe7XbwPA+TyQTr9dpssVgssNLnMAyNYJIkiPVWfGtdngmp0vf9yUFvXC2XSwRBgFTHQjHf97EOFiYaClKAQsTa1R1aJgEveZ6fAXTKByTZbrfGBZ1H0bOJgXfiKfafQypxBTqwRBZMQv4ViCHJv3nareyGZ0Jmsd/vDbg7hWx/sePxeI7APuDcklmcJeb5Bdkx6jeuQ+7ZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AuthenticationFlow\"\n        title=\"AuthenticationFlow\"\n        src=\"/static/4e99efbbeb87c92808bb57ae18218616/fcda8/AuthenticationFlow.png\"\n        srcset=\"/static/4e99efbbeb87c92808bb57ae18218616/12f09/AuthenticationFlow.png 148w,\n/static/4e99efbbeb87c92808bb57ae18218616/e4a3f/AuthenticationFlow.png 295w,\n/static/4e99efbbeb87c92808bb57ae18218616/fcda8/AuthenticationFlow.png 590w,\n/static/4e99efbbeb87c92808bb57ae18218616/efc66/AuthenticationFlow.png 885w,\n/static/4e99efbbeb87c92808bb57ae18218616/c83ae/AuthenticationFlow.png 1180w,\n/static/4e99efbbeb87c92808bb57ae18218616/9dbdb/AuthenticationFlow.png 2622w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>UsernamePasswordAuthenticationFilter는 요청을 가로채서 Authentication(인증정보) 생성</li>\n<li>AuthenticationManager는 적절한 Provider를 찾아 인증 처리 위임</li>\n<li>AuthenticationProvider는 실제 ID/PW 인증 처리를 하는데 ID의 경우 UserDetailsService를 사용해 조회 -> 조회 한 UserDetails 정보로 PW 검증</li>\n<li>AuthenticationProvider는 인증 성공 후 유저정보(UserDetails) + 권한 정보(authorities) 담아 토큰 생성</li>\n<li>UsernamePasswordAuthenticationFilter가 인증 객체를 전달 받아 SecurityContext에 인증 정보 저장</li>\n</ol>\n<h3 id=\"authenticationmanager\" style=\"position:relative;\"><a href=\"#authenticationmanager\" aria-label=\"authenticationmanager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthenticationManager</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ecdd5b39cf65ef365af96f97b0b4196b/c658e/AuthenticationManager.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrklEQVQoz22SfXPSQBDG8/2/hAyML7QqrdZpdZzRDq0MtjRQoSWAvJcQk5DXuxCo/rykI3ZG/3hmb+92n31297Q4jvkHQuzOMt2Qbu9zrBWETHZvIv1JuJyzbFUJ5BYhJNp/CbNgRZpIgVl7T+egQPtNkf5RkXDaQ6w3xFGEXI2JnCED4wpn2iKJV2hSsaYqYJM+IFEKMrJQJYiMeHKL2/nKXatG3LtC2AuiWBL4K+5nR4SdApb+hF/jFyRuD623aFP5UuLw/Dmvzko0huf4foBhGPywbapdh5fVHq+rXSq1EcbMxfdWhIGP13/HrFFirj/Daj1FugM0y1tg3H3jun/JrZI9d1QbUUwYhspGjEyPm5Gl3ud0Jw6m7Sl1PoEilLPPODcVrPYB0fe3SG+MZi6WNBtNTj98pFG/ZDKeIqXMF5PZ0XDARb1G9fQT7esmrmOr+yRXuJ2f4OhFZvUC6XCPZKUUep6HaZosLSu3ruvmM8w3rAh1XWdvf59yuczx8UkekyR/N50kgvVaqpwHX8uSsoA/yNU92nRWwFazzOA4jmo12BUUj75XHIvc/w198E3D4bX/vQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AuthenticationManager\"\n        title=\"AuthenticationManager\"\n        src=\"/static/ecdd5b39cf65ef365af96f97b0b4196b/fcda8/AuthenticationManager.png\"\n        srcset=\"/static/ecdd5b39cf65ef365af96f97b0b4196b/12f09/AuthenticationManager.png 148w,\n/static/ecdd5b39cf65ef365af96f97b0b4196b/e4a3f/AuthenticationManager.png 295w,\n/static/ecdd5b39cf65ef365af96f97b0b4196b/fcda8/AuthenticationManager.png 590w,\n/static/ecdd5b39cf65ef365af96f97b0b4196b/efc66/AuthenticationManager.png 885w,\n/static/ecdd5b39cf65ef365af96f97b0b4196b/c83ae/AuthenticationManager.png 1180w,\n/static/ecdd5b39cf65ef365af96f97b0b4196b/c658e/AuthenticationManager.png 2202w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>AuthenticationProvider 목록 중에서 인증 처리 요건에 맞는 AuthenticationProvider를 찾아 인증 처리 위임</p>\n</blockquote>\n<ul>\n<li>AuthenticationManager 는 인터페이스로 실제 구현체는 <strong>ProviderManager</strong></li>\n<li>ProviderManager에 인증 처리 요건에 맞는 것이 없을 경우 부모 ProviderManager에서 탐색 후 처리</li>\n</ul>\n<h3 id=\"authenticationprovider\" style=\"position:relative;\"><a href=\"#authenticationprovider\" aria-label=\"authenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthenticationProvider</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e42b0d3646ee4c1287683d3cdcb853eb/fb2bb/AuthenticationProvider.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB30lEQVQoz32SXW8SQRSG959xYeI9N/AH/FVeaKIXxlQvFJsUSMS2BKIulFpaSMrH7grFCvs1u7O73aU8zi7hxhgnefKezEzOzHvO0aSUhGH4f+KEeLvDlxGLxRIpIthCovaTJCHLsoI81g4Jcz0QR3FBFEVE8QNyZeJddQimQ4bjS+qdT3zRm1i/5piGSf+iz2AwwLIsNCEEB3x/r7azKXDsNY7nISY/mB+/wtVbTKwbap0jPrbfcj0bYMxNdF2n1+thmibabrcjJ81S2MG9u+Jd9yVHpy94f/qc85s63uSa2+PX/NY/s/y5oNv+ylnrHP2brtwFbLdbZTlVlmO0VqtFo9Gg2WxycnKCYcyRscDzbTxh4wY+cnbFXeMNYnCqSiERgXIjfEIZEgSSQOwJVaxVq1XK5TKVSoVSqUS93iBfYZIRp49ECrkycC7b2OM+ruPgqTK4rlsQxR5xsiePtfzQtm02G1Uz1yNw1oixjjfq4Y++Exgj5EOKHyUYizum02nhYjazlF6wMCtY06eYkyesls/Qik4q8lqEaizC9Yp1u8bdeY37sw+IYRepOh4GgbqnJiDed3+voWrcjM16orjFcQy0v2dO5g9kj8SKXPPfFWf/nFepkqbKarZHxX8AbPyTZXr00q4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AuthenticationProvider\"\n        title=\"AuthenticationProvider\"\n        src=\"/static/e42b0d3646ee4c1287683d3cdcb853eb/fcda8/AuthenticationProvider.png\"\n        srcset=\"/static/e42b0d3646ee4c1287683d3cdcb853eb/12f09/AuthenticationProvider.png 148w,\n/static/e42b0d3646ee4c1287683d3cdcb853eb/e4a3f/AuthenticationProvider.png 295w,\n/static/e42b0d3646ee4c1287683d3cdcb853eb/fcda8/AuthenticationProvider.png 590w,\n/static/e42b0d3646ee4c1287683d3cdcb853eb/efc66/AuthenticationProvider.png 885w,\n/static/e42b0d3646ee4c1287683d3cdcb853eb/c83ae/AuthenticationProvider.png 1180w,\n/static/e42b0d3646ee4c1287683d3cdcb853eb/fb2bb/AuthenticationProvider.png 3132w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>\n<p>AuthenticationProvider 는 인터페이스로 2개의 메서드 존재</p>\n<ul>\n<li>authenticate(authentication) : 실제적인 인증처리를 위한 검증 메서드</li>\n<li>supports(authentication): 인증처리가 가능한 Provider인지 검사하는 메서드</li>\n</ul>\n</li>\n<li>\n<p>아이디 검증</p>\n<ul>\n<li>존재 -> UserDetails 반환 / 존재 x -> UserNotFoundException</li>\n</ul>\n</li>\n<li>\n<p>패스워드 검증</p>\n<ul>\n<li>반환된 UserDetails에 저장된 password와 로그인시 입력한 패스워드(authentication.password)가 일치하는지 비교</li>\n<li>일치하지 않을 경우 BadCredentialException 발생</li>\n<li>일반적으로 패스워드를 저장할 때 Password Encoder를 이용해 암호화 하여 저장하기 때문에 해당 클래스(PasswordEncoder)를 이용해 두 암호를 비교</li>\n</ul>\n</li>\n<li>\n<p>추가 검증</p>\n<ul>\n<li>추가적으로 사용자가 정의한 검증 조건 검증</li>\n<li>검증이 모두 성공하면 최종적으로 인증객체를 생성 후 AuthenticationManager에 전달</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"인가authorization\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EA%B0%80authorization\" aria-label=\"인가authorization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인가(Authorization)</h2>\n<blockquote>\n<p>어떤 개체가 어떤 리소스에 접근할 수 있는지 접근 권한 할당</p>\n</blockquote>\n<h3 id=\"시큐리티가-지원하는-권한-계층\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0%EA%B0%80-%EC%A7%80%EC%9B%90%ED%95%98%EB%8A%94-%EA%B6%8C%ED%95%9C-%EA%B3%84%EC%B8%B5\" aria-label=\"시큐리티가 지원하는 권한 계층 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시큐리티가 지원하는 권한 계층</h3>\n<ul>\n<li>웹 계층 : URL요청에 따른 메뉴 혹은 화면단위의 레벨 보안</li>\n<li>서비스 계층 : 메소드 같은 기능 단위의 레벨 보안</li>\n<li>도메인 계층 : 객체 단위의 레벨 보안</li>\n</ul>\n<h3 id=\"authorizationfilter\" style=\"position:relative;\"><a href=\"#authorizationfilter\" aria-label=\"authorizationfilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthorizationFilter</h3>\n<blockquote>\n<p>마지막에 위치한 필터로 승인, 거부를 최종적으로 결정</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ca2220120829f65ea3761ed56dde342/37f8f/FilterSecurityInterceptor.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6ElEQVQoz3WSy08TURjF+5+6doULtyYk/hOuWBhNSHVhQAgaizFCEEozQwstlWmn82qHPub9buvPO2PasHFx7vkW557c851bi+KMyNVY2DK+oWKf1hmc7PNw9I7upz2C5heSMCBO1wgpSU7FcZwIxFtEUVRxrTzyPBcoSJKUYrnCD0K6vXtcwYnrEIYFM6VO/9szbr8+x7h4ge+OCcIY3/cIgkBowsq05nkemqah6zqO46KL+eJa5vzXFb/7fayxRRilJIs70skJgdUgn54S+AuyLKcocsEZ6/W64prruiiKgqqqwtCpZlmWaDavaLfbGOqQJAqZ+QWj6RLVTjAWa5EmYyTuSLJc6WTBpmk+jZxXO0izgrE9p3PbYzK2GSlDRgOF7mjK8eUDhz87fL/RSfMlH+p1dnZ22N3drbjRaPwzLPOPLRPdtDn+ofD+oMXHkzb7hxLnkoVh6AxVk2arR0u656aj8Pg4FXELVqtV9Zht5HKRm4ZK9vwIwxzT6XR5nLk40zmLhc9MP0eT3jCU9rDu3hJ4M1GG0IsOSmx8ak9rL5FlKQPN4Lol4ZRCzyGKl3jaZybNl2iXr5i3XxO4tkgWbxveeNSemqVJjDUPObrSODjrc9adEkTlfxMJ0j+kS8gEkuL///AvNl2T5iQ04yoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"FilterSecurityInterceptor\"\n        title=\"FilterSecurityInterceptor\"\n        src=\"/static/3ca2220120829f65ea3761ed56dde342/fcda8/FilterSecurityInterceptor.png\"\n        srcset=\"/static/3ca2220120829f65ea3761ed56dde342/12f09/FilterSecurityInterceptor.png 148w,\n/static/3ca2220120829f65ea3761ed56dde342/e4a3f/FilterSecurityInterceptor.png 295w,\n/static/3ca2220120829f65ea3761ed56dde342/fcda8/FilterSecurityInterceptor.png 590w,\n/static/3ca2220120829f65ea3761ed56dde342/efc66/FilterSecurityInterceptor.png 885w,\n/static/3ca2220120829f65ea3761ed56dde342/c83ae/FilterSecurityInterceptor.png 1180w,\n/static/3ca2220120829f65ea3761ed56dde342/37f8f/FilterSecurityInterceptor.png 3056w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>인증객체 없이 보호자원에 접근을 시도하면 AuthenticationException 발생</li>\n<li>인증 후 자원에 접근 가능한 권한이 존재하지 않을 경우 AccessDeniedException 을 발생</li>\n<li>HTTP 자원의 보안을 처리하는 필터 (URL방식으로 접근 할 경우 동작)</li>\n<li>권한 처리를 AccessDecisionManager에게 맡김</li>\n</ul>\n<h3 id=\"accessdecisionmanager\" style=\"position:relative;\"><a href=\"#accessdecisionmanager\" aria-label=\"accessdecisionmanager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AccessDecisionManager</h3>\n<blockquote>\n<p>인증,요청,권한 정보를 이용해서 사용자의 자원접근을 허용/거부 여부를 최종 결정하는 주체</p>\n</blockquote>\n<ul>\n<li>여러 개의 Voter들을 가질 수 있고, Voter들로부터 접근허용, 거부, 보류에 해당하는 각각의 값을 리턴받아 판단, 결정</li>\n</ul>\n<h4 id=\"접근결정의-세-가지-유형-구현체\" style=\"position:relative;\"><a href=\"#%EC%A0%91%EA%B7%BC%EA%B2%B0%EC%A0%95%EC%9D%98-%EC%84%B8-%EA%B0%80%EC%A7%80-%EC%9C%A0%ED%98%95-%EA%B5%AC%ED%98%84%EC%B2%B4\" aria-label=\"접근결정의 세 가지 유형 구현체 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>접근결정의 세 가지 유형 (구현체)</h4>\n<ol>\n<li>AffirmativeBased : OR 연산자와 같은 논리</li>\n<li>ConsensusBased : 다수결</li>\n<li>UnanimousBased : AND 연산자와 같은 논리</li>\n</ol>\n<p>권한 부여 과정에서 판단하는 값 (3가지)</p>\n<ul>\n<li>Authenticaion - 인증정보(user)</li>\n<li>FilterInvocator - 요청 정보(requestMatchers(\"/user\"))</li>\n<li>ConfigAttributes - 권한 정보(hasRole(\"USER\"))</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">http\n    <span class=\"token punctuation\">.</span><span class=\"token function\">authorizeHttpRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>authz<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> authz <span class=\"token comment\">// 규칙 지정</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"USER\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/pay\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ADMIN\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/admin/**\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasAnyRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ADMIN\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SYS\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 모든 요청이 인증을 요청하게 설정</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"정리-1\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC-1\" aria-label=\"정리 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d48feaa6861a31f403be6c1613cc78b/e8950/flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACZUlEQVQoz02SW08aURSF5yf21/ShadI3a4y2JooCvrQ1lsbE3pKqUUTkUnS4wzhcBLmJgzIMt2EoYPv1zCRN+rCS2fustc6afbbU6TxQvS0Qz/uJyt+pqHHum3fMZ08sfv1hZi0wega9ns54PMHQm1RVP/3uLUOjQaN0SFE5RqudY44HSNPxCOXe4GUoyfPjc04yZfp39xTbaY4S7wmrX+jqj8Kwx3A0QddUKvFN9HYKo6NQT73lJrlJW/EyHHSR+L1gsIBvyid88isqgzlza0p3fEe+HqXSSTOxTCYTi6fFjMfhjGCmiWZM0UdzQoUBAaVHvGpiib+SstkcCfmSnHxFIhIll0wgx2XRS6LmS2SSeeQrmUgkQiIR5yIc5dAfJHARJvwzxuHpOWcXEY7852RzeaT9/X2WlpZwezysrK7idnvY8e6wteXCJbC8/BqXy8Xa2hper5f19XV8H/fY2Nhgd/cDb9+IvseNe3sbn8+H1GjUSYhENzdlkSCBoihcX1+Tz+fJZDIibRxZlonFYk6dTIrkhYJTp0UdCoUIi/Q2J51OI6UzCif+MJdXKTqdDq1Wi2Aw6MAWpAQpLkxtYaPRQNd1isUiBwcHzhhUVaVULnN2dkYgEECKBj/z1beC/8c7ppZFv993xDZZ0zpoYq1sE9vMful2u+2chcNihmLmtrmtqVargq8hlWLrhHzPyJ6+wDTHpFIp9vb2nHlUKhWmszkjsX9j8cqjsYkudlJ7eMQYDHnUDecS0zSZTqcOpGZLQy3VuK23sUTCbrdLrVZzYCezJhNH8A82xxZORN/+tvH/+V9B1LRaQv+/9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flow\"\n        title=\"flow\"\n        src=\"/static/3d48feaa6861a31f403be6c1613cc78b/fcda8/flow.png\"\n        srcset=\"/static/3d48feaa6861a31f403be6c1613cc78b/12f09/flow.png 148w,\n/static/3d48feaa6861a31f403be6c1613cc78b/e4a3f/flow.png 295w,\n/static/3d48feaa6861a31f403be6c1613cc78b/fcda8/flow.png 590w,\n/static/3d48feaa6861a31f403be6c1613cc78b/efc66/flow.png 885w,\n/static/3d48feaa6861a31f403be6c1613cc78b/c83ae/flow.png 1180w,\n/static/3d48feaa6861a31f403be6c1613cc78b/e8950/flow.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"초기화\" style=\"position:relative;\"><a href=\"#%EC%B4%88%EA%B8%B0%ED%99%94\" aria-label=\"초기화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>초기화</h3>\n<ol>\n<li>Security가 초기화 될 때 Security Config 구성대로 생성 된 Filters를 <strong>WebSecurity가 FilterChainProxy 생성</strong> (springSecurityFilterChain 이름을 가진다)</li>\n<li><strong>DelegatingFilterProxy</strong>가 springSecurityFilterChain이름을 가진 <strong>FilterChainProxy를 찾아 요청을 위임</strong>한다.</li>\n</ol>\n<h3 id=\"인증\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D\" aria-label=\"인증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증</h3>\n<ol start=\"3\">\n<li><strong>SecurityPersistenceFilter</strong>가 SecurityContext가 있는지 확인 후, 없으면 <strong>Authentication 객체 생성 후 SecurityContext에 저장</strong></li>\n<li>Logout 요청이 없는경우 특별한 동작 x</li>\n<li><strong>UsernamePasswordAuthenticationFilter</strong>에서 UserDetailsService로 <strong>ID, PW 검사 후 인증 정보를 더해 SecurityContext에 저장</strong></li>\n<li>인증 성공 시 뒤에있는 Session ManagementFilter 과정도 동시에 처리, <strong>동시 세션에 대한 처리</strong>한다</li>\n<li><strong>사용자가 정의한 SuccessHandler 작업 수행, 특정한 경로로 리다이렉트</strong></li>\n<li>다시 요청이 들어와서 SecurityContextPersistenceFilter가 ContextHolder에서 loadContext 후 진행</li>\n</ol>\n<p>ConcurrentSessionFilter ~ SessionManagementFilter는 해당사항이 있을 경우만 진행</p>\n<h3 id=\"인가\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EA%B0%80\" aria-label=\"인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인가</h3>\n<ol start=\"9\">\n<li>ExceptionTranslationFilter로 감싸 FilterSecurityInterceptor 인가 필터가 인증 객체부터 검사</li>\n<li>AccessDecisionManager가 실행</li>\n</ol>\n<h1 id=\"인증-구현\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84\" aria-label=\"인증 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증 구현</h1>\n<h2 id=\"정적자원-관리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EC%A0%81%EC%9E%90%EC%9B%90-%EA%B4%80%EB%A6%AC\" aria-label=\"정적자원 관리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정적자원 관리</h2>\n<blockquote>\n<p>WebIgnore 설정 시 js, css, image같은 정적 자원들을 보안 필터에서 예외시킨다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// SecurityConfig</span>\n\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSecurity</span> web<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n   web<span class=\"token punctuation\">.</span><span class=\"token function\">ignoring</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PathRequest</span><span class=\"token punctuation\">.</span><span class=\"token function\">toStaticResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">atCommonLocations</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/36b6080456ecf6b82c6a37fac3e7f01c/6f464/webIgnore.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6ElEQVQ4y5VUW3LjMAzLidayJFJPJ53e/04oKNlZdzrdtT8wsiMZAQlQD1FBUI+ogetETBM+eDjnsK7rZTy0JuSXIm0KbRFePIlW+MgDfn0TXiV+bFXxbB5bjXh+fmB7vlBKR+tPrhXe31P5iDFSiUOIVEYECeP5fOgWYSBhShl1qwNaBKnKD2WXSzbCwObHFGlMnEqDf5M4O2jrHUJzutaKXAtyy9CsgzjGMMnuuDwVsmxJkCiDfETJ+hlIuJq69W4PE0ovKFtGKoxQJylbMPu49/AOoQSBmkIRmOujXHP7FGx3sfRBqEmHwtzzDoXk3SB/dthdJIwsU2iG6oCps1G09YjPodD9x/FpCt1MnBhl/kyZcGpspseHVOh3rL8Qnf9gmsL+1dw4aiw3Z7pM1dn6OXtpBh0RukRY4oKmDlXcmN/aNtTUkDXvsTlgbrsfv51JOcsMNcv8oBF2QWwljDXZxcA9ZaRy7aiFseINZL2OlorMdw6DMrPLsrxJqZCEuqJzhnvv2IjeKl49DfTeuMeWsGybplIaGteWBIVVlFRG3N4KRRgR3jaRmRNNE2KHw4DyWdhL4R0Z7azoUKX2HmRMl03UN8Jl74dJ/wuHP8v+m+3ZGT67Y398Y+vyLfwPm+O71/y/nP4CJjh94kt/FtgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"webIgnore\"\n        title=\"webIgnore\"\n        src=\"/static/36b6080456ecf6b82c6a37fac3e7f01c/fcda8/webIgnore.png\"\n        srcset=\"/static/36b6080456ecf6b82c6a37fac3e7f01c/12f09/webIgnore.png 148w,\n/static/36b6080456ecf6b82c6a37fac3e7f01c/e4a3f/webIgnore.png 295w,\n/static/36b6080456ecf6b82c6a37fac3e7f01c/fcda8/webIgnore.png 590w,\n/static/36b6080456ecf6b82c6a37fac3e7f01c/efc66/webIgnore.png 885w,\n/static/36b6080456ecf6b82c6a37fac3e7f01c/c83ae/webIgnore.png 1180w,\n/static/36b6080456ecf6b82c6a37fac3e7f01c/6f464/webIgnore.png 1464w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"passwordencoder\" style=\"position:relative;\"><a href=\"#passwordencoder\" aria-label=\"passwordencoder permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PasswordEncoder</h2>\n<blockquote>\n<p>비밀번호를 안전하게 암호화</p>\n</blockquote>\n<p>기본 타입 : bcrypt</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/98c96a36f642c5117ced164d9b6af34a/b5c21/passwordEncoder.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.97297297297297%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACpElEQVQ4y41UWZbaMBDkRNjWvtiyjcHAzGRy/9NUqmV4IcOQ5KNet2SrVL2od0sZcB4CljJiHKeK0g/oy4QD/ZQSIpFzJhJCjEg3P6WIPPQ8UzARhVw7HzycVVBGo9PmBoWua9G0ggbNfo99Bf3mvt78/cM3sTsfE2y2sNFAWUcyt5GrDi0Ju677Lyilqt1FhpCDQo4KKdgtxCihJWitX5C2df+O+774O+cjnO6QnEIfbUUmrDFom9uhr7aSvCQM0MyhTQ4mJBgqMyEyBSRNmjBwN9x99ZCOJ0LrAgkc/DjClyOxED1CCQjjBpc9PDvB9Z7/6gei9ntCy598SXADCacVrhy4nnjJDNtPVC2YWazAsBu0X/L4jUJNJYkkp41wmKGdh2Z+hUS7WNEp/Ueo/yAMJBwQZyormbmSHFoYx76sLXHHjexvCrVXVOXZj5LHA3M18pJQiyOFUjYQr1U+VTlGjzJSVcysOKtsDbRqiQ66a2+++rahnwmDNLbDZT1iWRbMx5XkA6YSMbKqE6s7S8F4SVMVNVthBE9NfwtZclOmA6Z1wTjPGHLcBoXszQcMrLhhoxtjKyyfqLEWmnvNA3FVGJir4C2W0wXHHxdOEUNFPY7rFefrO+blRBxxOl+xXt5wefvA9f0Ta/12rJPIeQfnbH3PGyFDXi/vWD+vyGzo0zzUQ28fPyvBTJUp98gy1oZSrazFTylTsa2Qt7+FTObCEKd1hueTC07XASGHIg94XurYl2IFIW5z0TP/zvuqUNqrEkqVReo4zThdmMNlxGEuNdTldMaBRZrmpV44UqnkVWzhK+qHgQL4AIx+6EMZDhyoQ/JMfo/U9xj6XA/IYSHK3BOFcvFv6IrH1qmEIlsWdRLXduCUrtjXyVztrZKv8NiHvwDZqo3yMA+pGQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"passwordEncoder\"\n        title=\"passwordEncoder\"\n        src=\"/static/98c96a36f642c5117ced164d9b6af34a/fcda8/passwordEncoder.png\"\n        srcset=\"/static/98c96a36f642c5117ced164d9b6af34a/12f09/passwordEncoder.png 148w,\n/static/98c96a36f642c5117ced164d9b6af34a/e4a3f/passwordEncoder.png 295w,\n/static/98c96a36f642c5117ced164d9b6af34a/fcda8/passwordEncoder.png 590w,\n/static/98c96a36f642c5117ced164d9b6af34a/efc66/passwordEncoder.png 885w,\n/static/98c96a36f642c5117ced164d9b6af34a/c83ae/passwordEncoder.png 1180w,\n/static/98c96a36f642c5117ced164d9b6af34a/b5c21/passwordEncoder.png 2154w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"userdetails\" style=\"position:relative;\"><a href=\"#userdetails\" aria-label=\"userdetails permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserDetails</h2>\n<blockquote>\n<p>Spring Security에서 사용자의 정보를 담는 인터페이스</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Account, AccountDto 생성</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span><span class=\"token punctuation\">(</span>access <span class=\"token operator\">=</span> <span class=\"token class-name\">AccessLevel</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PROTECTED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Account</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetails</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// UserService상속받아 구현체 생성</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Service</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userService\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RoleRepository</span> roleRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PasswordEncoder</span> passwordEncoder<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Account</span> account<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">Role</span> role <span class=\"token operator\">=</span> roleRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByRoleName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_USER\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Role</span><span class=\"token punctuation\">></span></span> roles <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        roles<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>role<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        account<span class=\"token punctuation\">.</span><span class=\"token function\">setUserRoles</span><span class=\"token punctuation\">(</span>roles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>account<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetails.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">UserDetails</a>, Serializable을 상속해 확장 가능</p>\n<table>\n<thead>\n<tr>\n<th>메소드</th>\n<th>리턴 타입</th>\n<th>설명</th>\n<th>기본값</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>getAuthorities()</td>\n<td>Collection&#x3C;? extends GrantedAuthority></td>\n<td>계정의 권한 목록을 리턴</td>\n<td></td>\n</tr>\n<tr>\n<td>getPassword()</td>\n<td>String</td>\n<td>계정의 비밀번호를 리턴</td>\n<td></td>\n</tr>\n<tr>\n<td>getUsername()</td>\n<td>String</td>\n<td>계정의 고유한 값을 리턴( ex : DB PK값, 중복이 없는 이메일 값 )</td>\n<td></td>\n</tr>\n<tr>\n<td>isAccountNonExpired()</td>\n<td>boolean</td>\n<td>계정의 만료 여부 리턴</td>\n<td>true ( 만료 안됨 )</td>\n</tr>\n<tr>\n<td>isAccountNonLocked()</td>\n<td>boolean</td>\n<td>계정의 잠김 여부 리턴</td>\n<td>true ( 잠기지 않음 )</td>\n</tr>\n<tr>\n<td>isCredentialsNonExpired()</td>\n<td>boolean</td>\n<td>비밀번호 만료 여부 리턴</td>\n<td>true ( 만료 안됨 )</td>\n</tr>\n<tr>\n<td>isEnabled()</td>\n<td>boolean</td>\n<td>계정의 활성화 여부 리턴</td>\n<td>true ( 활성화 됨 )</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><a href=\"https://programmer93.tistory.com/68\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">getUsername() 사용 시 SSO 같은 서버를 만들게 되면 정책에 따라서 중복이 될 수도 있기에 주의</a></li>\n<li>사용한 Account 엔티티는 반드시 <a href=\"https://devlog-wjdrbs96.tistory.com/268\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">직렬화(Serializable)</a></li>\n</ul>\n<h2 id=\"customuserdetailsservicedb-연동-구현\" style=\"position:relative;\"><a href=\"#customuserdetailsservicedb-%EC%97%B0%EB%8F%99-%EA%B5%AC%ED%98%84\" aria-label=\"customuserdetailsservicedb 연동 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CustomUserDetailsService(DB 연동 구현)</h2>\n<blockquote>\n<p>사용자 이름, 암호 및 사용자 이름과 암호로 인증하기 위한 기타 속성을 검색하는 데 사용</p>\n</blockquote>\n<ul>\n<li>UserDetailsService을 상속받아 loadUserByUsername을 구현</li>\n<li>\n<ol>\n<li>ID 존재 여부 확인, 2) User 권한 확인 후 security.core.userdetails.User를 상속받은 AccountContext({유저 정보}, 권한)으로 리턴</li>\n</ol>\n</li>\n<li>권한 정보는 <strong>GrantedAutority타입</strong>으로 담아야 함</li>\n<li>AccountContext를 확장해서 사용 시 정의한 클래스로 객체 생성해 반환</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// AccountContext</span>\n<span class=\"token comment\">// UserDetails 타입으로 계정에 관한 정보를 넣어주어야 스프링 시큐리티가 요구하는 스펙(인증 메서드를 사용하기 위한 인자 조건)을 맞출 수 있다</span>\n<span class=\"token annotation punctuation\">@Data</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountContext</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Account</span> account<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AccountContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Account</span> account<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> roles<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>account<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> roles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>account <span class=\"token operator\">=</span> account<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// UserDetailsServiceImpl</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@Service</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"userDetailsService\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDetailsServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">Account</span> account <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByUsername</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>account <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">countByUsername</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernameNotFoundException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No user found with username: \"</span> <span class=\"token operator\">+</span> username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> userRoles <span class=\"token operator\">=</span> account<span class=\"token punctuation\">.</span><span class=\"token function\">getUserRoles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>userRole <span class=\"token operator\">-></span> userRole<span class=\"token punctuation\">.</span><span class=\"token function\">getRoleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> collect <span class=\"token operator\">=</span> userRoles<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token operator\">::</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountContext</span><span class=\"token punctuation\">(</span>account<span class=\"token punctuation\">,</span> collect<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"form인증-구현\" style=\"position:relative;\"><a href=\"#form%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84\" aria-label=\"form인증 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Form인증 구현</h2>\n<h3 id=\"customauthenticationprovider\" style=\"position:relative;\"><a href=\"#customauthenticationprovider\" aria-label=\"customauthenticationprovider permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CustomAuthenticationProvider</h3>\n<blockquote>\n<p>CustomUserDetailsService에서 만든 AccountContext를 검증</p>\n</blockquote>\n<p>구현</p>\n<ol>\n<li><strong>AuthenticationProvider</strong> 클래스를 상속받아 인증 절차를 수행하는 authenticate, supports 함수 구현</li>\n<li>Security Config 파일에서 authenticationProvider bean 등록</li>\n<li>Security Config 파일에서 2에서 생성한 <strong>빈 객체</strong>를 <strong>configure</strong> 설정으로 전달</li>\n</ol>\n<p>특징</p>\n<ul>\n<li>supports 함수는 Authentication 객체를 이 AuthenticationProvider가 인증 가능한 클래스인지 확인</li>\n<li>supports를 통과한 뒤 authenticate 메서드가 호출</li>\n<li>만약 JWT token을 사용하고, DB에 저장하고 있다면 이런 정보를 추가로 Token에 담아 전달 가능</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// FormAuthenticationProvider</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FormAuthenticationProvider</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationProvider</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserDetailsService</span> userDetailsService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PasswordEncoder</span> passwordEncoder<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FormAuthenticationProvider</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PasswordEncoder</span> passwordEncoder<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>passwordEncoder <span class=\"token operator\">=</span> passwordEncoder<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Authentication</span> <span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">AuthenticationException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">String</span> loginId <span class=\"token operator\">=</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getCredentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">AccountContext</span> accountContext <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AccountContext</span><span class=\"token punctuation\">)</span> userDetailsService<span class=\"token punctuation\">.</span><span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span>loginId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">matches</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">,</span> accountContext<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BadCredentialsException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid password\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">String</span> secretKey <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FormWebAuthenticationDetails</span><span class=\"token punctuation\">)</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSecretKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>secretKey <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>secretKey<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secret\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid Secret\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UsernamePasswordAuthenticationToken</span><span class=\"token punctuation\">(</span>accountContext<span class=\"token punctuation\">.</span><span class=\"token function\">getAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> accountContext<span class=\"token punctuation\">.</span><span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">supports</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> authentication<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UsernamePasswordAuthenticationToken</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// SecurityConfig.java</span>\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthenticationManagerBuilder</span> auth<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    auth<span class=\"token punctuation\">.</span><span class=\"token function\">authenticationProvider</span><span class=\"token punctuation\">(</span><span class=\"token function\">authenticationProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthenticationProvider</span> <span class=\"token function\">authenticationProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormAuthenticationProvider</span><span class=\"token punctuation\">(</span><span class=\"token function\">passwordEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthenticationManager</span> <span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>추가로 AuthenticationManager를 외부에서 사용하기 위한 설정은 AuthenticationManagerBean 을 이용하여 Sprint Securtiy 밖으로 AuthenticationManager 빼 내야 한다.</p>\n<h4 id=\"userdetails-정보-확장\" style=\"position:relative;\"><a href=\"#userdetails-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9E%A5\" aria-label=\"userdetails 정보 확장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserDetails 정보 확장</h4>\n<p>예제에선 secret_key를 추가로 받아 인증과정에 추가</p>\n<ul>\n<li>Details를 담는 AuthenticationDetailsSource 작성</li>\n<li>WebAuthenticationDetails</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FormAuthenticationDetailsSource</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationDetailsSource</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">HttpServletRequest</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">WebAuthenticationDetails</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">WebAuthenticationDetails</span> <span class=\"token function\">buildDetails</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormWebAuthenticationDetails</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//사용자가 전달하는 추가적인 파라미터들을 저장</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FormWebAuthenticationDetails</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebAuthenticationDetails</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> secretKey<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FormWebAuthenticationDetails</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        secretKey <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secret_key\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getSecretKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> secretKey<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// config 추가</span>\nhttp<span class=\"token punctuation\">.</span><span class=\"token function\">authenticationDetailsSource</span><span class=\"token punctuation\">(</span>authenticationDetailsSource<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"login-logout-처리-및-핸들러-구현\" style=\"position:relative;\"><a href=\"#login-logout-%EC%B2%98%EB%A6%AC-%EB%B0%8F-%ED%95%B8%EB%93%A4%EB%9F%AC-%EA%B5%AC%ED%98%84\" aria-label=\"login logout 처리 및 핸들러 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Login, Logout 처리 및 핸들러 구현</h3>\n<ol>\n<li>login 설정</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">http\n    <span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">loginPage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 사용자 정의 로그인 페이지, default: /login</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 로그인 Form Action Url, default: /login</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">defaultSeccessUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a href=\"https://stackoverflow.com/questions/53140629/spring-security-loginpage-vs-loginprocessingurl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">loginProcessingUrl은 Spring Security가 Form인증을 처리할 경로로 Spring MVC 및 컨트롤러에 요청을 전달하지 않는다.</a></p>\n<ol start=\"2\">\n<li>\n<p>logout</p>\n<ol>\n<li>view source에서 logout</li>\n<li>session 해제 Controller 구현 - SecurityContextHolder에서 context를 직접 가져와 해제해준다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/logout\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>authentication <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">SecurityContextLogoutHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> authentication<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/login\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>인증 성공 handler 구현</li>\n</ol>\n<p>SimpleUrlAuthenticationSuccessHandler 을 상속받아 구현 - 인증 성공 후 페이지 이동 기능 구현</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FormAuthenticationSuccessHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">SimpleUrlAuthenticationSuccessHandler</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RequestCache</span> requestCache <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpSessionRequestCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedirectStrategy</span> redirectStrategy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultRedirectStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationSuccess</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">setDefaultTargetUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">SavedRequest</span> savedRequest <span class=\"token operator\">=</span> requestCache<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>savedRequest <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">String</span> targetUrl <span class=\"token operator\">=</span> savedRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getRedirectUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            redirectStrategy<span class=\"token punctuation\">.</span><span class=\"token function\">sendRedirect</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> targetUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            redirectStrategy<span class=\"token punctuation\">.</span><span class=\"token function\">sendRedirect</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> <span class=\"token function\">getDefaultTargetUrl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"4\">\n<li>인증 실패 handler 구현</li>\n</ol>\n<p>SimpleUrlAuthenticationFailureHandler 상속 받아 구현 - exception이 난 경우 에러 처리 구현</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FormAuthenticationFailureHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">SimpleUrlAuthenticationFailureHandler</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedirectStrategy</span> redirectStrategy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultRedirectStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">String</span> errorMessage <span class=\"token operator\">=</span> <span class=\"token string\">\"Invalid Username or Password\"</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exception <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BadCredentialsException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            errorMessage <span class=\"token operator\">=</span> <span class=\"token string\">\"Invalid Username or Password\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exception <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">DisabledException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            errorMessage <span class=\"token operator\">=</span> <span class=\"token string\">\"Locked\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exception <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">CredentialsExpiredException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            errorMessage <span class=\"token operator\">=</span> <span class=\"token string\">\"Expired password\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">setDefaultFailureUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login?error=true&amp;exception=\"</span> <span class=\"token operator\">+</span> errorMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> exception<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"5\">\n<li>인증 거부 처리</li>\n</ol>\n<blockquote>\n<p>인증은 성공 했지만 권한이 없는 경우</p>\n</blockquote>\n<p>AccessDeniedHandler 을 상속받아 구현한다.</p>\n<ul>\n<li>인가 예외는 AbstractSecurityInterceptor에서 발생</li>\n<li>exception 처리는 ExceptionTranslationFilter의 AccessDeniedHandler에서 처리</li>\n</ul>\n<p>TODO: AJAX 듣고 내용 추가</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FormAccessDeniedHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AccessDeniedHandler</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> errorPage<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ObjectMapper</span> mapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedirectStrategy</span> redirectStrategy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultRedirectStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AccessDeniedException</span> accessDeniedException<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">WebUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAjax</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">APPLICATION_JSON_VALUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mapper<span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">FORBIDDEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">String</span> deniedUrl <span class=\"token operator\">=</span> errorPage <span class=\"token operator\">+</span> <span class=\"token string\">\"?exception=\"</span> <span class=\"token operator\">+</span> accessDeniedException<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            redirectStrategy<span class=\"token punctuation\">.</span><span class=\"token function\">sendRedirect</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> deniedUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setErrorPage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> errorPage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>errorPage <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>errorPage<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"errorPage must begin with '/'\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errorPage <span class=\"token operator\">=</span> errorPage<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"최종-spring-config-설정\" style=\"position:relative;\"><a href=\"#%EC%B5%9C%EC%A2%85-spring-config-%EC%84%A4%EC%A0%95\" aria-label=\"최종 spring config 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>최종 Spring Config 설정</h3>\n<p>TODO: 마무리 후 추가</p>\n<h2 id=\"ajax-인증\" style=\"position:relative;\"><a href=\"#ajax-%EC%9D%B8%EC%A6%9D\" aria-label=\"ajax 인증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ajax 인증</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/582bf3e3366333e1b1c227c9feb7c3e7/ba40d/AjaxAuthentication.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACNUlEQVQozz2R63aaUBCF8/5v0D6B7Vptfqi1apMqphqrxksaxYhRvIBXkDsSzNcD7cqPzZxhztmz98yVqcg48wnnuUy0VIh0FXv8SDB/IVqv4AJxdCEMA3h7RWRpDMOQMIJz/A/B+YLreVwFjs16pVO8afD9tkFJ6qCqC+qdHxSq13y/y3I/kJgvNFF/IFcSdyo91LmK+qeM3MozbudZynd4nisIA5/Zaku2PiYr9blpv4h8Q0f5RaVfpDoo0n1psNT2FCpDrgst0UhGUabMWhl+Fz/wUP7IrJvFdRyuTqcTu+0Gd/1M4J5wLANfSJeHYx77Twy6j/QfBsjySPy3iM6esBzh+z6Dpwn3rR7Ndp9nRRUKhWXP8wlE0R432WhrVmuNw+FAuVwil8uSyWTIf8tTrVZZLJdstltsocQR8FxHEHuikZueXVdYTj6WZXFyPAzDYKNrad5sNlOSUknYrlRot1rous7xeEwfRlFEHMfvSPJUYVLcHw0MyyaMxTbjN0xxTsiTJn70KhDjnSNs28Y0jZRwNBpRq9WQJClFr9f7bzkIcHcaWq/Oun+P3m+wGA9T69NWDbUlsejcsRt2hHqd2XxOMndFUVKSer1Ot9tNG6SWvfCMrT6j3X5hdnuN9vMrq6cuK01HlXJMi5+Ylj5zaBaxTBPrZOGkSk12u1067yQmo3i37AUhwesltZzYOxgm+/2eo3ic5G4gmvohS7GU2WTCQdTa7bZYWo5CoZDGZN4J11961dVxYZHo3wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AjaxAuthentication\"\n        title=\"AjaxAuthentication\"\n        src=\"/static/582bf3e3366333e1b1c227c9feb7c3e7/fcda8/AjaxAuthentication.png\"\n        srcset=\"/static/582bf3e3366333e1b1c227c9feb7c3e7/12f09/AjaxAuthentication.png 148w,\n/static/582bf3e3366333e1b1c227c9feb7c3e7/e4a3f/AjaxAuthentication.png 295w,\n/static/582bf3e3366333e1b1c227c9feb7c3e7/fcda8/AjaxAuthentication.png 590w,\n/static/582bf3e3366333e1b1c227c9feb7c3e7/efc66/AjaxAuthentication.png 885w,\n/static/582bf3e3366333e1b1c227c9feb7c3e7/c83ae/AjaxAuthentication.png 1180w,\n/static/582bf3e3366333e1b1c227c9feb7c3e7/ba40d/AjaxAuthentication.png 2524w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>AjaxAuthenticationFilter -> AjaxAuthenticationToken -> AuthenticationManager -> AjaxAuthenticationProvider 순으로 인증처리 흐름</p>\n<h3 id=\"1-ajax-요청-처리-할-filter-추가\" style=\"position:relative;\"><a href=\"#1-ajax-%EC%9A%94%EC%B2%AD-%EC%B2%98%EB%A6%AC-%ED%95%A0-filter-%EC%B6%94%EA%B0%80\" aria-label=\"1 ajax 요청 처리 할 filter 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Ajax 요청 처리 할 Filter 추가</h3>\n<blockquote>\n<p><strong>AbstractAuthenticationProcessingFilter</strong>을 상속받아 <strong>AjaxAuthenticationFilter</strong> 구현</p>\n</blockquote>\n<ul>\n<li>AbstractAuthenticationProcessingFilter는 Form 로그인에서 UsernamePassowordAuthenticationFilter가 상속받던 부모 객체로, 맨 처음 인증 처리를 해주는 Filter 추상 클래스이다.</li>\n<li><strong>필터 적용 조건 1) url 요청 정보 매칭, 2) 헤더에 X-Requested-With으로 Ajax요청 확인</strong></li>\n<li>ObjectMapper을 이용해 request.getReader()로 요청 정보를 읽어서 AccountDto로 매핑</li>\n<li>AjaxAuthenticationToken에 담아 AuthenticationManager의 authenticate 인증 메서드로 전달하여 인증 처리</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AjaxLoginProcessingFilter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractAuthenticationProcessingFilter</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ObjectMapper</span> objectMapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AjaxLoginProcessingFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AntPathRequestMatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/ajaxLogin\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Authentication</span> <span class=\"token function\">attemptAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">throws</span> <span class=\"token class-name\">AuthenticationException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span><span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token class-name\">WebUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAjax</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Authentication method not supported\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">AccountDto</span> accountDto <span class=\"token operator\">=</span> objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">readValue</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">AccountDto</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>accountDto<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>accountDto<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthenticationServiceException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Username or Password not provided\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token class-name\">AjaxAuthenticationToken</span> token <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AjaxAuthenticationToken</span><span class=\"token punctuation\">(</span>accountDto<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> accountDto<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthenticationManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"2-ajaxauthenticationtoken객체-생성\" style=\"position:relative;\"><a href=\"#2-ajaxauthenticationtoken%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1\" aria-label=\"2 ajaxauthenticationtoken객체 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. AjaxAuthenticationToken객체 생성</h3>\n<blockquote>\n<p>인증 정보를 담는 Token 객체 생성, Token 객체를 공통으로 구현하는 AbstractAuthenticationToken 추상 클래스를 상속해 구현</p>\n</blockquote>\n<ul>\n<li>oken의 구성정보를 직접 손댈 필요는 없기 때문에, UsernamePasswordAuthenticationToken.class의 내용을 그대로 복사</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AjaxAuthenticationToken</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractAuthenticationToken</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Object</span> principal<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Object</span> credentials<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AjaxAuthenticationToken</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> principal<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> credentials<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>principal <span class=\"token operator\">=</span> principal<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>credentials <span class=\"token operator\">=</span> credentials<span class=\"token punctuation\">;</span>\n        <span class=\"token function\">setAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AjaxAuthenticationToken</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> principal<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> credentials<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> authorities<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>authorities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>principal <span class=\"token operator\">=</span> principal<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>credentials <span class=\"token operator\">=</span> credentials<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAuthenticated</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getCredentials</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>credentials<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>principal<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>추가로 설정한 Filter를 사용하기 위해선 AuthenticationManager에 등록(set) 시켜야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// AuthenticationManager bean override</span>\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthenticationManager</span> <span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">AjaxLoginProcessingFilter</span> <span class=\"token function\">ajaxLoginProcessingFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">AjaxLoginProcessingFilter</span> ajaxLoginProcessingFilter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AjaxLoginProcessingFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ajaxLoginProcessingFilter<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthenticationManager</span><span class=\"token punctuation\">(</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 등록</span>\n    <span class=\"token keyword\">return</span> ajaxLoginProcessingFilter<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"3-인증-처리-할-ajaxauthenticationprovider-구현\" style=\"position:relative;\"><a href=\"#3-%EC%9D%B8%EC%A6%9D-%EC%B2%98%EB%A6%AC-%ED%95%A0-ajaxauthenticationprovider-%EA%B5%AC%ED%98%84\" aria-label=\"3 인증 처리 할 ajaxauthenticationprovider 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 인증 처리 할 AjaxAuthenticationProvider 구현</h3>\n<p>Provider는 Form 방법과 동일하게 작성 (반환 시 AjaxAuthenticationToken)</p>\n<h3 id=\"4-인증-성공-실패-처리-핸들러-구현\" style=\"position:relative;\"><a href=\"#4-%EC%9D%B8%EC%A6%9D-%EC%84%B1%EA%B3%B5-%EC%8B%A4%ED%8C%A8-%EC%B2%98%EB%A6%AC-%ED%95%B8%EB%93%A4%EB%9F%AC-%EA%B5%AC%ED%98%84\" aria-label=\"4 인증 성공 실패 처리 핸들러 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 인증 성공, 실패 처리 핸들러 구현</h3>\n<p>성공, 실패 handler 처리는 Form과 동일하게 생성 내용은 같아 생략</p>\n<p>설정한 handler함수들은 위에서 사용한 ajaxLoginProcessingFilter를 사용해서 AuthenticationManager에 등록시킨다.</p>\n<p>(ProcessingFilter에서 set 메서드들을 이용하여 handler들을 추가)</p>\n<h3 id=\"5-인가-설정\" style=\"position:relative;\"><a href=\"#5-%EC%9D%B8%EA%B0%80-%EC%84%A4%EC%A0%95\" aria-label=\"5 인가 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 인가 설정</h3>\n<p>인가 처리는 FilterSecurityInterceptor가 수행</p>\n<ol>\n<li>인증을 받지 않는 익명 사용자의 접근처리</li>\n<li>인증을 받은 사용자의 권한 정보 처리</li>\n</ol>\n<p>에 대한 처리를 한다.</p>\n<h4 id=\"51-인증을-받지-않는-익명-사용자의-접근처리\" style=\"position:relative;\"><a href=\"#51-%EC%9D%B8%EC%A6%9D%EC%9D%84-%EB%B0%9B%EC%A7%80-%EC%95%8A%EB%8A%94-%EC%9D%B5%EB%AA%85-%EC%82%AC%EC%9A%A9%EC%9E%90%EC%9D%98-%EC%A0%91%EA%B7%BC%EC%B2%98%EB%A6%AC\" aria-label=\"51 인증을 받지 않는 익명 사용자의 접근처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5.1) 인증을 받지 않는 익명 사용자의 접근처리</h4>\n<blockquote>\n<p>AuthenticationEntryPoint를 상속받은 구현체 구현 / 익명 사용자가 인증이 필요한 자원에 접근한 경우, commence 메서드가 호출됨</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AjaxLoginAuthenticationEntryPoint</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationEntryPoint</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">//익명 사용자가 인증이 필요한 자원에 접근한 경우, commence 메서드가 호출됨</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">commence</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthenticationException</span> e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">sendError</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SC_UNAUTHORIZED</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UnAuthorized\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"52-인증을-받은-사용자의-권한-정보-처리\" style=\"position:relative;\"><a href=\"#52-%EC%9D%B8%EC%A6%9D%EC%9D%84-%EB%B0%9B%EC%9D%80-%EC%82%AC%EC%9A%A9%EC%9E%90%EC%9D%98-%EA%B6%8C%ED%95%9C-%EC%A0%95%EB%B3%B4-%EC%B2%98%EB%A6%AC\" aria-label=\"52 인증을 받은 사용자의 권한 정보 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5.2) 인증을 받은 사용자의 권한 정보 처리</h4>\n<blockquote>\n<p>AccessDeniedHandler를 상속받고, handler 메서드를 Override 해준다.</p>\n</blockquote>\n<p>구현체를 모두 작성하였으면 설정 파일에 authenticationEntryPoint, accessDeniedHandler 메서드를 추가<br>\n각 객체들을 그대로 사용할 것이기 때문에 따로 Bean으로 만들지 않고 new 키워드를 통해 바로 생성</p>\n<h3 id=\"6-bean-설정-및-ajax용-securityconfig-설정-추가\" style=\"position:relative;\"><a href=\"#6-bean-%EC%84%A4%EC%A0%95-%EB%B0%8F-ajax%EC%9A%A9-securityconfig-%EC%84%A4%EC%A0%95-%EC%B6%94%EA%B0%80\" aria-label=\"6 bean 설정 및 ajax용 securityconfig 설정 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. Bean 설정 및 Ajax용 SecurityConfig 설정 추가</h3>\n<ol>\n<li>Ajax용 Config가 Form Config보다 먼저 로드되게 설정 -> @Order(0)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// config</span>\nhttp\n    <span class=\"token punctuation\">.</span><span class=\"token function\">addFilterBefore</span><span class=\"token punctuation\">(</span><span class=\"token function\">ajaxLoginProcessingFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UsernamePasswordAuthenticationFilter</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//기존 필터 앞에 위치할때 사용하는 method</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">authenticationEntryPoint</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AjaxLoginAuthenticationEntryPoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">accessDeniedHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AjaxAccessDeniedHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nhttp<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//기본적으로 csrf 토큰값을 들고 요청을 해야되는데, 임시적으로 off 한다.</span>\n\n\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">AuthenticationManager</span> <span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">AjaxLoginProcessingFilter</span> <span class=\"token function\">ajaxLoginProcessingFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">AjaxLoginProcessingFilter</span> ajaxLoginProcessingFilter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AjaxLoginProcessingFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ajaxLoginProcessingFilter<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthenticationManager</span><span class=\"token punctuation\">(</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//인증 성공, 실패 시 handler 처리</span>\n    ajaxLoginProcessingFilter<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthenticationSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token function\">ajaxAuthenticationSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ajaxLoginProcessingFilter<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthenticationFailureHandler</span><span class=\"token punctuation\">(</span><span class=\"token function\">ajaxAuthenticationFailureHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> ajaxLoginProcessingFilter<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"dsls\" style=\"position:relative;\"><a href=\"#dsls\" aria-label=\"dsls permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DSLs</h3>\n<p>강의에선 dsl을 사용해 Configurer 클래스를 생성해 Config 부분을 나눠<br>\nfilter, handler, 환경설정 메서드의 set을 만든다</p>\n<p>공식 문서에서는 AbstractHttpConfigurer를 상속받아 설명하는데<br>\n강의에서는 AbstractHttpConfigurer를 상속받은 AbstractAuthenticationFilterConfigurer를 상속받아 Configurer를 구현한다.</p>\n<p>사실 이해하기 힘들어서 해당 부분은 코드 읽고 넘어간다.</p>\n<p>추후에 config파일을 나눌 일이 있으면 해당 document를 참고해서 작성하자</p>\n<p><a href=\"https://docs.spring.io/spring-security/reference/servlet/configuration/java.html#jc-custom-dsls\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Security 6.0.1 document</a><br>\n<a href=\"https://godekdls.github.io/Spring%20Security/javaconfiguration/#164-custom-dsls\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Security 5.3.2 document - 토리맘의 한글라이즈 프로젝트</a></p>\n<h3 id=\"ajax-login-csrf-설정\" style=\"position:relative;\"><a href=\"#ajax-login-csrf-%EC%84%A4%EC%A0%95\" aria-label=\"ajax login csrf 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ajax Login, CSRF 설정</h3>\n<p>csrf token값은 header에 meta태그나 form태그의 hidden속성을 주고 ajax요청 시 csrfHeader에 csrfToken을 함께 보내준다.</p>\n<ul>\n<li>csrf Filter는 disable 처리를 하지 않는 한 자동 처리</li>\n<li>헤더에 토큰을 포함 시킬 경우 <strong>X-CSRF-TOKEN</strong>, <strong>X-XSRF-TOKEN</strong></li>\n<li>form에 담을 경우 파라미터 명 <strong>_csrf</strong></li>\n</ul>\n<p>추가로 CSRF토큰에 대해 잘 정리해둔 블로그 글이 있어 링크 남긴다.\n<a href=\"https://binchoo.tistory.com/46\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[스프링 Security] CSRF 토큰 이야기 - 그래서 개발자는 뭘 하면 되죠</a></p>\n<h1 id=\"인가-프로세스-db연동\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EA%B0%80-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-db%EC%97%B0%EB%8F%99\" aria-label=\"인가 프로세스 db연동 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인가 프로세스 DB연동</h1>\n<p>강의 진행을 위해 설정 클래스(config)에서 관련된 코드 모두 제거</p>\n<h2 id=\"url-방식-처리\" style=\"position:relative;\"><a href=\"#url-%EB%B0%A9%EC%8B%9D-%EC%B2%98%EB%A6%AC\" aria-label=\"url 방식 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>URL 방식 처리</h2>\n<h3 id=\"url-방식-기본-동작-원리\" style=\"position:relative;\"><a href=\"#url-%EB%B0%A9%EC%8B%9D-%EA%B8%B0%EB%B3%B8-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC\" aria-label=\"url 방식 기본 동작 원리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>URL 방식 기본 동작 원리</h3>\n<blockquote>\n<p>FilterSecurityInterceptor가 AccessDecisionManager에게 <strong>인증, 요청, 권한정보</strong>를 담아서 전달해주어 인증 및 인가처리</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0d97f58074889f1036d312145e938847/8f1fd/AuthorizationProcess.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8ElEQVQoz12SW0/UUBSF50ciJj6pL/wA9R/4isZgVAgmRGPCi8olMQqGIRgRB5CBgbkA40yhc5922p6e05mW4fO0wgR9WN077c7q3mutlO/7SClRQUBQKzGQIumv38d1BOEhff39qvd1//9MKn64nodl2zTzGX4fl+ha9mhwVIM+cghuf0hPRchLkINoRCr0jCc04TAaUDzv8XY1z5uVHNNLu3zL1YiicPRXGQxw6xWsjXdUP81wvPwKKz2Hc7qHuiIN+4rLUJFqtVoYZyZVs0G+eMzu/iGGWafZaCCE0PAQUtGtFjhbeMLph6ecLj6nPP+Ybv4HXhAS+C6Hhk36qE1qcnKSW2Nj3L93l0cPHyT19vg4ExMTNDSp510Tlqh91tstTFH4OIWx9IxuMUNFL+K0TV6uGdyZOSJlx9o1m1QNg4PcAds72+SzWU4KBXqOg6shZJBs6KzP0VyZpfZlFvvrNHbxJ34/oq+Elq3L93ydlFKKwSDEtVz2d7IYlXMcy8HqdDBrNcrlMpbVxVd9RATOlSniAoTWViY6y0TDYRhoQn1Op9dm6yjN+uYir9+/YHl1gb1f2YTMNM3kgsTtUWy0s0n/l0xKP3FZxC6r+BynRaa8wWYpzdbJGqZVIQovdB4Vgc5kfMU/ebyBm/GK8Qdrvo2Ot66WfgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AuthorizationProcess\"\n        title=\"AuthorizationProcess\"\n        src=\"/static/0d97f58074889f1036d312145e938847/fcda8/AuthorizationProcess.png\"\n        srcset=\"/static/0d97f58074889f1036d312145e938847/12f09/AuthorizationProcess.png 148w,\n/static/0d97f58074889f1036d312145e938847/e4a3f/AuthorizationProcess.png 295w,\n/static/0d97f58074889f1036d312145e938847/fcda8/AuthorizationProcess.png 590w,\n/static/0d97f58074889f1036d312145e938847/efc66/AuthorizationProcess.png 885w,\n/static/0d97f58074889f1036d312145e938847/c83ae/AuthorizationProcess.png 1180w,\n/static/0d97f58074889f1036d312145e938847/8f1fd/AuthorizationProcess.png 2528w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>FilterChainProxy에 있는 <strong>FilterSecurityInterceptor</strong> 에서 사용자는 요청받은 url정보 처리</li>\n<li><strong>FilterInvocationSecurityMetadataSource</strong>의 <strong>RequestMap</strong>객체를 확인하여 url에 매핑되어 있는 권한 정보를 확인</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>key</th>\n<th>value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/user</td>\n<td>ROLE<em>ADMIN, ROLE</em>USER</td>\n</tr>\n<tr>\n<td>/configs</td>\n<td>ROLE_ADMIN</td>\n</tr>\n</tbody>\n</table>\n<ol start=\"3\">\n<li>권한 정보가 있다면 AccessDecisionManager로 <strong>Authentication, FilterInovation, List<ConfigAttribute></strong>를 넘겨 인가처리</li>\n<li>매핑 정보가 없다면 어떤 권한으로 접근해도 허용</li>\n</ol>\n<h3 id=\"filterinvocationsecuritymetadatasource\" style=\"position:relative;\"><a href=\"#filterinvocationsecuritymetadatasource\" aria-label=\"filterinvocationsecuritymetadatasource permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FilterInvocationSecurityMetadataSource</h3>\n<blockquote>\n<p>Url 방식으로 처리할 땐 FilterInvocationSecurityMetadataSource 구현</p>\n</blockquote>\n<ul>\n<li>Url 자원에 대한 권한 정보 추출</li>\n<li>AccessDecisionManager에게 전달 해 인가처리 수행</li>\n<li>DB로 부터 자원 및 권한정보 매핑해 Map으로 관리</li>\n<li>사용자의 요청마다 요청정보에 매핑된 권한 정보 확인</li>\n</ul>\n<p>UrlFilterInvocationMetadataSource 파일 생성<br>\n-> getAttributes() 메서드만 구현 / 나머지 DefaultFilterInvocationSecurityMetadataSource 복사해 사용</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UrlFilterInvocationMetadataSource</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FilterInvocationSecurityMetadataSource</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> requestMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAttributes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> o<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IllegalArgumentException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">HttpServletRequest</span> request <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FilterInvocation</span><span class=\"token punctuation\">)</span> o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        requestMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AntPathRequestMatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/mypage\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SecurityConfig</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_USER\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// null로 넘어가서 test 용도로 사용</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNull</span><span class=\"token punctuation\">(</span>requestMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> requestMap<span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>entry <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                   <span class=\"token class-name\">RequestMatcher</span> matcher <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>matcher<span class=\"token punctuation\">.</span><span class=\"token function\">matches</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                       <span class=\"token keyword\">return</span> entry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//권한 정보</span>\n                   <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                       <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                   <span class=\"token punctuation\">}</span>\n               <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n               <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Objects</span><span class=\"token operator\">:</span>nonNull<span class=\"token punctuation\">)</span>\n               <span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collection</span><span class=\"token operator\">::</span><span class=\"token function\">stream</span><span class=\"token punctuation\">)</span>\n               <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAllConfigAttributes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span></span> allAttributes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Iterator</span> var2 <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requestMap<span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>var2<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Collection</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> entry <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token punctuation\">)</span>var2<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            allAttributes<span class=\"token punctuation\">.</span><span class=\"token function\">addAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collection</span><span class=\"token punctuation\">)</span>entry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> allAttributes<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">supports</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> clazz<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">FilterInvocation</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAssignableFrom</span><span class=\"token punctuation\">(</span>clazz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"getattributes\" style=\"position:relative;\"><a href=\"#getattributes\" aria-label=\"getattributes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>getAttributes()</h4>\n<p><strong>FilterInvocationSecurityMetadataSource</strong>가 나중에 <strong>FilterSecurityInterceptor</strong>에 의해 호출되는데 이 때 사용되는<br>\nurl Mapping 정보인 requestMap 객체를 정의</p>\n<h4 id=\"config-설정\" style=\"position:relative;\"><a href=\"#config-%EC%84%A4%EC%A0%95\" aria-label=\"config 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Config 설정</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// security config</span>\nhttp<span class=\"token punctuation\">.</span><span class=\"token function\">addFilterBefore</span><span class=\"token punctuation\">(</span><span class=\"token function\">customFilterSecurityInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">FilterSecurityInterceptor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">FilterSecurityInterceptor</span> <span class=\"token function\">customFilterSecurityInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token class-name\">FilterSecurityInterceptor</span> filterSecurityInterceptor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FilterSecurityInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfilterSecurityInterceptor<span class=\"token punctuation\">.</span><span class=\"token function\">setSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token function\">urlFilterInvocationSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfilterSecurityInterceptor<span class=\"token punctuation\">.</span><span class=\"token function\">setAccessDecisionManager</span><span class=\"token punctuation\">(</span><span class=\"token function\">affirmativeBased</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 인가 방식 종류 중 affirmativeBased 사용 - 가장 많이 사용하는 방식</span>\nfilterSecurityInterceptor<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthenticationManager</span><span class=\"token punctuation\">(</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> filterSecurityInterceptor<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">AccessDecisionManager</span> <span class=\"token function\">affirmativeBased</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AffirmativeBased</span><span class=\"token punctuation\">(</span><span class=\"token function\">getAccessDecisionVoters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessDecisionVoter</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAccessDecisionVoters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RoleVoter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">FilterInvocationSecurityMetadataSource</span> <span class=\"token function\">urlFilterInvocationSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UrlFilterInvocationMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>custom Interceptor가 먼저 동작하게 config 파일 설정</li>\n<li>customFilterSecurityInterceptor를 Bean으로 등록시킨다.</li>\n</ol>\n<p>추가로 Bean으로 등록시키는 경우는 custom해서 작성한 객체 사용 시 Bean, 기존에 등록된 객체 사용 시 해당 객체를 꺼내와 return</p>\n<p>AccessDecisionManager 전략 중 affirmativeBased를 사용하는데 해당 설정은<br>\n<strong>url에 매칭되는 권한 리스트 중 1개만 존재해도 인가 해주는 전략</strong></p>\n<h3 id=\"requestmap-db-연동\" style=\"position:relative;\"><a href=\"#requestmap-db-%EC%97%B0%EB%8F%99\" aria-label=\"requestmap db 연동 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>requestMap DB 연동</h3>\n<h4 id=\"urlresourcesmapfactorybean-권한자원-정보를-resurcemap-생성\" style=\"position:relative;\"><a href=\"#urlresourcesmapfactorybean-%EA%B6%8C%ED%95%9C%EC%9E%90%EC%9B%90-%EC%A0%95%EB%B3%B4%EB%A5%BC-resurcemap-%EC%83%9D%EC%84%B1\" aria-label=\"urlresourcesmapfactorybean 권한자원 정보를 resurcemap 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UrlResourcesMapFactoryBean (권한/자원 정보를 ResurceMap 생성)</h4>\n<blockquote>\n<p>User정보를 DB로부터 가져온 권한/자원 정보를 ResurceMap만드는 구현체 (Bean으로 등록)</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UrlResourcesMapFactoryBean</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FactoryBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LinkedHashMap</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SecurityResourceService</span> securityResourceService<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> resourceMap<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setSecurityResourceService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecurityResourceService</span> securityResourceService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>securityResourceService <span class=\"token operator\">=</span> securityResourceService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resourceMap <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> resourceMap<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        resourceMap <span class=\"token operator\">=</span> securityResourceService<span class=\"token punctuation\">.</span><span class=\"token function\">getResourceList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getObjectType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>&#x3C;LinkedHashMap&#x3C;RequestMatcher, List<ConfigAttribute>> 부분은 role - resource 정보를 불러오기 위해 사용</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">requestMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AntPathRequestMatcher</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/mypage\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SecurityConfig</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_USER\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위와 같은 느낌으로</p>\n<p>즉, 해당 클래스의 역할은 DB로 부터 가져오는 Service객체를 생성해주고 정보를 가져와 FilterInvocationMetadataSource로 전달해주는 역할</p>\n<h3 id=\"resource를-가져오는-service를-생성\" style=\"position:relative;\"><a href=\"#resource%EB%A5%BC-%EA%B0%80%EC%A0%B8%EC%98%A4%EB%8A%94-service%EB%A5%BC-%EC%83%9D%EC%84%B1\" aria-label=\"resource를 가져오는 service를 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Resource를 가져오는 Service를 생성</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityResourceService</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ResourcesRepository</span> resourcesRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">RoleResourceRepository</span> roleResourceRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getResourceList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Resource</span><span class=\"token punctuation\">></span></span> resources <span class=\"token operator\">=</span> resourcesRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        resources<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>resource <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span></span> configAttributes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">Long</span> resourceId <span class=\"token operator\">=</span> resource<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RoleResource</span><span class=\"token punctuation\">></span></span> roleResources <span class=\"token operator\">=</span> roleResourceRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllByResourceId</span><span class=\"token punctuation\">(</span>resourceId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            roleResources<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>roleResource <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                configAttributes<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SecurityConfig</span><span class=\"token punctuation\">(</span>roleResource<span class=\"token punctuation\">.</span><span class=\"token function\">getRole</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRoleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ConfigAttribute 타입의 구현체인 SecurityConfig를 넣어준다.</span>\n                result<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AntPathRequestMatcher</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">.</span><span class=\"token function\">getResourceName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> configAttributes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"config-파일-설정\" style=\"position:relative;\"><a href=\"#config-%ED%8C%8C%EC%9D%BC-%EC%84%A4%EC%A0%95\" aria-label=\"config 파일 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Config 파일 설정</h4>\n<p>작성한 service와 service객체를 만들어주는 Factory Bean을 Security Config 파일에 등록</p>\n<p>이전엔 UrlFilterInvocationSecurityMetadataSource를 그대로 사용했는데 urlResourcesMapFactoryBean을 사용하게 변경</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UrlFilterInvocationSecurityMetadataSource</span> <span class=\"token function\">urlFilterInvocationSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UrlFilterInvocationSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token function\">urlResourcesMapFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> securityResourceService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UrlResourcesMapFactoryBean</span> <span class=\"token function\">urlResourcesMapFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">UrlResourcesMapFactoryBean</span> urlResourcesMapFactoryBean <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UrlResourcesMapFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        urlResourcesMapFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">setSecurityResourceService</span><span class=\"token punctuation\">(</span>securityResourceService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> urlResourcesMapFactoryBean<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"db-접근-권한-실시간-반영\" style=\"position:relative;\"><a href=\"#db-%EC%A0%91%EA%B7%BC-%EA%B6%8C%ED%95%9C-%EC%8B%A4%EC%8B%9C%EA%B0%84-%EB%B0%98%EC%98%81\" aria-label=\"db 접근 권한 실시간 반영 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB 접근 권한 실시간 반영</h3>\n<blockquote>\n<p>DB에 자원/권한 정보를 업데이트 시, 실시간으로 ResourceMap에 업데이트</p>\n</blockquote>\n<h4 id=\"urlfilterinvocationmetadatasource에-reload-메서드-추가\" style=\"position:relative;\"><a href=\"#urlfilterinvocationmetadatasource%EC%97%90-reload-%EB%A9%94%EC%84%9C%EB%93%9C-%EC%B6%94%EA%B0%80\" aria-label=\"urlfilterinvocationmetadatasource에 reload 메서드 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UrlFilterInvocationMetadataSource에 reload 메서드 추가</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> reloadedMap <span class=\"token operator\">=</span> securityResourceService<span class=\"token punctuation\">.</span><span class=\"token function\">getResourceList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Iterator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> iterator <span class=\"token operator\">=</span> reloadedMap<span class=\"token punctuation\">.</span><span class=\"token function\">entrySet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    requestMap<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//기존 정보를 지움</span>\n\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>iterator<span class=\"token punctuation\">.</span><span class=\"token function\">hasNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Map<span class=\"token punctuation\">.</span>Entry</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> entry <span class=\"token operator\">=</span> iterator<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        requestMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span><span class=\"token function\">getKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> entry<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"controller-수정\" style=\"position:relative;\"><a href=\"#controller-%EC%88%98%EC%A0%95\" aria-label=\"controller 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Controller 수정</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span>value<span class=\"token operator\">=</span><span class=\"token string\">\"/admin/resource/register\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">createResource</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RoleResourcesPo</span> roleResourcesPo<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">ModelMapper</span> modelMapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ModelMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">RoleResourcesDto</span> roleResourcesDto <span class=\"token operator\">=</span> modelMapper<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>roleResourcesPo<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RoleResourcesDto</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        resourcesService<span class=\"token punctuation\">.</span><span class=\"token function\">createRoleAndResources</span><span class=\"token punctuation\">(</span>roleResourcesDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        urlFilterInvocationMetadataSource<span class=\"token punctuation\">.</span><span class=\"token function\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 자원 생성 시 reload 추가</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"redirect:/admin/resources\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>자원 추가 시 urlFilterInvocationMetadataSource를 reload하는 구문을 추가한다.</p>\n<h3 id=\"허용-필터\" style=\"position:relative;\"><a href=\"#%ED%97%88%EC%9A%A9-%ED%95%84%ED%84%B0\" aria-label=\"허용 필터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>허용 필터</h3>\n<blockquote>\n<p>인증 및 권한심사, 허용 IP -> ACCESS_ABSTAIN return / 허용 x IP -> 즉시 예외 처리 해 자원 접근 거부를 할 필요가 없는 자원 (/, /home, login ...) 들을 미리 설정해서 바로 리소스 접근이 가능하게 하는 필터</p>\n</blockquote>\n<p>인가 처리 과정</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FilterSecurityInterceptor -> AbstractSecurityInterceptor -> List&lt;ConfigAttribute> (null이 아닐 경우) -> AccessDecisionManager</code></pre></div>\n<p>FilterSecurityInterceptor를 상속받아 구현한다.</p>\n<p>permitAllFilter라는 이름을 가진 구현체를 구현하는데</p>\n<p>url list (List<RequestMatcher>)를 읽고 설정 한 경로가 있으면 권한 심사 없이 통과하도록 <strong>null값을 리턴</strong>한다</p>\n<ol>\n<li>FilterSecurityInterceptor를 상속받아 invoke함수 사용</li>\n<li>PermitAllFilter에서 객체 생성 시 url list를 받을 수 있게 생성자에서 requestMatchers에 대한 list를 생성</li>\n<li>url list를 검사 할 beforeInvocation 함수 작성</li>\n<li>이전 config 설정에서 FilterSecurityInterceptor를 사용한 부분을 PermitAllFilter를 사용하게 수정한다.</li>\n<li>PermitAllFilter에서 사용하게 될 url을 Config 파일에서 String 배열로 만들어 넣어준다.</li>\n</ol>\n<p>(추후에 적용시킬 경우 DB로 불러와 적용시켜도 좋을 것 같다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PermitAllFilter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">FilterSecurityInterceptor</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">FILTER_APPLIED</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"__spring_security_filterSecurityInterceptor_filterApplied\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> observeOncePerRequest <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RequestMatcher</span><span class=\"token punctuation\">></span></span> permitAllRequestMatchers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PermitAllFilter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> permitAllResources<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> resource <span class=\"token operator\">:</span> permitAllResources<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            permitAllRequestMatchers<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">AntPathRequestMatcher</span><span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">InterceptorStatusToken</span> <span class=\"token function\">beforeInvocation</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> object<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">boolean</span> permitAll <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">HttpServletRequest</span> request <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FilterInvocation</span><span class=\"token punctuation\">)</span> object<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">RequestMatcher</span> requestMatcher <span class=\"token operator\">:</span> permitAllRequestMatchers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requestMatcher<span class=\"token punctuation\">.</span><span class=\"token function\">matches</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                permitAll <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>permitAll<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">beforeInvocation</span><span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FilterInvocation</span> fi<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>fi<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>fi<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FILTER_APPLIED</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">&amp;&amp;</span> observeOncePerRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            fi<span class=\"token punctuation\">.</span><span class=\"token function\">getChain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>fi<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> fi<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fi<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> observeOncePerRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                fi<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FILTER_APPLIED</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">.</span><span class=\"token constant\">TRUE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token class-name\">InterceptorStatusToken</span> token <span class=\"token operator\">=</span> <span class=\"token function\">beforeInvocation</span><span class=\"token punctuation\">(</span>fi<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                fi<span class=\"token punctuation\">.</span><span class=\"token function\">getChain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>fi<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> fi<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">finallyInvocation</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">afterInvocation</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"계층-권한-적용\" style=\"position:relative;\"><a href=\"#%EA%B3%84%EC%B8%B5-%EA%B6%8C%ED%95%9C-%EC%A0%81%EC%9A%A9\" aria-label=\"계층 권한 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>계층 권한 적용</h3>\n<blockquote>\n<p>RoleHierarchyService를 만들어 Config에 적용시킨다</p>\n</blockquote>\n<ol>\n<li>entity, repository, Service 구현 RoleHierarchyService 에서 Spring security에서 지정한 규칙대로 String으로 반환</li>\n</ol>\n<p><a href=\"https://docs.spring.io/spring-security/reference/servlet/authorization/architecture.html#authz-hierarchical-roles\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hierarchical Roles - Spring security document</a></p>\n<ol start=\"2\">\n<li>getAccessDecisionVoters에서 기본 RoleVoter를 사용하던 부분을 RoleHierarchyVoter가 설정되게 변경</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// entity</span>\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"ROLE_HIERARCHY\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RoleHierarchy</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"child_name\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> childName<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>cascade <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"parent_name\"</span><span class=\"token punctuation\">,</span> referencedColumnName <span class=\"token operator\">=</span> <span class=\"token string\">\"child_name\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RoleHierarchy</span> parentName<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"parentName\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RoleHierarchy</span><span class=\"token punctuation\">></span></span> roleHierarchy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RoleHierarchy</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// repository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ResourcesRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Resources</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Resources</span> <span class=\"token function\">findByResourceNameAndHttpMethod</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> resourceName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> httpMethod<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select r from Resources r join fetch r.roleSet where r.resourceType = 'url' order by r.orderNum desc\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Resources</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select r from Resources r join fetch r.roleSet where r.resourceType = 'method' order by r.orderNum desc\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Resources</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllMethodResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select r from Resources r join fetch r.roleSet where r.resourceType = 'pointcut' order by r.orderNum desc\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Resources</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllPointcutResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Service</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PermitAllFilter</span> <span class=\"token function\">customFilterSecurityInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">PermitAllFilter</span> permitAllFilter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PermitAllFilter</span><span class=\"token punctuation\">(</span>permitAllResources<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        permitAllFilter<span class=\"token punctuation\">.</span><span class=\"token function\">setSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token function\">urlFilterInvocationSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        permitAllFilter<span class=\"token punctuation\">.</span><span class=\"token function\">setAccessDecisionManager</span><span class=\"token punctuation\">(</span><span class=\"token function\">affirmativeBased</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        permitAllFilter<span class=\"token punctuation\">.</span><span class=\"token function\">setAuthenticationManager</span><span class=\"token punctuation\">(</span><span class=\"token function\">authenticationManagerBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> permitAllFilter<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AccessDecisionManager</span> <span class=\"token function\">affirmativeBased</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">AffirmativeBased</span> affirmativeBased <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AffirmativeBased</span><span class=\"token punctuation\">(</span><span class=\"token function\">getAccessDecisionVoters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> affirmativeBased<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessDecisionVoter</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAccessDecisionVoters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessDecisionVoter</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> accessDecisionVoters <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        accessDecisionVoters<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token function\">roleVoter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> accessDecisionVoters<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">AccessDecisionVoter</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">roleVoter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">RoleHierarchyVoter</span> roleHierarchyVoter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RoleHierarchyVoter</span><span class=\"token punctuation\">(</span><span class=\"token function\">roleHierarchy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> roleHierarchyVoter<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RoleHierarchyImpl</span> <span class=\"token function\">roleHierarchy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">RoleHierarchyImpl</span> roleHierarchy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RoleHierarchyImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> roleHierarchy<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>추가로 config에서 사용되는 RoleHierarchy를 전달받아야 하는데 강의에서는 ApplicationRunner의 run메소드를 이용해서 RoleHierarchy객체를 전달한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityInitializer</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationRunner</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RoleHierarchyService</span> roleHierarchyService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RoleHierarchyImpl</span> roleHierarchy<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApplicationArguments</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> allHierarchy <span class=\"token operator\">=</span> roleHierarchyService<span class=\"token punctuation\">.</span><span class=\"token function\">findAllHierarchy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        roleHierarchy<span class=\"token punctuation\">.</span><span class=\"token function\">setHierarchy</span><span class=\"token punctuation\">(</span>allHierarchy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!-- TODO: 나중에 이거 해볼 때 Security server경로 admin -->\n<p>config에서도 Bean으로 주입받아도 사용 가능 (어느 타이밍에 하던 상관x)</p>\n<h3 id=\"ip-접속-제한\" style=\"position:relative;\"><a href=\"#ip-%EC%A0%91%EC%86%8D-%EC%A0%9C%ED%95%9C\" aria-label=\"ip 접속 제한 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IP 접속 제한</h3>\n<ul>\n<li>Voter에 의한 인가 처리는 AccessDecisionManager가 처리</li>\n<li>추가적인 Voter 구현체로 <strong>IpAddressVoter</strong> 구현</li>\n</ul>\n<h4 id=\"ipaddressvoter\" style=\"position:relative;\"><a href=\"#ipaddressvoter\" aria-label=\"ipaddressvoter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IPAddressVoter</h4>\n<ul>\n<li>특정 IP만 접근이 가능하도록 심의하는 Voter</li>\n<li>가장 먼저 심사, 허용 IP -> ACCESS_ABSTAIN return / 허용 x IP -> 즉시 예외 처리 해 자원 접근 거부</li>\n<li>ACCESS_ABSTAIN로 리턴 하면 일단 해당 Voter에서는 인가를 승인하되, 다음 Voter로 승인을 보류</li>\n<li>ACCESS_DENIED로 넘기면 다른 Voter가 판단할 수 있으므로 exception처리</li>\n<li>테이블 추가</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"ACCESS_IP\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Data</span>\n<span class=\"token annotation punctuation\">@EqualsAndHashCode</span><span class=\"token punctuation\">(</span>of <span class=\"token operator\">=</span> <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccessIp</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"IP_ID\"</span><span class=\"token punctuation\">,</span> unique <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"IP_ADDRESS\"</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> ipAddress<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>IpAddressVoter 작성</li>\n<li>AccessDecisionVoter를 상속받는 구현체 작성</li>\n<li>authentication 객체에서 IP에 대한 정보를 꺼내와 IP 조회 로직 구현</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IpAddressVoter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AccessDecisionVoter</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">SecurityResourceService</span> securityResourceService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">supports</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConfigAttribute</span> configAttribute<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">supports</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Class</span> aClass<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">vote</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> o<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Collection</span> collection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">//authentication.getDetails에서 사용자 정보를 얻을 수 있으며, WebAuthenticationDetails 객체로 캐스팅 해줘야 사용 가능</span>\n        <span class=\"token class-name\">WebAuthenticationDetails</span> details <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">WebAuthenticationDetails</span><span class=\"token punctuation\">)</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getDetails</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> remoteAddress <span class=\"token operator\">=</span> details<span class=\"token punctuation\">.</span><span class=\"token function\">getRemoteAddress</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> accessIpList <span class=\"token operator\">=</span> securityResourceService<span class=\"token punctuation\">.</span><span class=\"token function\">getAccessIpList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> accessIp <span class=\"token operator\">:</span> accessIpList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>accessIp<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>remoteAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant\">ACCESS_ABSTAIN</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccessDeniedException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid Ip Address\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>​</code></pre></div>\n<ol start=\"3\">\n<li>Security Config 추가</li>\n</ol>\n<p>인가 결정을 보류하는 로직이 있기 때문에 <strong>반드시 roleVoter 앞에 위치</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessDecisionVoter</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAccessDecisionVoters</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AccessDecisionVoter</span><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> accessDecisionVoters <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        accessDecisionVoters<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">IpAddressVoter</span><span class=\"token punctuation\">(</span>securityResourceService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        accessDecisionVoters<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token function\">roleVoter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> accessDecisionVoters<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"method-방식-인가-처리\" style=\"position:relative;\"><a href=\"#method-%EB%B0%A9%EC%8B%9D-%EC%9D%B8%EA%B0%80-%EC%B2%98%EB%A6%AC\" aria-label=\"method 방식 인가 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Method 방식 인가 처리</h2>\n<blockquote>\n<p>URL별 인가처리가 아닌 <strong>메소드 단위로 인가처리 적용</strong> 가능</p>\n</blockquote>\n<ul>\n<li>AOP기반으로 동작 (프록시와 어드바이스)</li>\n<li>설정 방식 2가지 - 어노테이션 기반, 맵 기반(DB와 연동)</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc730ce4461827476d9a106b44f336ff/9e9da/Method1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABX0lEQVQoz3VQ226CQBDld3zQHzDxd3t5sG3aFAQxtQ9tFbUaEZpUQUALBrwUBUFsTnfX0PjSSU525sw5s5nhoihCjt1uxxDHMXzfh6qq0DQNw+GQgeaUC4KAaXL9+QwuH5QTYRiChiAIKBQKKBaLKJfLqFQqKJVKjJMkiWmoNvfmL7clyXZ7ji373XU91Go18LwAWZYhNxp45HnURBGet2Aaqj330qFclu5xPCQnZAlone4jJAT/RRJHSJMYGfOkf/494bn+5xc6uoOOZqOtThm6pHYWG/Q+HCiaRTgTyijv2aynEO5tMIYyNNAdWaznBhtwUtdCtanjut7Hpdhl+e2zDtX0IbRNPLxOcCW9s/79yxh8y4Bur1BvjXEnD3Bx84Sq2MN9U4PlrsF9b1awTAMz28J8ZpN8AmtqYLX02Tp0NceewnPnOJBzZOlptZ/jAev1EjbxzRwL0S4kZ4rxCz569T8IcdIvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Method1\"\n        title=\"Method1\"\n        src=\"/static/dc730ce4461827476d9a106b44f336ff/fcda8/Method1.png\"\n        srcset=\"/static/dc730ce4461827476d9a106b44f336ff/12f09/Method1.png 148w,\n/static/dc730ce4461827476d9a106b44f336ff/e4a3f/Method1.png 295w,\n/static/dc730ce4461827476d9a106b44f336ff/fcda8/Method1.png 590w,\n/static/dc730ce4461827476d9a106b44f336ff/efc66/Method1.png 885w,\n/static/dc730ce4461827476d9a106b44f336ff/c83ae/Method1.png 1180w,\n/static/dc730ce4461827476d9a106b44f336ff/9e9da/Method1.png 2482w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/69c0d44a4e0df0a5f3ff9a62d2355863/91a65/Method2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACF0lEQVQoz1WS7U/TUBTG93ea+N1/gQ8G+WAiKlETEhM/YMKLMBg4kQgElRBYiMPFYBhjGbJ23crare36cru2K/t5NxKRmzw5uSf3POec+zwZ3/dRVZVWq4WmaSiKQrPZxPECRD8iCGQUYhxDeTcth0ajga7r1Ov18ftRvWmahGFIZvTQcZwxXNel0+mgqBrtixJBR8cXoSTz8QNJahl0qyWuFBXbtrEsS6KLZVv03N64caYvWQdJxGAQkyYx/VAQRglCqzAUDjdA4HsMZSQOiPUqUTKQNQlJPJA1NxIpgzi9JbxQO2S3jljZ2GNz/5TqlcbL59M8ezHD48lJFuY/yGYwO/uWJ1NTTM+8YmJigkKhwEn1iLW9RVZ3F9kp5unYBpmm2ePb8RkrH3cpnqk0dYP13Bqf8nmWl7N82V7BMErkcvMsLCyxsb7O3Nwc5XKZS/2CnaNN8nur/Kr9wHK6ZIT8H11TqFV+0zWvCeXY/59IbPGn9gjS4v18JAXzBdeagVJrIPwQz/NHovgobYfDioFpu2MBXM+TxD4HJY3Ph22+Fh22Cm32TzRGA7iux8gdQgp1qZ9TbpbuRBkmffI/Wzx4V6ai2aRxH88PSKKQ/EGd19kyS7s13mTPyX2vE0dCKh5I+KTRkPfHT5nafkjXMaSgkVxZsjo9j5Zhya63nhMiGPuOtD9aDm7u4j1fSku1uy0axtW//F+lZYtop7CRSwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Method2\"\n        title=\"Method2\"\n        src=\"/static/69c0d44a4e0df0a5f3ff9a62d2355863/fcda8/Method2.png\"\n        srcset=\"/static/69c0d44a4e0df0a5f3ff9a62d2355863/12f09/Method2.png 148w,\n/static/69c0d44a4e0df0a5f3ff9a62d2355863/e4a3f/Method2.png 295w,\n/static/69c0d44a4e0df0a5f3ff9a62d2355863/fcda8/Method2.png 590w,\n/static/69c0d44a4e0df0a5f3ff9a62d2355863/efc66/Method2.png 885w,\n/static/69c0d44a4e0df0a5f3ff9a62d2355863/c83ae/Method2.png 1180w,\n/static/69c0d44a4e0df0a5f3ff9a62d2355863/91a65/Method2.png 2476w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"동작-방식\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%9E%91-%EB%B0%A9%EC%8B%9D\" aria-label=\"동작 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동작 방식</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/11d73dede4a096a1ea8bd851e9ad9cfb/b8bf8/MethodAuthenticationArchitecture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVQoz3WS2aqEQAxE/f//82nAFxVX3Pctc08gQ9N4GwJ2Ukmlqg3k7/R9L23byjAM0nWdPM9DWq7rkvu+9U5wtxrH8u4JzvOULMskiiKJ41i/yR3HocOLopA8z6WqKhnHUWsMXtdVyrLUGnkjCygApljXtTRNo8NsYJIkSkIjNVTM86yqWCBNU8UZUWBs0zQpcN93lfl2wG7bpmT+YTv6VDKDYGILa6DoBrLYjs3Am3yrm9+Bb6qx+aZbk0l7e6Dfhp/PR8Iw1MAzf9gb6Ru5DlyWRaVgPI+Dl+RcuYDxGblgCR9juJ9k883fyP0n7fUJ7j5G/0Pzh6dnuzeZ/0n2bdENbSCSCCu44Tb4eZ/wCy02XTS/5IN+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MethodAuthenticationArchitecture\"\n        title=\"MethodAuthenticationArchitecture\"\n        src=\"/static/11d73dede4a096a1ea8bd851e9ad9cfb/fcda8/MethodAuthenticationArchitecture.png\"\n        srcset=\"/static/11d73dede4a096a1ea8bd851e9ad9cfb/12f09/MethodAuthenticationArchitecture.png 148w,\n/static/11d73dede4a096a1ea8bd851e9ad9cfb/e4a3f/MethodAuthenticationArchitecture.png 295w,\n/static/11d73dede4a096a1ea8bd851e9ad9cfb/fcda8/MethodAuthenticationArchitecture.png 590w,\n/static/11d73dede4a096a1ea8bd851e9ad9cfb/efc66/MethodAuthenticationArchitecture.png 885w,\n/static/11d73dede4a096a1ea8bd851e9ad9cfb/c83ae/MethodAuthenticationArchitecture.png 1180w,\n/static/11d73dede4a096a1ea8bd851e9ad9cfb/b8bf8/MethodAuthenticationArchitecture.png 1728w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>URL 방식은 Filter가 가로채서 요청 처리</li>\n<li>Proxy객체에 등록된 Advise가 동작해 요청 처리</li>\n</ul>\n<h3 id=\"관련-어노테이션\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EB%A0%A8-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98\" aria-label=\"관련 어노테이션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관련 어노테이션</h3>\n<h4 id=\"preauthorize-postauthorize\" style=\"position:relative;\"><a href=\"#preauthorize-postauthorize\" aria-label=\"preauthorize postauthorize permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@PreAuthorize, @PostAuthorize</h4>\n<ul>\n<li>SpEL(Spring Expression Language) 지원</li>\n<li>@PreAuthorize(\"hasRole('ROLE_USER')and(#account.username == principal.username)\") 같이 작성 가능</li>\n<li>PrePostAnnotationSecurityMetadataSource가 처리</li>\n</ul>\n<h4 id=\"secured-rolesallowed\" style=\"position:relative;\"><a href=\"#secured-rolesallowed\" aria-label=\"secured rolesallowed permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Secured, @RolesAllowed</h4>\n<ul>\n<li>SpEL을 지원X</li>\n<li>@Secured(\"ROLE<em>USER\"), @RolesAllowed(\"ROLE</em>USER\") 같이 작성 가능</li>\n<li>SecuredAnnotationSecurityMetadataSource, Jsr250MethodSecurityMetadataSource가 처리</li>\n</ul>\n<h4 id=\"enableglobalmethodsecurity\" style=\"position:relative;\"><a href=\"#enableglobalmethodsecurity\" aria-label=\"enableglobalmethodsecurity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@EnableGlobalMethodSecurity</h4>\n<ul>\n<li>메서드 방식의 인가 처리가 가능하게 해준다.</li>\n<li>설정 클래스에 선언을 해야 함</li>\n<li>prePostEnabled = true, securedEnabled = true 등과 같이 속성값을 반드시 true로 변경 해야 해당 어노테이션 사용 가능</li>\n</ul>\n<p>PrePostAnnotationSecurityMetadataSource 등은 앞서 살펴본 MethodSecurityMetadataSource 객체를 상속하고 있다.</p>\n<h3 id=\"적용-방법\" style=\"position:relative;\"><a href=\"#%EC%A0%81%EC%9A%A9-%EB%B0%A9%EB%B2%95\" aria-label=\"적용 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>적용 방법</h3>\n<ol>\n<li>\n<p>config 설정</p>\n<ul>\n<li>Url 처리 방식에서 UrlResourceMap을 관리하는 것과 동일하게 <strong>MethodResourcesMapFactoryBean</strong>을 생성</li>\n<li>url 방식 config와 Method config와 분리해 관리하기 위해 <strong>MethodSecurity</strong>클래스를 만들어 구현</li>\n<li>GlobalMethodSecurityConfiguration을 상속받아 작성</li>\n</ul>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// MethodResourcesMapFactoryBean</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MethodResourcesMapFactoryBean</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FactoryBean</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LinkedHashMap</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SecurityResourceService</span> securityResourceService<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> resourceType<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setResourceType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> resourceType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>resourceType <span class=\"token operator\">=</span> resourceType<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setSecurityResourceService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecurityResourceService</span> securityResourceService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>securityResourceService <span class=\"token operator\">=</span> securityResourceService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> resourcesMap<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"method\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>resourceType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            resourcesMap <span class=\"token operator\">=</span> securityResourceService<span class=\"token punctuation\">.</span><span class=\"token function\">getMethodResourceList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"pointcut\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>resourceType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            resourcesMap <span class=\"token operator\">=</span> securityResourceService<span class=\"token punctuation\">.</span><span class=\"token function\">getPointcutResourceList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ConfigAttribute</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resourcesMap <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> resourcesMap<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rawtypes\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LinkedHashMap</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getObjectType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n<span class=\"token comment\">// MethodSecurityConfig</span>\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token comment\">//@EnableGlobalMethodSecurity</span>\n<span class=\"token annotation punctuation\">@EnableGlobalMethodSecurity</span><span class=\"token punctuation\">(</span>prePostEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> securedEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MethodSecurityConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GlobalMethodSecurityConfiguration</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SecurityResourceService</span> securityResourceService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">MethodSecurityMetadataSource</span> <span class=\"token function\">customMethodSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">mapBasedMethodSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MapBasedMethodSecurityMetadataSource</span> <span class=\"token function\">mapBasedMethodSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MapBasedMethodSecurityMetadataSource</span><span class=\"token punctuation\">(</span><span class=\"token function\">methodResourcesMapFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MethodResourcesMapFactoryBean</span> <span class=\"token function\">methodResourcesMapFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">MethodResourcesMapFactoryBean</span> methodResourcesMapFactoryBean <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MethodResourcesMapFactoryBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        methodResourcesMapFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">setSecurityResourceService</span><span class=\"token punctuation\">(</span>securityResourceService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        methodResourcesMapFactoryBean<span class=\"token punctuation\">.</span><span class=\"token function\">setResourceType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"method\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> methodResourcesMapFactoryBean<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>Config파일에서 resourcesMap으로 하용 할 service, repository 객체 구현</li>\n</ol>\n<p>DB 저장 시 저장 방법</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/61c3ba3262ad9b892a212d0f3a529830/0faf1/saveDb.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.216216216216214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVQI1y2OwU7CQBRF+Xn2foAsiEC0NaGxIrBxJakoC4lpsZ00DAuHBlPaMNMBV8dBXZy83MW757aMMZxprGU6GnHd7RJ4Hg9BwPifx8mELE0RQpDnOWW55/tkWRc1t89bwkVBWWusbWgppVglCR/uwe9d4XUuGfs+4WDA0OW7fp97J3iZz3mazYiiCKW2WF3zLve0b5ZchCm7ynA8F/6uaxq01khnz+KYzAn+iBHuilXCZiNZS4l0VFXF6Wj5/DoQvBZM33bUB4N1PT/CCtExYqk2lwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"saveDb\"\n        title=\"saveDb\"\n        src=\"/static/61c3ba3262ad9b892a212d0f3a529830/fcda8/saveDb.png\"\n        srcset=\"/static/61c3ba3262ad9b892a212d0f3a529830/12f09/saveDb.png 148w,\n/static/61c3ba3262ad9b892a212d0f3a529830/e4a3f/saveDb.png 295w,\n/static/61c3ba3262ad9b892a212d0f3a529830/fcda8/saveDb.png 590w,\n/static/61c3ba3262ad9b892a212d0f3a529830/efc66/saveDb.png 885w,\n/static/61c3ba3262ad9b892a212d0f3a529830/c83ae/saveDb.png 1180w,\n/static/61c3ba3262ad9b892a212d0f3a529830/0faf1/saveDb.png 1956w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol start=\"3\">\n<li>Method에 어노테이션 적용</li>\n</ol>\n<h2 id=\"aop-방식\" style=\"position:relative;\"><a href=\"#aop-%EB%B0%A9%EC%8B%9D\" aria-label=\"aop 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AOP 방식</h2>\n<blockquote>\n<p>ProtectPointcutPostProcessor가 DB정보를 읽어 Bean에 해당하는 TargetClass 정보, Method 정보, ConfigAttribute정보를 읽어 MethodSecurityMetadata에 전달</p>\n</blockquote>\n<p>구현하려면 ProtectPointcutPostProcessor을 상속받아 사용해야 하는데 final로 선언되어 있어 확장이 불가능 -> 강의에선 동일한 기능을 하는 클래스 생성해 기능 구현</p>\n<p>Method방식과 동일하게 config 설정, service, repository 구현해 사용</p>\n<p>Aop방식은 잘 사용할 것 같지 않아서 추후에 실무에서 사용 시 다시 공부해서 적용해야겠다.....</p>\n<h1 id=\"요약\" style=\"position:relative;\"><a href=\"#%EC%9A%94%EC%95%BD\" aria-label=\"요약 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>요약</h1>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<ul>\n<li><a href=\"https://dextto.tistory.com/234\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">인증(Authentication) vs. 인가(Authorization)</a></li>\n<li><a href=\"https://docs.spring.io/spring-security/reference/servlet/authentication/passwords/form.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Security Document</a></li>\n<li><a href=\"https://www.inflearn.com/course/%EC%BD%94%EC%96%B4-%EC%8A%A4%ED%94%84%EB%A7%81-%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0/dashboard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스프링 시큐리티 - Spring Boot 기반으로 개발하는 Spring Security</a></li>\n<li><a href=\"https://programmer93.tistory.com/68\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Security UserDetails, UserDetailsService 란? - 삽질중인 개발자</a></li>\n<li><a href=\"https://stackoverflow.com/questions/53140629/spring-security-loginpage-vs-loginprocessingurl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spring Security loginPage Vs loginProcessingURL - stackoverflow</a></li>\n<li><a href=\"https://binchoo.tistory.com/46\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[스프링 Security] CSRF 토큰 이야기 - 그래서 개발자는 뭘 하면 되죠</a></li>\n<li><a href=\"https://whitepro.tistory.com/m/521\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">[스프링 시큐리티]23. Method 방식 : 동작방식 및 구조 알아보기 - 컴퓨터 탐험가 찰리</a></li>\n</ul>","excerpt":"해당 포스팅은 정수원님의 스프링 시큐리티 - Spring Boot 기반으로 개발하는 Spring Security 강의와 스프링 시큐리티 OAuth2 - Spring Boot 기반으로 개발하는 Spring Security OAuth2의 Spring S…","tableOfContents":"<ul>\n<li><a href=\"/SpringSecurity1/#%EC%9A%A9%EC%96%B4-%EC%A0%95%EB%A6%AC\">용어 정리</a></li>\n<li>\n<p><a href=\"/SpringSecurity1/#%EA%B8%B0%EB%B3%B8-api-%EB%B0%8F-filter\">기본 API 및 Filter</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#%EC%9E%90%EB%8F%99-%EA%B5%AC%EC%84%B1-%ED%95%AD%EB%AA%A9\">자동 구성 항목</a></li>\n<li><a href=\"/SpringSecurity1/#login-form-%EC%9D%B8%EC%A6%9D-%EA%B3%BC%EC%A0%95\">Login Form 인증 과정</a></li>\n<li><a href=\"/SpringSecurity1/#logout%EA%B3%BC%EC%A0%95\">Logout과정</a></li>\n<li>\n<p><a href=\"/SpringSecurity1/#rememberme-%EC%9D%B8%EC%A6%9D-%EC%98%81%EA%B5%AC-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%9D%B8%EC%A6%9D\">RememberMe 인증 (영구 로그인 인증)</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#%EC%9D%B8%EC%A6%9D-%EA%B3%BC%EC%A0%95\">인증 과정</a></li>\n<li><a href=\"/SpringSecurity1/#%EC%A0%95%EB%A6%AC\">정리</a></li>\n</ul>\n</li>\n<li><a href=\"/SpringSecurity1/#%EC%9D%B5%EB%AA%85%EC%82%AC%EC%9A%A9%EC%9E%90-%ED%95%84%ED%84%B0\">익명사용자 필터</a></li>\n<li><a href=\"/SpringSecurity1/#%EB%8F%99%EC%8B%9C-%EC%84%B8%EC%85%98-%EC%A0%9C%EC%96%B4\">동시 세션 제어</a></li>\n<li><a href=\"/SpringSecurity1/#%EC%84%B8%EC%85%98-%EA%B3%A0%EC%A0%95-%EB%B3%B4%ED%98%B8\">세션 고정 보호</a></li>\n<li><a href=\"/SpringSecurity1/#%EC%84%B8%EC%85%98-%EC%A0%95%EC%B1%85\">세션 정책</a></li>\n<li><a href=\"/SpringSecurity1/#sessionmanagementfilter-concurrentsessionfilter\">SessionManagementFilter, ConcurrentSessionFilter</a></li>\n<li>\n<p><a href=\"/SpringSecurity1/#%EA%B6%8C%ED%95%9C-%EC%84%A4%EC%A0%95%EA%B3%BC-%ED%91%9C%ED%98%84%EC%8B%9D\">권한 설정과 표현식</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#%EC%84%A0%EC%96%B8%EC%A0%81-%EB%B0%A9%EC%8B%9D\">선언적 방식</a></li>\n<li><a href=\"/SpringSecurity1/#2-%EB%8F%99%EC%A0%81-%EB%B0%A9%EC%8B%9D-db%EC%97%B0%EB%8F%99\">2. 동적 방식 (DB연동)</a></li>\n<li><a href=\"/SpringSecurity1/#%EC%A3%BC%EC%9D%98-%EC%82%AC%ED%95%AD\">주의 사항</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity1/#%EC%98%88%EC%99%B8-%EC%B2%98%EB%A6%AC-%EB%B0%8F-%EC%9A%94%EC%B2%AD-%EC%BA%90%EC%8B%9C-%ED%95%84%ED%84%B0\">예외 처리 및 요청 캐시 필터</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#authenticationexception\">AuthenticationException</a></li>\n</ul>\n</li>\n<li><a href=\"/SpringSecurity1/#csrf%EC%B2%98%EB%A6%AC\">CSRF처리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity1/#%EC%A3%BC%EC%9A%94-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98\">주요 아키텍처</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#delegatingfilterproxy\">DelegatingFilterProxy</a></li>\n<li><a href=\"/SpringSecurity1/#filterchainproxy\">FilterChainProxy</a></li>\n<li><a href=\"/SpringSecurity1/#filter-%EC%B4%88%EA%B8%B0%ED%99%94-%EB%8B%A4%EC%A4%91-%EB%B3%B4%EC%95%88-%EC%84%A4%EC%A0%95\">Filter 초기화 다중 보안 설정</a></li>\n<li>\n<p><a href=\"/SpringSecurity1/#%EC%9D%B8%EC%A6%9Dauthentication\">인증(Authentication)</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#securitycontext\">SecurityContext</a></li>\n<li><a href=\"/SpringSecurity1/#securitycontextholder\">SecurityContextHolder</a></li>\n<li><a href=\"/SpringSecurity1/#securitypersistencefilter\">SecurityPersistenceFilter</a></li>\n<li><a href=\"/SpringSecurity1/#%EC%9D%B8%EC%A6%9D-%ED%9D%90%EB%A6%84-authentication-flow\">인증 흐름 (Authentication Flow)</a></li>\n<li><a href=\"/SpringSecurity1/#authenticationmanager\">AuthenticationManager</a></li>\n<li><a href=\"/SpringSecurity1/#authenticationprovider\">AuthenticationProvider</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity1/#%EC%9D%B8%EA%B0%80authorization\">인가(Authorization)</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0%EA%B0%80-%EC%A7%80%EC%9B%90%ED%95%98%EB%8A%94-%EA%B6%8C%ED%95%9C-%EA%B3%84%EC%B8%B5\">시큐리티가 지원하는 권한 계층</a></li>\n<li><a href=\"/SpringSecurity1/#authorizationfilter\">AuthorizationFilter</a></li>\n<li><a href=\"/SpringSecurity1/#accessdecisionmanager\">AccessDecisionManager</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity1/#%EC%A0%95%EB%A6%AC-1\">정리</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#%EC%B4%88%EA%B8%B0%ED%99%94\">초기화</a></li>\n<li><a href=\"/SpringSecurity1/#%EC%9D%B8%EC%A6%9D\">인증</a></li>\n<li><a href=\"/SpringSecurity1/#%EC%9D%B8%EA%B0%80\">인가</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity1/#%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84\">인증 구현</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#%EC%A0%95%EC%A0%81%EC%9E%90%EC%9B%90-%EA%B4%80%EB%A6%AC\">정적자원 관리</a></li>\n<li><a href=\"/SpringSecurity1/#passwordencoder\">PasswordEncoder</a></li>\n<li><a href=\"/SpringSecurity1/#userdetails\">UserDetails</a></li>\n<li><a href=\"/SpringSecurity1/#customuserdetailsservicedb-%EC%97%B0%EB%8F%99-%EA%B5%AC%ED%98%84\">CustomUserDetailsService(DB 연동 구현)</a></li>\n<li>\n<p><a href=\"/SpringSecurity1/#form%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84\">Form인증 구현</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#customauthenticationprovider\">CustomAuthenticationProvider</a></li>\n<li><a href=\"/SpringSecurity1/#login-logout-%EC%B2%98%EB%A6%AC-%EB%B0%8F-%ED%95%B8%EB%93%A4%EB%9F%AC-%EA%B5%AC%ED%98%84\">Login, Logout 처리 및 핸들러 구현</a></li>\n<li><a href=\"/SpringSecurity1/#%EC%B5%9C%EC%A2%85-spring-config-%EC%84%A4%EC%A0%95\">최종 Spring Config 설정</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity1/#ajax-%EC%9D%B8%EC%A6%9D\">Ajax 인증</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#1-ajax-%EC%9A%94%EC%B2%AD-%EC%B2%98%EB%A6%AC-%ED%95%A0-filter-%EC%B6%94%EA%B0%80\">1. Ajax 요청 처리 할 Filter 추가</a></li>\n<li><a href=\"/SpringSecurity1/#2-ajaxauthenticationtoken%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1\">2. AjaxAuthenticationToken객체 생성</a></li>\n<li><a href=\"/SpringSecurity1/#3-%EC%9D%B8%EC%A6%9D-%EC%B2%98%EB%A6%AC-%ED%95%A0-ajaxauthenticationprovider-%EA%B5%AC%ED%98%84\">3. 인증 처리 할 AjaxAuthenticationProvider 구현</a></li>\n<li><a href=\"/SpringSecurity1/#4-%EC%9D%B8%EC%A6%9D-%EC%84%B1%EA%B3%B5-%EC%8B%A4%ED%8C%A8-%EC%B2%98%EB%A6%AC-%ED%95%B8%EB%93%A4%EB%9F%AC-%EA%B5%AC%ED%98%84\">4. 인증 성공, 실패 처리 핸들러 구현</a></li>\n<li><a href=\"/SpringSecurity1/#5-%EC%9D%B8%EA%B0%80-%EC%84%A4%EC%A0%95\">5. 인가 설정</a></li>\n<li><a href=\"/SpringSecurity1/#6-bean-%EC%84%A4%EC%A0%95-%EB%B0%8F-ajax%EC%9A%A9-securityconfig-%EC%84%A4%EC%A0%95-%EC%B6%94%EA%B0%80\">6. Bean 설정 및 Ajax용 SecurityConfig 설정 추가</a></li>\n<li><a href=\"/SpringSecurity1/#dsls\">DSLs</a></li>\n<li><a href=\"/SpringSecurity1/#ajax-login-csrf-%EC%84%A4%EC%A0%95\">Ajax Login, CSRF 설정</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity1/#%EC%9D%B8%EA%B0%80-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-db%EC%97%B0%EB%8F%99\">인가 프로세스 DB연동</a></p>\n<ul>\n<li>\n<p><a href=\"/SpringSecurity1/#url-%EB%B0%A9%EC%8B%9D-%EC%B2%98%EB%A6%AC\">URL 방식 처리</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#url-%EB%B0%A9%EC%8B%9D-%EA%B8%B0%EB%B3%B8-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC\">URL 방식 기본 동작 원리</a></li>\n<li><a href=\"/SpringSecurity1/#filterinvocationsecuritymetadatasource\">FilterInvocationSecurityMetadataSource</a></li>\n<li><a href=\"/SpringSecurity1/#requestmap-db-%EC%97%B0%EB%8F%99\">requestMap DB 연동</a></li>\n<li><a href=\"/SpringSecurity1/#resource%EB%A5%BC-%EA%B0%80%EC%A0%B8%EC%98%A4%EB%8A%94-service%EB%A5%BC-%EC%83%9D%EC%84%B1\">Resource를 가져오는 Service를 생성</a></li>\n<li><a href=\"/SpringSecurity1/#db-%EC%A0%91%EA%B7%BC-%EA%B6%8C%ED%95%9C-%EC%8B%A4%EC%8B%9C%EA%B0%84-%EB%B0%98%EC%98%81\">DB 접근 권한 실시간 반영</a></li>\n<li><a href=\"/SpringSecurity1/#%ED%97%88%EC%9A%A9-%ED%95%84%ED%84%B0\">허용 필터</a></li>\n<li><a href=\"/SpringSecurity1/#%EA%B3%84%EC%B8%B5-%EA%B6%8C%ED%95%9C-%EC%A0%81%EC%9A%A9\">계층 권한 적용</a></li>\n<li><a href=\"/SpringSecurity1/#ip-%EC%A0%91%EC%86%8D-%EC%A0%9C%ED%95%9C\">IP 접속 제한</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/SpringSecurity1/#method-%EB%B0%A9%EC%8B%9D-%EC%9D%B8%EA%B0%80-%EC%B2%98%EB%A6%AC\">Method 방식 인가 처리</a></p>\n<ul>\n<li><a href=\"/SpringSecurity1/#%EB%8F%99%EC%9E%91-%EB%B0%A9%EC%8B%9D\">동작 방식</a></li>\n<li><a href=\"/SpringSecurity1/#%EA%B4%80%EB%A0%A8-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98\">관련 어노테이션</a></li>\n<li><a href=\"/SpringSecurity1/#%EC%A0%81%EC%9A%A9-%EB%B0%A9%EB%B2%95\">적용 방법</a></li>\n</ul>\n</li>\n<li><a href=\"/SpringSecurity1/#aop-%EB%B0%A9%EC%8B%9D\">AOP 방식</a></li>\n</ul>\n</li>\n<li><a href=\"/SpringSecurity1/#%EC%9A%94%EC%95%BD\">요약</a></li>\n<li><a href=\"/SpringSecurity1/#reference\">Reference</a></li>\n</ul>","fields":{"slug":"/SpringSecurity1/"},"frontmatter":{"title":"Spring Security Session","date":"Jan 14, 2023","tags":["Spring"],"keywords":["Spring","Security"],"update":"Feb 06, 2023"}}},"pageContext":{"slug":"/SpringSecurity1/","series":[],"lastmod":"2023-02-06"}},"staticQueryHashes":["2027115977","694178885"]}